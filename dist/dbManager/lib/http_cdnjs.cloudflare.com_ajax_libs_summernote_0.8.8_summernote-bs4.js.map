{"version":3,"sources":["../../../dbManager/lib/http_cdnjs.cloudflare.com_ajax_libs_summernote_0.8.8_summernote-bs4.js"],"names":["factory","define","amd","module","exports","require","window","jQuery","$","isSupportAmd","isFontInstalled","fontName","testFontName","$tester","css","position","left","top","fontSize","text","appendTo","document","body","originalWidth","width","remove","userAgent","navigator","isMSIE","test","browserVersion","matches","exec","parseFloat","isEdge","hasCodeMirror","CodeMirror","__webpack_require__","resolve","e","specified","isSupportTouch","MaxTouchPoints","msMaxTouchPoints","agent","isMac","appVersion","indexOf","isFF","isPhantom","isWebkit","isChrome","isSafari","jqueryVersion","fn","jquery","isW3CRangeSupport","createRange","func","eq","itemA","itemB","eq2","peq2","propName","ok","fail","not","f","apply","arguments","and","fA","fB","item","self","a","invoke","obj","method","idCounter","uniqueId","prefix","id","rect2bnd","rect","$document","scrollTop","scrollLeft","right","height","bottom","invertObject","inverted","key","hasOwnProperty","namespaceToCamel","namespace","split","map","name","substring","toUpperCase","join","debounce","wait","immediate","timeout","context","args","later","callNow","clearTimeout","setTimeout","list","head","array","last","length","initial","slice","tail","find","pred","idx","len","all","inArray","contains","sum","reduce","memo","v","from","collection","result","isEmpty","clusterBy","aTail","aLast","compact","aResult","push","unique","results","next","prev","NBSP_CHAR","String","fromCharCode","ZERO_WIDTH_NBSP_CHAR","dom","isEditable","node","hasClass","isControlSizing","makePredByNodeName","nodeName","isText","nodeType","isElement","isVoid","isPara","isHeading","isPre","isLi","isPurePara","isTable","isData","isInline","isBodyContainer","isList","isHr","isBlockquote","isCell","isAnchor","isParaInline","ancestor","isBodyInline","isBody","isClosestSibling","nodeA","nodeB","nextSibling","previousSibling","withClosestSiblings","siblings","blankHTML","nodeLength","nodeValue","childNodes","innerHTML","paddingBlankHTML","parentNode","singleChildAncestor","listAncestor","ancestors","el","lastAncestor","filter","commonAncestor","n","listPrev","nodes","listNext","listDescendant","descendants","fnWalk","current","wrap","wrapperName","parent","wrapper","insertBefore","appendChild","insertAfter","preceding","appendChildNodes","aChild","each","child","isLeftEdgePoint","point","offset","isRightEdgePoint","isEdgePoint","isLeftEdgeOf","isRightEdgeOf","isLeftEdgePointOf","isRightEdgePointOf","hasChildren","prevPoint","isSkipInnerOffset","nextPoint","isSamePoint","pointA","pointB","isVisiblePoint","leftNode","rightNode","prevPointUntil","nextPointUntil","isCharPoint","ch","charAt","walkPoint","startPoint","endPoint","handler","isSkipOffset","makeOffsetPath","reverse","fromOffsetPath","offsets","i","splitNode","options","isSkipPaddingBlankHTML","isNotSplitEdgePoint","splitText","childNode","clone","cloneNode","splitTree","root","splitPoint","topAncestor","splitRoot","container","pivot","create","createElement","createText","createTextNode","isRemoveChild","removeNode","removeChild","removeWhile","replace","newNode","style","cssText","isTextarea","value","$node","stripLinebreaks","val","html","isNewlineOnBlock","markup","regexTag","match","endSlash","isEndOfInlineContainer","isBlockNode","trim","posFromPlaceholder","placeholder","$placeholder","pos","outerHeight","attachEvents","events","Object","keys","forEach","on","detachEvents","off","isCustomStyleTag","classList","blank","emptyPara","isBlock","isDiv","isBR","isSpan","isB","isU","isS","isI","isImg","isEmptyAnchor","Context","$note","ui","summernote","memos","modules","layoutInfo","initialize","createLayout","_initialize","hide","destroy","_destroy","removeData","removeLayout","reset","disabled","isDisabled","code","disable","buttons","extend","plugins","initializeModule","removeModule","removeMemo","triggerEvent","isActivated","undefined","codable","editable","attr","enable","callback","callbacks","trigger","shouldInitialize","ModuleClass","withoutIntialize","createInvokeHandlerAndUpdateState","event","createInvokeHandler","preventDefault","$target","target","closest","data","splits","hasSeparator","moduleName","methodName","type","isExternalAPICalled","hasInitOptions","langInfo","lang","icons","tooltip","note","first","focus","Renderer","children","render","$parent","contents","className","addClass","k","click","$container","append","renderer","isArray","editor","toolbar","editingArea","statusbar","airEditor","airEditable","buttonGroup","dropdown","items","content","template","option","dataValue","dataOption","dropdownButtonContents","dropdownCheck","icon","checkClassName","palette","row","rowSize","colors","eventName","col","colSize","color","placement","dialog","fade","title","footer","popover","direction","hideArrow","checkbox","checked","iconClassName","tagName","button","toggleBtn","$btn","isEnable","toggleClass","toggleBtnActive","isActive","onDialogShown","$dialog","one","onDialogHidden","showDialog","modal","hideDialog","$editor","airMode","show","font","bold","italic","underline","clear","strikethrough","subscript","superscript","size","image","insert","resizeFull","resizeHalf","resizeQuarter","floatLeft","floatRight","floatNone","shapeRounded","shapeCircle","shapeThumbnail","shapeNone","dragImageHere","dropImage","selectFromFiles","maximumFileSize","maximumFileSizeError","url","video","videoLink","providers","link","unlink","edit","textToDisplay","openInNewWindow","table","addRowAbove","addRowBelow","addColLeft","addColRight","delRow","delCol","delTable","hr","p","blockquote","pre","h1","h2","h3","h4","h5","h6","lists","unordered","ordered","help","fullscreen","codeview","paragraph","outdent","indent","center","justify","recent","more","background","foreground","transparent","setTransparent","resetToDefault","shortcut","shortcuts","close","textFormatting","action","paragraphFormatting","documentStyle","extraKeys","history","undo","redo","specialChar","select","keyMap","isEdit","keyCode","BACKSPACE","TAB","ENTER","SPACE","DELETE","isMove","LEFT","UP","RIGHT","DOWN","nameFromCode","range","textRangeToPoint","textRange","isStart","parentElement","tester","createTextRange","prevContainer","moveToElementText","compareEndPoints","textRangeStart","curTextNode","collapse","firstChild","pointTester","duplicate","setEndPoint","textCount","dummy","cont","pointToTextRange","textRangeInfo","isCollapseToStart","prevTextNodes","collapseToStart","info","moveStart","WrappedRange","sc","so","ec","eo","nativeRange","w3cRange","setStart","setEnd","getPoints","getStartPoint","getEndPoint","nativeRng","selection","getSelection","rangeCount","removeAllRanges","addRange","scrollIntoView","offsetTop","Math","abs","normalize","getVisiblePoint","isLeftToRight","block","isCollapsed","includeAncestor","fullyContains","leftEdgeNodes","expand","startAncestor","endAncestor","boundaryPoints","isSameContainer","deleteContents","rng","emptyParents","makeIsOn","isOnEditable","isOnList","isOnAnchor","isOnCell","isOnData","wrapBodyInlineWithPara","inlineSiblings","concat","para","insertNode","pasteHTML","contentsContainer","toString","getWordRange","findAfter","bookmark","s","path","paraBookmark","paras","getClientRects","wrappedRange","createFromSelection","createFromNode","anchorNode","getRangeAt","startContainer","startOffset","endContainer","endOffset","textRangeEnd","isTextNode","createFromNodeBefore","createFromNodeAfter","createFromBookmark","createFromParaBookmark","async","readFileAsDataURL","file","Deferred","deferred","FileReader","onload","dataURL","onerror","reject","readAsDataURL","promise","createImage","$img","detach","display","History","$editable","stack","stackOffset","makeSnapshot","emptyBookmark","applySnapshot","snapshot","rewind","recordUndo","Style","jQueryCSS","$obj","propertyNames","propertyName","call","fromNode","properties","styleInfo","parseInt","stylePara","styleNodes","expandClosestSibling","onlyPartialContains","nodesInRange","tails","elem","$cont","queryCommandState","queryCommandValue","orderedTypes","isUnordered","lineHeight","toFixed","anchor","Bullet","insertOrderedList","toggleList","insertUnorderedList","clustereds","wrapList","releaseList","listName","wrappedParas","diffLists","listNode","prevList","nextList","isEscapseToBody","releasedParas","headList","lastList","middleList","rootLists","rootList","listNodes","Typing","bullet","insertTab","tabsize","tab","Array","insertParagraph","nextPara","emptyAnchors","TableResultAction","where","domTable","_startPoint","_virtualTable","_actionCellList","setStartPoint","toLowerCase","console","error","colPos","cellIndex","rowPos","rowIndex","setVirtualTablePosition","baseRow","baseCell","isRowSpan","isColSpan","isVirtualCell","objPosition","getActionCell","virtualTableCellObj","resultAction","virtualRowPosition","virtualColPosition","recoverCellIndex","newCellIndex","addCellInfoToVirtual","cell","cellHasColspan","colSpan","cellHasRowspan","rowSpan","isThisSelectedCell","rowspanNumber","attributes","rp","rowspanIndex","adjustStartPoint","colspanNumber","cp","cellspanIndex","isSelectedCell","createVirtualTable","rows","cells","getDeleteResultActionToCell","Column","SubtractSpanCount","Row","isVirtual","AddCell","RemoveCell","getAddResultActionToCell","SumSpanCount","Ignore","init","getActionList","fixedRow","fixedCol","actualPosition","canContinue","rowPosition","colPosition","requestAction","Add","Delete","Table","isShift","nextCell","addRow","currentTr","trAttributes","recoverAttributes","vTable","actions","idCell","currentCell","tdAttributes","baseCellTr","isTopFromRowSpan","newTd","removeAttr","setAttribute","before","lastTrIndex","after","addCol","rowsGroup","actionIndex","resultStr","attrList","deleteRow","cellPos","index","virtualPosition","virtualTable","hasRowspan","nextRow","cloneRow","removeAttribute","deleteCol","hasColspan","createTable","colCount","rowCount","tds","tdHTML","idxCol","trs","trHTML","idxRow","$table","tableClassName","deleteTable","KEY_BOGUS","Editor","lastRange","typing","isDefaultPrevented","handleKeyMap","preventDefaultEditableShortCuts","changeEventName","outerWidth","maxHeight","minHeight","metaKey","ctrlKey","altKey","shiftKey","keyName","afterCommand","saveRange","thenCollapse","restoreRange","saveTarget","clearTarget","restoreTarget","currentStyle","styleFromNode","beforeCommand","isPreventTrigger","commands","sCmd","execCommand","tabSize","untab","wrapCommand","insertImage","src","param","then","$image","min","insertImages","files","filename","maximumImageFileSize","insertImagesOrCallback","onImageUpload","insertText","textNode","getSelectedText","formatBlock","onApplyCustomStyle","onFormatBlock","formatPara","spans","firstSpan","insertHorizontalRule","hrNode","removeBogus","bogusNode","bogusCharIdx","deleteData","createLink","linkInfo","linkUrl","linkText","isNewWindow","isTextChanged","onCreateLink","anchors","startRange","endRange","getLinkInfo","$anchor","colorInfo","foreColor","backColor","insertTable","dim","dimension","floatMe","resize","resizeTo","bKeepRatio","imageSize","newRatio","y","x","ratio","removeMedia","hasFocus","is","empty","Clipboard","we","needKeydownHook","V","$paste","pasteByHook","opacity","pasteByEvent","decodedData","atob","Uint8Array","charCodeAt","blob","Blob","pasteContent","clipboardData","originalEvent","kind","getAsFile","Dropzone","documentEventHandlers","$dropzone","prependTo","detachDocumentEvent","substr","disableDragAndDrop","onDrop","attachDragAndDropEvent","$dropzoneMessage","onDragenter","isCodeview","hasEditorSize","add","onDragleave","removeClass","dataTransfer","types","getData","cm","Codeview","$codable","sync","save","toggle","deactivate","activate","prettifyHtml","cmEditor","fromTextArea","codemirror","tern","server","TernServer","ternServer","updateArgHints","setSize","getValue","toTextArea","isChange","EDITABLE_PADDING","Statusbar","$statusbar","disableResizeEditor","stopPropagation","editableTop","onMouseMove","clientY","minheight","max","Fullscreen","$toolbar","$window","$scrollbar","h","setsize","onResize","isFullscreen","Handle","$editingArea","update","$handle","disableResizeImage","posStart","clientX","isImage","$selection","w","sizingText","AutoLink","defaultScheme","linkPattern","handleKeyup","handleKeydown","lastWordRange","keyword","wordRange","AutoSync","Placeholder","isShow","Buttons","invertedKeyMap","representShortcut","editorMethod","addToolbarButtons","addImagePopoverButtons","addLinkPopoverButtons","addTablePopoverButtons","fontInstalledMap","fontNamesIgnoreCheck","magic","styleTags","tag","eraser","menuCheck","fontNames","fontSizes","$button","currentTarget","$recentColor","$dropdown","$holder","$color","$currentButton","unorderedlist","orderedlist","justifyLeft","alignLeft","justifyCenter","alignCenter","justifyRight","alignRight","justifyFull","alignJustify","textHeight","lineHeights","$catcher","insertTableMaxSize","mousedown","tableMoveHandler","picture","minus","arrowsAlt","question","trash","rowAbove","rowBelow","colBefore","colAfter","rowRemove","colRemove","build","groups","groupIdx","groupLen","group","groupName","$group","updateCurrentStyle","updateBtnStates","$item","isChecked","infos","selector","PX_PER_EM","$picker","$dimensionDisplay","$highlighted","$unhighlighted","posOffset","offsetX","posCatcher","pageX","pageY","offsetY","c","ceil","r","Toolbar","toolbarContainer","changeContainer","updateFullscreen","updateCodeview","isIncludeCodeview","LinkDialog","dialogsInBody","disableLinkTarget","dialogsFade","bindEnterKey","$input","toggleLinkBtn","$linkBtn","$linkText","$linkUrl","showLinkDialog","$openInNewWindow","handleLinkTextUpdate","handleLinkUrlUpdate","linkTargetBlank","prop","state","LinkPopover","$popover","$content","prepend","href","ImageDialog","imageLimitation","unit","floor","log","readableSize","pow","showImageDialog","$imageInput","$imageUrl","$imageBtn","replaceWith","ImagePopover","posEditor","TablePopover","VideoDialog","createVideoNode","ytRegExp","ytMatch","igRegExp","igMatch","vRegExp","vMatch","vimRegExp","vimMatch","dmRegExp","dmMatch","youkuRegExp","youkuMatch","qqRegExp","qqMatch","qqRegExp2","qqMatch2","mp4RegExp","mp4Match","oggRegExp","oggMatch","webmRegExp","webmMatch","$video","youtubeId","vid","showVideoDialog","$videoUrl","$videoBtn","HelpDialog","createShortCutList","command","$row","showHelpDialog","AirPopover","AIR_MODE_POPOVER_X_OFFSET","relatedTarget","air","bnd","HintPopover","POPOVER_DIST","hint","hintDirection","hints","selectItem","innerHeight","moveDown","$current","$next","$nextGroup","moveUp","$prev","$prevGroup","nodeFromItem","createItemTemplates","hintIdx","searchKeyword","search","createGroup","version","styleWithSpan","textareaAutoSync","onInit","onFocus","onBlur","onEnter","onKeyup","onKeydown","onImageUploadError","mode","htmlMode","lineNumbers","pc","mac"],"mappings":"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","file":"http_cdnjs.cloudflare.com_ajax_libs_summernote_0.8.8_summernote-bs4.js","sourcesContent":["/**\n * Super simple wysiwyg editor v0.8.8\n * http://summernote.org/\n *\n * summernote-bs4.js\n * Copyright 2013- Alan Hong. and other contributors\n * summernote may be freely distributed under the MIT license./\n *\n * Date: 2017-09-09T11:03Z\n */\n(function (factory) {\n  /* global define */\n  if (typeof define === 'function' && define.amd) {\n    // AMD. Register as an anonymous module.\n    define(['jquery'], factory);\n  } else if (typeof module === 'object' && module.exports) {\n    // Node/CommonJS\n    module.exports = factory(require('jquery'));\n  } else {\n    // Browser globals\n    factory(window.jQuery);\n  }\n}(function ($) {\n  'use strict';\n\n  var isSupportAmd = typeof define === 'function' && define.amd;\n\n  /**\n   * returns whether font is installed or not.\n   *\n   * @param {String} fontName\n   * @return {Boolean}\n   */\n  var isFontInstalled = function (fontName) {\n    var testFontName = fontName === 'Comic Sans MS' ? 'Courier New' : 'Comic Sans MS';\n    var $tester = $('<div>').css({\n      position: 'absolute',\n      left: '-9999px',\n      top: '-9999px',\n      fontSize: '200px'\n    }).text('mmmmmmmmmwwwwwww').appendTo(document.body);\n\n    var originalWidth = $tester.css('fontFamily', testFontName).width();\n    var width = $tester.css('fontFamily', fontName + ',' + testFontName).width();\n\n    $tester.remove();\n\n    return originalWidth !== width;\n  };\n\n  var userAgent = navigator.userAgent;\n  var isMSIE = /MSIE|Trident/i.test(userAgent);\n  var browserVersion;\n  if (isMSIE) {\n    var matches = /MSIE (\\d+[.]\\d+)/.exec(userAgent);\n    if (matches) {\n      browserVersion = parseFloat(matches[1]);\n    }\n    matches = /Trident\\/.*rv:([0-9]{1,}[\\.0-9]{0,})/.exec(userAgent);\n    if (matches) {\n      browserVersion = parseFloat(matches[1]);\n    }\n  }\n\n  var isEdge = /Edge\\/\\d+/.test(userAgent);\n\n  var hasCodeMirror = !!window.CodeMirror;\n  if (!hasCodeMirror && isSupportAmd) {\n    // Webpack\n    if (typeof __webpack_require__ === 'function') { // jshint ignore:line\n      try {\n        // If CodeMirror can't be resolved, `require.resolve` will throw an\n        // exception and `hasCodeMirror` won't be set to `true`.\n        require.resolve('codemirror');\n        hasCodeMirror = true;\n      } catch (e) {\n        // do nothing\n      }\n    } else if (typeof require !== 'undefined') {\n      // Browserify\n      if (typeof require.resolve !== 'undefined') {\n        try {\n          // If CodeMirror can't be resolved, `require.resolve` will throw an\n          // exception and `hasCodeMirror` won't be set to `true`.\n          require.resolve('codemirror');\n          hasCodeMirror = true;\n        } catch (e) {\n          // do nothing\n        }\n      // Almond/Require\n      } else if (typeof require.specified !== 'undefined') {\n        hasCodeMirror = require.specified('codemirror');\n      }\n    }\n  }\n\n  var isSupportTouch =\n    (('ontouchstart' in window) ||\n     (navigator.MaxTouchPoints > 0) ||\n     (navigator.msMaxTouchPoints > 0));\n\n  /**\n   * @class core.agent\n   *\n   * Object which check platform and agent\n   *\n   * @singleton\n   * @alternateClassName agent\n   */\n  var agent = {\n    isMac: navigator.appVersion.indexOf('Mac') > -1,\n    isMSIE: isMSIE,\n    isEdge: isEdge,\n    isFF: !isEdge && /firefox/i.test(userAgent),\n    isPhantom: /PhantomJS/i.test(userAgent),\n    isWebkit: !isEdge && /webkit/i.test(userAgent),\n    isChrome: !isEdge && /chrome/i.test(userAgent),\n    isSafari: !isEdge && /safari/i.test(userAgent),\n    browserVersion: browserVersion,\n    jqueryVersion: parseFloat($.fn.jquery),\n    isSupportAmd: isSupportAmd,\n    isSupportTouch: isSupportTouch,\n    hasCodeMirror: hasCodeMirror,\n    isFontInstalled: isFontInstalled,\n    isW3CRangeSupport: !!document.createRange\n  };\n\n  /**\n   * @class core.func\n   *\n   * func utils (for high-order func's arg)\n   *\n   * @singleton\n   * @alternateClassName func\n   */\n  var func = (function () {\n    var eq = function (itemA) {\n      return function (itemB) {\n        return itemA === itemB;\n      };\n    };\n\n    var eq2 = function (itemA, itemB) {\n      return itemA === itemB;\n    };\n\n    var peq2 = function (propName) {\n      return function (itemA, itemB) {\n        return itemA[propName] === itemB[propName];\n      };\n    };\n\n    var ok = function () {\n      return true;\n    };\n\n    var fail = function () {\n      return false;\n    };\n\n    var not = function (f) {\n      return function () {\n        return !f.apply(f, arguments);\n      };\n    };\n\n    var and = function (fA, fB) {\n      return function (item) {\n        return fA(item) && fB(item);\n      };\n    };\n\n    var self = function (a) {\n      return a;\n    };\n\n    var invoke = function (obj, method) {\n      return function () {\n        return obj[method].apply(obj, arguments);\n      };\n    };\n\n    var idCounter = 0;\n\n    /**\n     * generate a globally-unique id\n     *\n     * @param {String} [prefix]\n     */\n    var uniqueId = function (prefix) {\n      var id = ++idCounter + '';\n      return prefix ? prefix + id : id;\n    };\n\n    /**\n     * returns bnd (bounds) from rect\n     *\n     * - IE Compatibility Issue: http://goo.gl/sRLOAo\n     * - Scroll Issue: http://goo.gl/sNjUc\n     *\n     * @param {Rect} rect\n     * @return {Object} bounds\n     * @return {Number} bounds.top\n     * @return {Number} bounds.left\n     * @return {Number} bounds.width\n     * @return {Number} bounds.height\n     */\n    var rect2bnd = function (rect) {\n      var $document = $(document);\n      return {\n        top: rect.top + $document.scrollTop(),\n        left: rect.left + $document.scrollLeft(),\n        width: rect.right - rect.left,\n        height: rect.bottom - rect.top\n      };\n    };\n\n    /**\n     * returns a copy of the object where the keys have become the values and the values the keys.\n     * @param {Object} obj\n     * @return {Object}\n     */\n    var invertObject = function (obj) {\n      var inverted = {};\n      for (var key in obj) {\n        if (obj.hasOwnProperty(key)) {\n          inverted[obj[key]] = key;\n        }\n      }\n      return inverted;\n    };\n\n    /**\n     * @param {String} namespace\n     * @param {String} [prefix]\n     * @return {String}\n     */\n    var namespaceToCamel = function (namespace, prefix) {\n      prefix = prefix || '';\n      return prefix + namespace.split('.').map(function (name) {\n        return name.substring(0, 1).toUpperCase() + name.substring(1);\n      }).join('');\n    };\n\n    /**\n     * Returns a function, that, as long as it continues to be invoked, will not\n     * be triggered. The function will be called after it stops being called for\n     * N milliseconds. If `immediate` is passed, trigger the function on the\n     * leading edge, instead of the trailing.\n     * @param {Function} func\n     * @param {Number} wait\n     * @param {Boolean} immediate\n     * @return {Function}\n     */\n    var debounce = function (func, wait, immediate) {\n      var timeout;\n      return function () {\n        var context = this, args = arguments;\n        var later = function () {\n          timeout = null;\n          if (!immediate) {\n            func.apply(context, args);\n          }\n        };\n        var callNow = immediate && !timeout;\n        clearTimeout(timeout);\n        timeout = setTimeout(later, wait);\n        if (callNow) {\n          func.apply(context, args);\n        }\n      };\n    };\n\n    return {\n      eq: eq,\n      eq2: eq2,\n      peq2: peq2,\n      ok: ok,\n      fail: fail,\n      self: self,\n      not: not,\n      and: and,\n      invoke: invoke,\n      uniqueId: uniqueId,\n      rect2bnd: rect2bnd,\n      invertObject: invertObject,\n      namespaceToCamel: namespaceToCamel,\n      debounce: debounce\n    };\n  })();\n\n  /**\n   * @class core.list\n   *\n   * list utils\n   *\n   * @singleton\n   * @alternateClassName list\n   */\n  var list = (function () {\n    /**\n     * returns the first item of an array.\n     *\n     * @param {Array} array\n     */\n    var head = function (array) {\n      return array[0];\n    };\n\n    /**\n     * returns the last item of an array.\n     *\n     * @param {Array} array\n     */\n    var last = function (array) {\n      return array[array.length - 1];\n    };\n\n    /**\n     * returns everything but the last entry of the array.\n     *\n     * @param {Array} array\n     */\n    var initial = function (array) {\n      return array.slice(0, array.length - 1);\n    };\n\n    /**\n     * returns the rest of the items in an array.\n     *\n     * @param {Array} array\n     */\n    var tail = function (array) {\n      return array.slice(1);\n    };\n\n    /**\n     * returns item of array\n     */\n    var find = function (array, pred) {\n      for (var idx = 0, len = array.length; idx < len; idx ++) {\n        var item = array[idx];\n        if (pred(item)) {\n          return item;\n        }\n      }\n    };\n\n    /**\n     * returns true if all of the values in the array pass the predicate truth test.\n     */\n    var all = function (array, pred) {\n      for (var idx = 0, len = array.length; idx < len; idx ++) {\n        if (!pred(array[idx])) {\n          return false;\n        }\n      }\n      return true;\n    };\n\n    /**\n     * returns index of item\n     */\n    var indexOf = function (array, item) {\n      return $.inArray(item, array);\n    };\n\n    /**\n     * returns true if the value is present in the list.\n     */\n    var contains = function (array, item) {\n      return indexOf(array, item) !== -1;\n    };\n\n    /**\n     * get sum from a list\n     *\n     * @param {Array} array - array\n     * @param {Function} fn - iterator\n     */\n    var sum = function (array, fn) {\n      fn = fn || func.self;\n      return array.reduce(function (memo, v) {\n        return memo + fn(v);\n      }, 0);\n    };\n  \n    /**\n     * returns a copy of the collection with array type.\n     * @param {Collection} collection - collection eg) node.childNodes, ...\n     */\n    var from = function (collection) {\n      var result = [], idx = -1, length = collection.length;\n      while (++idx < length) {\n        result[idx] = collection[idx];\n      }\n      return result;\n    };\n\n    /**\n     * returns whether list is empty or not\n     */\n    var isEmpty = function (array) {\n      return !array || !array.length;\n    };\n  \n    /**\n     * cluster elements by predicate function.\n     *\n     * @param {Array} array - array\n     * @param {Function} fn - predicate function for cluster rule\n     * @param {Array[]}\n     */\n    var clusterBy = function (array, fn) {\n      if (!array.length) { return []; }\n      var aTail = tail(array);\n      return aTail.reduce(function (memo, v) {\n        var aLast = last(memo);\n        if (fn(last(aLast), v)) {\n          aLast[aLast.length] = v;\n        } else {\n          memo[memo.length] = [v];\n        }\n        return memo;\n      }, [[head(array)]]);\n    };\n  \n    /**\n     * returns a copy of the array with all false values removed\n     *\n     * @param {Array} array - array\n     * @param {Function} fn - predicate function for cluster rule\n     */\n    var compact = function (array) {\n      var aResult = [];\n      for (var idx = 0, len = array.length; idx < len; idx ++) {\n        if (array[idx]) { aResult.push(array[idx]); }\n      }\n      return aResult;\n    };\n\n    /**\n     * produces a duplicate-free version of the array\n     *\n     * @param {Array} array\n     */\n    var unique = function (array) {\n      var results = [];\n\n      for (var idx = 0, len = array.length; idx < len; idx ++) {\n        if (!contains(results, array[idx])) {\n          results.push(array[idx]);\n        }\n      }\n\n      return results;\n    };\n\n    /**\n     * returns next item.\n     * @param {Array} array\n     */\n    var next = function (array, item) {\n      var idx = indexOf(array, item);\n      if (idx === -1) { return null; }\n\n      return array[idx + 1];\n    };\n\n    /**\n     * returns prev item.\n     * @param {Array} array\n     */\n    var prev = function (array, item) {\n      var idx = indexOf(array, item);\n      if (idx === -1) { return null; }\n\n      return array[idx - 1];\n    };\n\n    return { head: head, last: last, initial: initial, tail: tail,\n             prev: prev, next: next, find: find, contains: contains,\n             all: all, sum: sum, from: from, isEmpty: isEmpty,\n             clusterBy: clusterBy, compact: compact, unique: unique };\n  })();\n\n\n  var NBSP_CHAR = String.fromCharCode(160);\n  var ZERO_WIDTH_NBSP_CHAR = '\\ufeff';\n\n  /**\n   * @class core.dom\n   *\n   * Dom functions\n   *\n   * @singleton\n   * @alternateClassName dom\n   */\n  var dom = (function () {\n    /**\n     * @method isEditable\n     *\n     * returns whether node is `note-editable` or not.\n     *\n     * @param {Node} node\n     * @return {Boolean}\n     */\n    var isEditable = function (node) {\n      return node && $(node).hasClass('note-editable');\n    };\n\n    /**\n     * @method isControlSizing\n     *\n     * returns whether node is `note-control-sizing` or not.\n     *\n     * @param {Node} node\n     * @return {Boolean}\n     */\n    var isControlSizing = function (node) {\n      return node && $(node).hasClass('note-control-sizing');\n    };\n\n    /**\n     * @method makePredByNodeName\n     *\n     * returns predicate which judge whether nodeName is same\n     *\n     * @param {String} nodeName\n     * @return {Function}\n     */\n    var makePredByNodeName = function (nodeName) {\n      nodeName = nodeName.toUpperCase();\n      return function (node) {\n        return node && node.nodeName.toUpperCase() === nodeName;\n      };\n    };\n\n    /**\n     * @method isText\n     *\n     *\n     *\n     * @param {Node} node\n     * @return {Boolean} true if node's type is text(3)\n     */\n    var isText = function (node) {\n      return node && node.nodeType === 3;\n    };\n\n    /**\n     * @method isElement\n     *\n     *\n     *\n     * @param {Node} node\n     * @return {Boolean} true if node's type is element(1)\n     */\n    var isElement = function (node) {\n      return node && node.nodeType === 1;\n    };\n\n    /**\n     * ex) br, col, embed, hr, img, input, ...\n     * @see http://www.w3.org/html/wg/drafts/html/master/syntax.html#void-elements\n     */\n    var isVoid = function (node) {\n      return node && /^BR|^IMG|^HR|^IFRAME|^BUTTON|^INPUT/.test(node.nodeName.toUpperCase());\n    };\n\n    var isPara = function (node) {\n      if (isEditable(node)) {\n        return false;\n      }\n\n      // Chrome(v31.0), FF(v25.0.1) use DIV for paragraph\n      return node && /^DIV|^P|^LI|^H[1-7]/.test(node.nodeName.toUpperCase());\n    };\n\n    var isHeading = function (node) {\n      return node && /^H[1-7]/.test(node.nodeName.toUpperCase());\n    };\n\n    var isPre = makePredByNodeName('PRE');\n\n    var isLi = makePredByNodeName('LI');\n\n    var isPurePara = function (node) {\n      return isPara(node) && !isLi(node);\n    };\n\n    var isTable = makePredByNodeName('TABLE');\n\n    var isData = makePredByNodeName('DATA');\n\n    var isInline = function (node) {\n      return !isBodyContainer(node) &&\n             !isList(node) &&\n             !isHr(node) &&\n             !isPara(node) &&\n             !isTable(node) &&\n             !isBlockquote(node) &&\n             !isData(node);\n    };\n\n    var isList = function (node) {\n      return node && /^UL|^OL/.test(node.nodeName.toUpperCase());\n    };\n\n    var isHr = makePredByNodeName('HR');\n\n    var isCell = function (node) {\n      return node && /^TD|^TH/.test(node.nodeName.toUpperCase());\n    };\n\n    var isBlockquote = makePredByNodeName('BLOCKQUOTE');\n\n    var isBodyContainer = function (node) {\n      return isCell(node) || isBlockquote(node) || isEditable(node);\n    };\n\n    var isAnchor = makePredByNodeName('A');\n\n    var isParaInline = function (node) {\n      return isInline(node) && !!ancestor(node, isPara);\n    };\n\n    var isBodyInline = function (node) {\n      return isInline(node) && !ancestor(node, isPara);\n    };\n\n    var isBody = makePredByNodeName('BODY');\n\n    /**\n     * returns whether nodeB is closest sibling of nodeA\n     *\n     * @param {Node} nodeA\n     * @param {Node} nodeB\n     * @return {Boolean}\n     */\n    var isClosestSibling = function (nodeA, nodeB) {\n      return nodeA.nextSibling === nodeB ||\n             nodeA.previousSibling === nodeB;\n    };\n\n    /**\n     * returns array of closest siblings with node\n     *\n     * @param {Node} node\n     * @param {function} [pred] - predicate function\n     * @return {Node[]}\n     */\n    var withClosestSiblings = function (node, pred) {\n      pred = pred || func.ok;\n\n      var siblings = [];\n      if (node.previousSibling && pred(node.previousSibling)) {\n        siblings.push(node.previousSibling);\n      }\n      siblings.push(node);\n      if (node.nextSibling && pred(node.nextSibling)) {\n        siblings.push(node.nextSibling);\n      }\n      return siblings;\n    };\n\n    /**\n     * blank HTML for cursor position\n     * - [workaround] old IE only works with &nbsp;\n     * - [workaround] IE11 and other browser works with bogus br\n     */\n    var blankHTML = agent.isMSIE && agent.browserVersion < 11 ? '&nbsp;' : '<br>';\n\n    /**\n     * @method nodeLength\n     *\n     * returns #text's text size or element's childNodes size\n     *\n     * @param {Node} node\n     */\n    var nodeLength = function (node) {\n      if (isText(node)) {\n        return node.nodeValue.length;\n      }\n      \n      if (node) {\n        return node.childNodes.length;\n      }\n      \n      return 0;\n      \n    };\n\n    /**\n     * returns whether node is empty or not.\n     *\n     * @param {Node} node\n     * @return {Boolean}\n     */\n    var isEmpty = function (node) {\n      var len = nodeLength(node);\n\n      if (len === 0) {\n        return true;\n      } else if (!isText(node) && len === 1 && node.innerHTML === blankHTML) {\n        // ex) <p><br></p>, <span><br></span>\n        return true;\n      } else if (list.all(node.childNodes, isText) && node.innerHTML === '') {\n        // ex) <p></p>, <span></span>\n        return true;\n      }\n\n      return false;\n    };\n\n    /**\n     * padding blankHTML if node is empty (for cursor position)\n     */\n    var paddingBlankHTML = function (node) {\n      if (!isVoid(node) && !nodeLength(node)) {\n        node.innerHTML = blankHTML;\n      }\n    };\n\n    /**\n     * find nearest ancestor predicate hit\n     *\n     * @param {Node} node\n     * @param {Function} pred - predicate function\n     */\n    var ancestor = function (node, pred) {\n      while (node) {\n        if (pred(node)) { return node; }\n        if (isEditable(node)) { break; }\n\n        node = node.parentNode;\n      }\n      return null;\n    };\n\n    /**\n     * find nearest ancestor only single child blood line and predicate hit\n     *\n     * @param {Node} node\n     * @param {Function} pred - predicate function\n     */\n    var singleChildAncestor = function (node, pred) {\n      node = node.parentNode;\n\n      while (node) {\n        if (nodeLength(node) !== 1) { break; }\n        if (pred(node)) { return node; }\n        if (isEditable(node)) { break; }\n\n        node = node.parentNode;\n      }\n      return null;\n    };\n\n    /**\n     * returns new array of ancestor nodes (until predicate hit).\n     *\n     * @param {Node} node\n     * @param {Function} [optional] pred - predicate function\n     */\n    var listAncestor = function (node, pred) {\n      pred = pred || func.fail;\n\n      var ancestors = [];\n      ancestor(node, function (el) {\n        if (!isEditable(el)) {\n          ancestors.push(el);\n        }\n\n        return pred(el);\n      });\n      return ancestors;\n    };\n\n    /**\n     * find farthest ancestor predicate hit\n     */\n    var lastAncestor = function (node, pred) {\n      var ancestors = listAncestor(node);\n      return list.last(ancestors.filter(pred));\n    };\n\n    /**\n     * returns common ancestor node between two nodes.\n     *\n     * @param {Node} nodeA\n     * @param {Node} nodeB\n     */\n    var commonAncestor = function (nodeA, nodeB) {\n      var ancestors = listAncestor(nodeA);\n      for (var n = nodeB; n; n = n.parentNode) {\n        if ($.inArray(n, ancestors) > -1) { return n; }\n      }\n      return null; // difference document area\n    };\n\n    /**\n     * listing all previous siblings (until predicate hit).\n     *\n     * @param {Node} node\n     * @param {Function} [optional] pred - predicate function\n     */\n    var listPrev = function (node, pred) {\n      pred = pred || func.fail;\n\n      var nodes = [];\n      while (node) {\n        if (pred(node)) { break; }\n        nodes.push(node);\n        node = node.previousSibling;\n      }\n      return nodes;\n    };\n\n    /**\n     * listing next siblings (until predicate hit).\n     *\n     * @param {Node} node\n     * @param {Function} [pred] - predicate function\n     */\n    var listNext = function (node, pred) {\n      pred = pred || func.fail;\n\n      var nodes = [];\n      while (node) {\n        if (pred(node)) { break; }\n        nodes.push(node);\n        node = node.nextSibling;\n      }\n      return nodes;\n    };\n\n    /**\n     * listing descendant nodes\n     *\n     * @param {Node} node\n     * @param {Function} [pred] - predicate function\n     */\n    var listDescendant = function (node, pred) {\n      var descendants = [];\n      pred = pred || func.ok;\n\n      // start DFS(depth first search) with node\n      (function fnWalk(current) {\n        if (node !== current && pred(current)) {\n          descendants.push(current);\n        }\n        for (var idx = 0, len = current.childNodes.length; idx < len; idx++) {\n          fnWalk(current.childNodes[idx]);\n        }\n      })(node);\n\n      return descendants;\n    };\n\n    /**\n     * wrap node with new tag.\n     *\n     * @param {Node} node\n     * @param {Node} tagName of wrapper\n     * @return {Node} - wrapper\n     */\n    var wrap = function (node, wrapperName) {\n      var parent = node.parentNode;\n      var wrapper = $('<' + wrapperName + '>')[0];\n\n      parent.insertBefore(wrapper, node);\n      wrapper.appendChild(node);\n\n      return wrapper;\n    };\n\n    /**\n     * insert node after preceding\n     *\n     * @param {Node} node\n     * @param {Node} preceding - predicate function\n     */\n    var insertAfter = function (node, preceding) {\n      var next = preceding.nextSibling, parent = preceding.parentNode;\n      if (next) {\n        parent.insertBefore(node, next);\n      } else {\n        parent.appendChild(node);\n      }\n      return node;\n    };\n\n    /**\n     * append elements.\n     *\n     * @param {Node} node\n     * @param {Collection} aChild\n     */\n    var appendChildNodes = function (node, aChild) {\n      $.each(aChild, function (idx, child) {\n        node.appendChild(child);\n      });\n      return node;\n    };\n\n    /**\n     * returns whether boundaryPoint is left edge or not.\n     *\n     * @param {BoundaryPoint} point\n     * @return {Boolean}\n     */\n    var isLeftEdgePoint = function (point) {\n      return point.offset === 0;\n    };\n\n    /**\n     * returns whether boundaryPoint is right edge or not.\n     *\n     * @param {BoundaryPoint} point\n     * @return {Boolean}\n     */\n    var isRightEdgePoint = function (point) {\n      return point.offset === nodeLength(point.node);\n    };\n\n    /**\n     * returns whether boundaryPoint is edge or not.\n     *\n     * @param {BoundaryPoint} point\n     * @return {Boolean}\n     */\n    var isEdgePoint = function (point) {\n      return isLeftEdgePoint(point) || isRightEdgePoint(point);\n    };\n\n    /**\n     * returns whether node is left edge of ancestor or not.\n     *\n     * @param {Node} node\n     * @param {Node} ancestor\n     * @return {Boolean}\n     */\n    var isLeftEdgeOf = function (node, ancestor) {\n      while (node && node !== ancestor) {\n        if (position(node) !== 0) {\n          return false;\n        }\n        node = node.parentNode;\n      }\n\n      return true;\n    };\n\n    /**\n     * returns whether node is right edge of ancestor or not.\n     *\n     * @param {Node} node\n     * @param {Node} ancestor\n     * @return {Boolean}\n     */\n    var isRightEdgeOf = function (node, ancestor) {\n      if (!ancestor) {\n        return false;\n      }\n      while (node && node !== ancestor) {\n        if (position(node) !== nodeLength(node.parentNode) - 1) {\n          return false;\n        }\n        node = node.parentNode;\n      }\n\n      return true;\n    };\n\n    /**\n     * returns whether point is left edge of ancestor or not.\n     * @param {BoundaryPoint} point\n     * @param {Node} ancestor\n     * @return {Boolean}\n     */\n    var isLeftEdgePointOf = function (point, ancestor) {\n      return isLeftEdgePoint(point) && isLeftEdgeOf(point.node, ancestor);\n    };\n\n    /**\n     * returns whether point is right edge of ancestor or not.\n     * @param {BoundaryPoint} point\n     * @param {Node} ancestor\n     * @return {Boolean}\n     */\n    var isRightEdgePointOf = function (point, ancestor) {\n      return isRightEdgePoint(point) && isRightEdgeOf(point.node, ancestor);\n    };\n\n    /**\n     * returns offset from parent.\n     *\n     * @param {Node} node\n     */\n    var position = function (node) {\n      var offset = 0;\n      while ((node = node.previousSibling)) {\n        offset += 1;\n      }\n      return offset;\n    };\n\n    var hasChildren = function (node) {\n      return !!(node && node.childNodes && node.childNodes.length);\n    };\n\n    /**\n     * returns previous boundaryPoint\n     *\n     * @param {BoundaryPoint} point\n     * @param {Boolean} isSkipInnerOffset\n     * @return {BoundaryPoint}\n     */\n    var prevPoint = function (point, isSkipInnerOffset) {\n      var node, offset;\n\n      if (point.offset === 0) {\n        if (isEditable(point.node)) {\n          return null;\n        }\n\n        node = point.node.parentNode;\n        offset = position(point.node);\n      } else if (hasChildren(point.node)) {\n        node = point.node.childNodes[point.offset - 1];\n        offset = nodeLength(node);\n      } else {\n        node = point.node;\n        offset = isSkipInnerOffset ? 0 : point.offset - 1;\n      }\n\n      return {\n        node: node,\n        offset: offset\n      };\n    };\n\n    /**\n     * returns next boundaryPoint\n     *\n     * @param {BoundaryPoint} point\n     * @param {Boolean} isSkipInnerOffset\n     * @return {BoundaryPoint}\n     */\n    var nextPoint = function (point, isSkipInnerOffset) {\n      var node, offset;\n\n      if (nodeLength(point.node) === point.offset) {\n        if (isEditable(point.node)) {\n          return null;\n        }\n\n        node = point.node.parentNode;\n        offset = position(point.node) + 1;\n      } else if (hasChildren(point.node)) {\n        node = point.node.childNodes[point.offset];\n        offset = 0;\n      } else {\n        node = point.node;\n        offset = isSkipInnerOffset ? nodeLength(point.node) : point.offset + 1;\n      }\n\n      return {\n        node: node,\n        offset: offset\n      };\n    };\n\n    /**\n     * returns whether pointA and pointB is same or not.\n     *\n     * @param {BoundaryPoint} pointA\n     * @param {BoundaryPoint} pointB\n     * @return {Boolean}\n     */\n    var isSamePoint = function (pointA, pointB) {\n      return pointA.node === pointB.node && pointA.offset === pointB.offset;\n    };\n\n    /**\n     * returns whether point is visible (can set cursor) or not.\n     *\n     * @param {BoundaryPoint} point\n     * @return {Boolean}\n     */\n    var isVisiblePoint = function (point) {\n      if (isText(point.node) || !hasChildren(point.node) || isEmpty(point.node)) {\n        return true;\n      }\n\n      var leftNode = point.node.childNodes[point.offset - 1];\n      var rightNode = point.node.childNodes[point.offset];\n      if ((!leftNode || isVoid(leftNode)) && (!rightNode || isVoid(rightNode))) {\n        return true;\n      }\n\n      return false;\n    };\n\n    /**\n     * @method prevPointUtil\n     *\n     * @param {BoundaryPoint} point\n     * @param {Function} pred\n     * @return {BoundaryPoint}\n     */\n    var prevPointUntil = function (point, pred) {\n      while (point) {\n        if (pred(point)) {\n          return point;\n        }\n\n        point = prevPoint(point);\n      }\n\n      return null;\n    };\n\n    /**\n     * @method nextPointUntil\n     *\n     * @param {BoundaryPoint} point\n     * @param {Function} pred\n     * @return {BoundaryPoint}\n     */\n    var nextPointUntil = function (point, pred) {\n      while (point) {\n        if (pred(point)) {\n          return point;\n        }\n\n        point = nextPoint(point);\n      }\n\n      return null;\n    };\n\n    /**\n     * returns whether point has character or not.\n     *\n     * @param {Point} point\n     * @return {Boolean}\n     */\n    var isCharPoint = function (point) {\n      if (!isText(point.node)) {\n        return false;\n      }\n\n      var ch = point.node.nodeValue.charAt(point.offset - 1);\n      return ch && (ch !== ' ' && ch !== NBSP_CHAR);\n    };\n\n    /**\n     * @method walkPoint\n     *\n     * @param {BoundaryPoint} startPoint\n     * @param {BoundaryPoint} endPoint\n     * @param {Function} handler\n     * @param {Boolean} isSkipInnerOffset\n     */\n    var walkPoint = function (startPoint, endPoint, handler, isSkipInnerOffset) {\n      var point = startPoint;\n\n      while (point) {\n        handler(point);\n\n        if (isSamePoint(point, endPoint)) {\n          break;\n        }\n\n        var isSkipOffset = isSkipInnerOffset &&\n                           startPoint.node !== point.node &&\n                           endPoint.node !== point.node;\n        point = nextPoint(point, isSkipOffset);\n      }\n    };\n\n    /**\n     * @method makeOffsetPath\n     *\n     * return offsetPath(array of offset) from ancestor\n     *\n     * @param {Node} ancestor - ancestor node\n     * @param {Node} node\n     */\n    var makeOffsetPath = function (ancestor, node) {\n      var ancestors = listAncestor(node, func.eq(ancestor));\n      return ancestors.map(position).reverse();\n    };\n\n    /**\n     * @method fromOffsetPath\n     *\n     * return element from offsetPath(array of offset)\n     *\n     * @param {Node} ancestor - ancestor node\n     * @param {array} offsets - offsetPath\n     */\n    var fromOffsetPath = function (ancestor, offsets) {\n      var current = ancestor;\n      for (var i = 0, len = offsets.length; i < len; i++) {\n        if (current.childNodes.length <= offsets[i]) {\n          current = current.childNodes[current.childNodes.length - 1];\n        } else {\n          current = current.childNodes[offsets[i]];\n        }\n      }\n      return current;\n    };\n\n    /**\n     * @method splitNode\n     *\n     * split element or #text\n     *\n     * @param {BoundaryPoint} point\n     * @param {Object} [options]\n     * @param {Boolean} [options.isSkipPaddingBlankHTML] - default: false\n     * @param {Boolean} [options.isNotSplitEdgePoint] - default: false\n     * @return {Node} right node of boundaryPoint\n     */\n    var splitNode = function (point, options) {\n      var isSkipPaddingBlankHTML = options && options.isSkipPaddingBlankHTML;\n      var isNotSplitEdgePoint = options && options.isNotSplitEdgePoint;\n\n      // edge case\n      if (isEdgePoint(point) && (isText(point.node) || isNotSplitEdgePoint)) {\n        if (isLeftEdgePoint(point)) {\n          return point.node;\n        } else if (isRightEdgePoint(point)) {\n          return point.node.nextSibling;\n        }\n      }\n\n      // split #text\n      if (isText(point.node)) {\n        return point.node.splitText(point.offset);\n      } else {\n        var childNode = point.node.childNodes[point.offset];\n        var clone = insertAfter(point.node.cloneNode(false), point.node);\n        appendChildNodes(clone, listNext(childNode));\n\n        if (!isSkipPaddingBlankHTML) {\n          paddingBlankHTML(point.node);\n          paddingBlankHTML(clone);\n        }\n\n        return clone;\n      }\n    };\n\n    /**\n     * @method splitTree\n     *\n     * split tree by point\n     *\n     * @param {Node} root - split root\n     * @param {BoundaryPoint} point\n     * @param {Object} [options]\n     * @param {Boolean} [options.isSkipPaddingBlankHTML] - default: false\n     * @param {Boolean} [options.isNotSplitEdgePoint] - default: false\n     * @return {Node} right node of boundaryPoint\n     */\n    var splitTree = function (root, point, options) {\n      // ex) [#text, <span>, <p>]\n      var ancestors = listAncestor(point.node, func.eq(root));\n\n      if (!ancestors.length) {\n        return null;\n      } else if (ancestors.length === 1) {\n        return splitNode(point, options);\n      }\n\n      return ancestors.reduce(function (node, parent) {\n        if (node === point.node) {\n          node = splitNode(point, options);\n        }\n\n        return splitNode({\n          node: parent,\n          offset: node ? dom.position(node) : nodeLength(parent)\n        }, options);\n      });\n    };\n\n    /**\n     * split point\n     *\n     * @param {Point} point\n     * @param {Boolean} isInline\n     * @return {Object}\n     */\n    var splitPoint = function (point, isInline) {\n      // find splitRoot, container\n      //  - inline: splitRoot is a child of paragraph\n      //  - block: splitRoot is a child of bodyContainer\n      var pred = isInline ? isPara : isBodyContainer;\n      var ancestors = listAncestor(point.node, pred);\n      var topAncestor = list.last(ancestors) || point.node;\n\n      var splitRoot, container;\n      if (pred(topAncestor)) {\n        splitRoot = ancestors[ancestors.length - 2];\n        container = topAncestor;\n      } else {\n        splitRoot = topAncestor;\n        container = splitRoot.parentNode;\n      }\n\n      // if splitRoot is exists, split with splitTree\n      var pivot = splitRoot && splitTree(splitRoot, point, {\n        isSkipPaddingBlankHTML: isInline,\n        isNotSplitEdgePoint: isInline\n      });\n\n      // if container is point.node, find pivot with point.offset\n      if (!pivot && container === point.node) {\n        pivot = point.node.childNodes[point.offset];\n      }\n\n      return {\n        rightNode: pivot,\n        container: container\n      };\n    };\n\n    var create = function (nodeName) {\n      return document.createElement(nodeName);\n    };\n\n    var createText = function (text) {\n      return document.createTextNode(text);\n    };\n\n    /**\n     * @method remove\n     *\n     * remove node, (isRemoveChild: remove child or not)\n     *\n     * @param {Node} node\n     * @param {Boolean} isRemoveChild\n     */\n    var remove = function (node, isRemoveChild) {\n      if (!node || !node.parentNode) { return; }\n      if (node.removeNode) { return node.removeNode(isRemoveChild); }\n\n      var parent = node.parentNode;\n      if (!isRemoveChild) {\n        var nodes = [];\n        var i, len;\n        for (i = 0, len = node.childNodes.length; i < len; i++) {\n          nodes.push(node.childNodes[i]);\n        }\n\n        for (i = 0, len = nodes.length; i < len; i++) {\n          parent.insertBefore(nodes[i], node);\n        }\n      }\n\n      parent.removeChild(node);\n    };\n\n    /**\n     * @method removeWhile\n     *\n     * @param {Node} node\n     * @param {Function} pred\n     */\n    var removeWhile = function (node, pred) {\n      while (node) {\n        if (isEditable(node) || !pred(node)) {\n          break;\n        }\n\n        var parent = node.parentNode;\n        remove(node);\n        node = parent;\n      }\n    };\n\n    /**\n     * @method replace\n     *\n     * replace node with provided nodeName\n     *\n     * @param {Node} node\n     * @param {String} nodeName\n     * @return {Node} - new node\n     */\n    var replace = function (node, nodeName) {\n      if (node.nodeName.toUpperCase() === nodeName.toUpperCase()) {\n        return node;\n      }\n\n      var newNode = create(nodeName);\n\n      if (node.style.cssText) {\n        newNode.style.cssText = node.style.cssText;\n      }\n\n      appendChildNodes(newNode, list.from(node.childNodes));\n      insertAfter(newNode, node);\n      remove(node);\n\n      return newNode;\n    };\n\n    var isTextarea = makePredByNodeName('TEXTAREA');\n\n    /**\n     * @param {jQuery} $node\n     * @param {Boolean} [stripLinebreaks] - default: false\n     */\n    var value = function ($node, stripLinebreaks) {\n      var val = isTextarea($node[0]) ? $node.val() : $node.html();\n      if (stripLinebreaks) {\n        return val.replace(/[\\n\\r]/g, '');\n      }\n      return val;\n    };\n\n    /**\n     * @method html\n     *\n     * get the HTML contents of node\n     *\n     * @param {jQuery} $node\n     * @param {Boolean} [isNewlineOnBlock]\n     */\n    var html = function ($node, isNewlineOnBlock) {\n      var markup = value($node);\n\n      if (isNewlineOnBlock) {\n        var regexTag = /<(\\/?)(\\b(?!!)[^>\\s]*)(.*?)(\\s*\\/?>)/g;\n        markup = markup.replace(regexTag, function (match, endSlash, name) {\n          name = name.toUpperCase();\n          var isEndOfInlineContainer = /^DIV|^TD|^TH|^P|^LI|^H[1-7]/.test(name) &&\n                                       !!endSlash;\n          var isBlockNode = /^BLOCKQUOTE|^TABLE|^TBODY|^TR|^HR|^UL|^OL/.test(name);\n\n          return match + ((isEndOfInlineContainer || isBlockNode) ? '\\n' : '');\n        });\n        markup = $.trim(markup);\n      }\n\n      return markup;\n    };\n\n    var posFromPlaceholder = function (placeholder) {\n      var $placeholder = $(placeholder);\n      var pos = $placeholder.offset();\n      var height = $placeholder.outerHeight(true); // include margin\n\n      return {\n        left: pos.left,\n        top: pos.top + height\n      };\n    };\n\n    var attachEvents = function ($node, events) {\n      Object.keys(events).forEach(function (key) {\n        $node.on(key, events[key]);\n      });\n    };\n\n    var detachEvents = function ($node, events) {\n      Object.keys(events).forEach(function (key) {\n        $node.off(key, events[key]);\n      });\n    };\n\n    /**\n     * @method isCustomStyleTag\n     *\n     * assert if a node contains a \"note-styletag\" class,\n     * which implies that's a custom-made style tag node\n     *\n     * @param {Node} an HTML DOM node\n     */\n    var isCustomStyleTag = function (node) {\n      return node && !dom.isText(node) && list.contains(node.classList, 'note-styletag');\n    };\n\n    return {\n      /** @property {String} NBSP_CHAR */\n      NBSP_CHAR: NBSP_CHAR,\n      /** @property {String} ZERO_WIDTH_NBSP_CHAR */\n      ZERO_WIDTH_NBSP_CHAR: ZERO_WIDTH_NBSP_CHAR,\n      /** @property {String} blank */\n      blank: blankHTML,\n      /** @property {String} emptyPara */\n      emptyPara: '<p>' + blankHTML + '</p>',\n      makePredByNodeName: makePredByNodeName,\n      isEditable: isEditable,\n      isControlSizing: isControlSizing,\n      isText: isText,\n      isElement: isElement,\n      isVoid: isVoid,\n      isPara: isPara,\n      isPurePara: isPurePara,\n      isHeading: isHeading,\n      isInline: isInline,\n      isBlock: func.not(isInline),\n      isBodyInline: isBodyInline,\n      isBody: isBody,\n      isParaInline: isParaInline,\n      isPre: isPre,\n      isList: isList,\n      isTable: isTable,\n      isData: isData,\n      isCell: isCell,\n      isBlockquote: isBlockquote,\n      isBodyContainer: isBodyContainer,\n      isAnchor: isAnchor,\n      isDiv: makePredByNodeName('DIV'),\n      isLi: isLi,\n      isBR: makePredByNodeName('BR'),\n      isSpan: makePredByNodeName('SPAN'),\n      isB: makePredByNodeName('B'),\n      isU: makePredByNodeName('U'),\n      isS: makePredByNodeName('S'),\n      isI: makePredByNodeName('I'),\n      isImg: makePredByNodeName('IMG'),\n      isTextarea: isTextarea,\n      isEmpty: isEmpty,\n      isEmptyAnchor: func.and(isAnchor, isEmpty),\n      isClosestSibling: isClosestSibling,\n      withClosestSiblings: withClosestSiblings,\n      nodeLength: nodeLength,\n      isLeftEdgePoint: isLeftEdgePoint,\n      isRightEdgePoint: isRightEdgePoint,\n      isEdgePoint: isEdgePoint,\n      isLeftEdgeOf: isLeftEdgeOf,\n      isRightEdgeOf: isRightEdgeOf,\n      isLeftEdgePointOf: isLeftEdgePointOf,\n      isRightEdgePointOf: isRightEdgePointOf,\n      prevPoint: prevPoint,\n      nextPoint: nextPoint,\n      isSamePoint: isSamePoint,\n      isVisiblePoint: isVisiblePoint,\n      prevPointUntil: prevPointUntil,\n      nextPointUntil: nextPointUntil,\n      isCharPoint: isCharPoint,\n      walkPoint: walkPoint,\n      ancestor: ancestor,\n      singleChildAncestor: singleChildAncestor,\n      listAncestor: listAncestor,\n      lastAncestor: lastAncestor,\n      listNext: listNext,\n      listPrev: listPrev,\n      listDescendant: listDescendant,\n      commonAncestor: commonAncestor,\n      wrap: wrap,\n      insertAfter: insertAfter,\n      appendChildNodes: appendChildNodes,\n      position: position,\n      hasChildren: hasChildren,\n      makeOffsetPath: makeOffsetPath,\n      fromOffsetPath: fromOffsetPath,\n      splitTree: splitTree,\n      splitPoint: splitPoint,\n      create: create,\n      createText: createText,\n      remove: remove,\n      removeWhile: removeWhile,\n      replace: replace,\n      html: html,\n      value: value,\n      posFromPlaceholder: posFromPlaceholder,\n      attachEvents: attachEvents,\n      detachEvents: detachEvents,\n      isCustomStyleTag: isCustomStyleTag\n    };\n  })();\n\n  /**\n   * @param {jQuery} $note\n   * @param {Object} options\n   * @return {Context}\n   */\n  var Context = function ($note, options) {\n    var self = this;\n\n    var ui = $.summernote.ui;\n    this.memos = {};\n    this.modules = {};\n    this.layoutInfo = {};\n    this.options = options;\n\n    /**\n     * create layout and initialize modules and other resources\n     */\n    this.initialize = function () {\n      this.layoutInfo = ui.createLayout($note, options);\n      this._initialize();\n      $note.hide();\n      return this;\n    };\n\n    /**\n     * destroy modules and other resources and remove layout\n     */\n    this.destroy = function () {\n      this._destroy();\n      $note.removeData('summernote');\n      ui.removeLayout($note, this.layoutInfo);\n    };\n\n    /**\n     * destory modules and other resources and initialize it again\n     */\n    this.reset = function () {\n      var disabled = self.isDisabled();\n      this.code(dom.emptyPara);\n      this._destroy();\n      this._initialize();\n\n      if (disabled) {\n        self.disable();\n      }\n    };\n\n    this._initialize = function () {\n      // add optional buttons\n      var buttons = $.extend({}, this.options.buttons);\n      Object.keys(buttons).forEach(function (key) {\n        self.memo('button.' + key, buttons[key]);\n      });\n\n      var modules = $.extend({}, this.options.modules, $.summernote.plugins || {});\n\n      // add and initialize modules\n      Object.keys(modules).forEach(function (key) {\n        self.module(key, modules[key], true);\n      });\n\n      Object.keys(this.modules).forEach(function (key) {\n        self.initializeModule(key);\n      });\n    };\n\n    this._destroy = function () {\n      // destroy modules with reversed order\n      Object.keys(this.modules).reverse().forEach(function (key) {\n        self.removeModule(key);\n      });\n\n      Object.keys(this.memos).forEach(function (key) {\n        self.removeMemo(key);\n      });\n      // trigger custom onDestroy callback\n      this.triggerEvent('destroy', this);\n    };\n\n    this.code = function (html) {\n      var isActivated = this.invoke('codeview.isActivated');\n\n      if (html === undefined) {\n        this.invoke('codeview.sync');\n        return isActivated ? this.layoutInfo.codable.val() : this.layoutInfo.editable.html();\n      } else {\n        if (isActivated) {\n          this.layoutInfo.codable.val(html);\n        } else {\n          this.layoutInfo.editable.html(html);\n        }\n        $note.val(html);\n        this.triggerEvent('change', html);\n      }\n    };\n\n    this.isDisabled = function () {\n      return this.layoutInfo.editable.attr('contenteditable') === 'false';\n    };\n\n    this.enable = function () {\n      this.layoutInfo.editable.attr('contenteditable', true);\n      this.invoke('toolbar.activate', true);\n      this.triggerEvent('disable', false);\n    };\n\n    this.disable = function () {\n      // close codeview if codeview is opend\n      if (this.invoke('codeview.isActivated')) {\n        this.invoke('codeview.deactivate');\n      }\n      this.layoutInfo.editable.attr('contenteditable', false);\n      this.invoke('toolbar.deactivate', true);\n\n      this.triggerEvent('disable', true);\n    };\n\n    this.triggerEvent = function () {\n      var namespace = list.head(arguments);\n      var args = list.tail(list.from(arguments));\n\n      var callback = this.options.callbacks[func.namespaceToCamel(namespace, 'on')];\n      if (callback) {\n        callback.apply($note[0], args);\n      }\n      $note.trigger('summernote.' + namespace, args);\n    };\n\n    this.initializeModule = function (key) {\n      var module = this.modules[key];\n      module.shouldInitialize = module.shouldInitialize || func.ok;\n      if (!module.shouldInitialize()) {\n        return;\n      }\n\n      // initialize module\n      if (module.initialize) {\n        module.initialize();\n      }\n\n      // attach events\n      if (module.events) {\n        dom.attachEvents($note, module.events);\n      }\n    };\n\n    this.module = function (key, ModuleClass, withoutIntialize) {\n      if (arguments.length === 1) {\n        return this.modules[key];\n      }\n\n      this.modules[key] = new ModuleClass(this);\n\n      if (!withoutIntialize) {\n        this.initializeModule(key);\n      }\n    };\n\n    this.removeModule = function (key) {\n      var module = this.modules[key];\n      if (module.shouldInitialize()) {\n        if (module.events) {\n          dom.detachEvents($note, module.events);\n        }\n\n        if (module.destroy) {\n          module.destroy();\n        }\n      }\n\n      delete this.modules[key];\n    };\n\n    this.memo = function (key, obj) {\n      if (arguments.length === 1) {\n        return this.memos[key];\n      }\n      this.memos[key] = obj;\n    };\n\n    this.removeMemo = function (key) {\n      if (this.memos[key] && this.memos[key].destroy) {\n        this.memos[key].destroy();\n      }\n\n      delete this.memos[key];\n    };\n\n    /**\n     *Some buttons need to change their visual style immediately once they get pressed\n     */\n    this.createInvokeHandlerAndUpdateState = function (namespace, value) {\n      return function (event) {\n        self.createInvokeHandler(namespace, value)(event);\n        self.invoke('buttons.updateCurrentStyle');\n      };\n    };\n\n    this.createInvokeHandler = function (namespace, value) {\n      return function (event) {\n        event.preventDefault();\n        var $target = $(event.target);\n        self.invoke(namespace, value || $target.closest('[data-value]').data('value'), $target);\n      };\n    };\n\n    this.invoke = function () {\n      var namespace = list.head(arguments);\n      var args = list.tail(list.from(arguments));\n\n      var splits = namespace.split('.');\n      var hasSeparator = splits.length > 1;\n      var moduleName = hasSeparator && list.head(splits);\n      var methodName = hasSeparator ? list.last(splits) : list.head(splits);\n\n      var module = this.modules[moduleName || 'editor'];\n      if (!moduleName && this[methodName]) {\n        return this[methodName].apply(this, args);\n      } else if (module && module[methodName] && module.shouldInitialize()) {\n        return module[methodName].apply(module, args);\n      }\n    };\n\n    return this.initialize();\n  };\n\n  $.fn.extend({\n    /**\n     * Summernote API\n     *\n     * @param {Object|String}\n     * @return {this}\n     */\n    summernote: function () {\n      var type = $.type(list.head(arguments));\n      var isExternalAPICalled = type === 'string';\n      var hasInitOptions = type === 'object';\n\n      var options = hasInitOptions ? list.head(arguments) : {};\n\n      options = $.extend({}, $.summernote.options, options);\n\n      // Update options\n      options.langInfo = $.extend(true, {}, $.summernote.lang['en-US'], $.summernote.lang[options.lang]);\n      options.icons = $.extend(true, {}, $.summernote.options.icons, options.icons);\n      options.tooltip = options.tooltip === 'auto' ? !agent.isSupportTouch : options.tooltip;\n\n      this.each(function (idx, note) {\n        var $note = $(note);\n        if (!$note.data('summernote')) {\n          var context = new Context($note, options);\n          $note.data('summernote', context);\n          $note.data('summernote').triggerEvent('init', context.layoutInfo);\n        }\n      });\n\n      var $note = this.first();\n      if ($note.length) {\n        var context = $note.data('summernote');\n        if (isExternalAPICalled) {\n          return context.invoke.apply(context, list.from(arguments));\n        } else if (options.focus) {\n          context.invoke('editor.focus');\n        }\n      }\n\n      return this;\n    }\n  });\n\n\n  var Renderer = function (markup, children, options, callback) {\n    this.render = function ($parent) {\n      var $node = $(markup);\n\n      if (options && options.contents) {\n        $node.html(options.contents);\n      }\n\n      if (options && options.className) {\n        $node.addClass(options.className);\n      }\n\n      if (options && options.data) {\n        $.each(options.data, function (k, v) {\n          $node.attr('data-' + k, v);\n        });\n      }\n\n      if (options && options.click) {\n        $node.on('click', options.click);\n      }\n\n      if (children) {\n        var $container = $node.find('.note-children-container');\n        children.forEach(function (child) {\n          child.render($container.length ? $container : $node);\n        });\n      }\n\n      if (callback) {\n        callback($node, options);\n      }\n\n      if (options && options.callback) {\n        options.callback($node);\n      }\n\n      if ($parent) {\n        $parent.append($node);\n      }\n\n      return $node;\n    };\n  };\n\n  var renderer = {\n    create: function (markup, callback) {\n      return function () {\n        var children = $.isArray(arguments[0]) ? arguments[0] : [];\n        var options = typeof arguments[1] === 'object' ? arguments[1] : arguments[0];\n        if (options && options.children) {\n          children = options.children;\n        }\n        return new Renderer(markup, children, options, callback);\n      };\n    }\n  };\n\n  var editor = renderer.create('<div class=\"note-editor note-frame card\"/>');\n  var toolbar = renderer.create('<div class=\"note-toolbar card-header\"/>');\n  var editingArea = renderer.create('<div class=\"note-editing-area\"/>');\n  var codable = renderer.create('<textarea class=\"note-codable\"/>');\n  var editable = renderer.create('<div class=\"note-editable card-block\" contentEditable=\"true\"/>');\n  var statusbar = renderer.create([\n    '<div class=\"note-statusbar\">',\n    '  <div class=\"note-resizebar\">',\n    '    <div class=\"note-icon-bar\"/>',\n    '    <div class=\"note-icon-bar\"/>',\n    '    <div class=\"note-icon-bar\"/>',\n    '  </div>',\n    '</div>'\n  ].join(''));\n\n  var airEditor = renderer.create('<div class=\"note-editor\"/>');\n  var airEditable = renderer.create('<div class=\"note-editable\" contentEditable=\"true\"/>');\n\n  var buttonGroup = renderer.create('<div class=\"note-btn-group btn-group\">');\n\n  var dropdown = renderer.create('<div class=\"dropdown-menu\">', function ($node, options) {\n    var markup = $.isArray(options.items) ? options.items.map(function (item) {\n      var value = (typeof item === 'string') ? item : (item.value || '');\n      var content = options.template ? options.template(item) : item;\n      var option = (typeof item === 'object') ? item.option : undefined;\n\n      var dataValue = 'data-value=\"' + value + '\"';\n      var dataOption = (option !== undefined) ? ' data-option=\"' + option + '\"' : '';\n      return '<a class=\"dropdown-item\" href=\"#\" ' + (dataValue + dataOption) + '>' + content + '</a>';\n    }).join('') : options.items;\n\n    $node.html(markup);\n  });\n\n  var dropdownButtonContents = function (contents) {\n    return contents;\n  };\n\n  var dropdownCheck = renderer.create('<div class=\"dropdown-menu note-check\">', function ($node, options) {\n    var markup = $.isArray(options.items) ? options.items.map(function (item) {\n      var value = (typeof item === 'string') ? item : (item.value || '');\n      var content = options.template ? options.template(item) : item;\n      return '<a class=\"dropdown-item\" href=\"#\" data-value=\"' + value + '\">' + icon(options.checkClassName) + ' ' + content + '</a>';\n    }).join('') : options.items;\n    $node.html(markup);\n  });\n\n  var palette = renderer.create('<div class=\"note-color-palette\"/>', function ($node, options) {\n    var contents = [];\n    for (var row = 0, rowSize = options.colors.length; row < rowSize; row++) {\n      var eventName = options.eventName;\n      var colors = options.colors[row];\n      var buttons = [];\n      for (var col = 0, colSize = colors.length; col < colSize; col++) {\n        var color = colors[col];\n        buttons.push([\n          '<button type=\"button\" class=\"note-color-btn\"',\n          'style=\"background-color:', color, '\" ',\n          'data-event=\"', eventName, '\" ',\n          'data-value=\"', color, '\" ',\n          'title=\"', color, '\" ',\n          'data-toggle=\"button\" tabindex=\"-1\"></button>'\n        ].join(''));\n      }\n      contents.push('<div class=\"note-color-row\">' + buttons.join('') + '</div>');\n    }\n    $node.html(contents.join(''));\n\n    if (options.tooltip) {\n      $node.find('.note-color-btn').tooltip({\n        container: 'body',\n        trigger: 'hover',\n        placement: 'bottom'\n      });\n    }\n  });\n\n  var dialog = renderer.create('<div class=\"modal\" aria-hidden=\"false\" tabindex=\"-1\"/>', function ($node, options) {\n    if (options.fade) {\n      $node.addClass('fade');\n    }\n    $node.html([\n      '<div class=\"modal-dialog\">',\n      '  <div class=\"modal-content\">',\n      (options.title ?\n      '    <div class=\"modal-header\">' +\n      '      <h4 class=\"modal-title\">' + options.title + '</h4>' +\n      '      <button type=\"button\" class=\"close\" data-dismiss=\"modal\" aria-label=\"Close\"><span aria-hidden=\"true\">&times;</span></button>' +\n      '    </div>' : ''\n      ),\n      '    <div class=\"modal-body\">' + options.body + '</div>',\n      (options.footer ?\n      '    <div class=\"modal-footer\">' + options.footer + '</div>' : ''\n      ),\n      '  </div>',\n      '</div>'\n    ].join(''));\n  });\n\n  var popover = renderer.create([\n    '<div class=\"note-popover popover in\">',\n    '  <div class=\"arrow\"/>',\n    '  <div class=\"popover-content note-children-container\"/>',\n    '</div>'\n  ].join(''), function ($node, options) {\n    var direction = typeof options.direction !== 'undefined' ? options.direction : 'bottom';\n\n    $node.addClass(direction);\n\n    if (options.hideArrow) {\n      $node.find('.arrow').hide();\n    }\n  });\n\n  var checkbox = renderer.create('<label class=\"custom-control custom-checkbox\"></label>', function ($node, options) {\n      if (options.id) {\n          $node.attr('for', options.id);\n      }\n      $node.html([\n          ' <input type=\"checkbox\" class=\"custom-control-input\"' + (options.id ? ' id=\"' + options.id + '\"' : ''),\n          (options.checked ? ' checked' : '') + '/>',\n          ' <span class=\"custom-control-indicator\"></span>',\n          ' <span class=\"custom-control-description\">' + (options.text ? options.text : '') + '</span>',\n          '</label>'\n      ].join(''));\n  });\n\n  var icon = function (iconClassName, tagName) {\n    tagName = tagName || 'i';\n    return '<' + tagName + ' class=\"' + iconClassName + '\"/>';\n  };\n\n  var ui = {\n    editor: editor,\n    toolbar: toolbar,\n    editingArea: editingArea,\n    codable: codable,\n    editable: editable,\n    statusbar: statusbar,\n    airEditor: airEditor,\n    airEditable: airEditable,\n    buttonGroup: buttonGroup,\n    dropdown: dropdown,\n    dropdownButtonContents: dropdownButtonContents,\n    dropdownCheck: dropdownCheck,\n    palette: palette,\n    dialog: dialog,\n    popover: popover,\n    icon: icon,\n    checkbox:checkbox,\n    options: {},\n\n    button: function ($node, options) {\n      return renderer.create('<button type=\"button\" class=\"note-btn btn btn-light btn-sm\" tabindex=\"-1\">', function ($node, options) {\n        if (options && options.tooltip && self.options.tooltip) {\n          $node.attr({\n            title: options.tooltip\n          }).tooltip({\n            container: 'body',\n            trigger: 'hover',\n            placement: 'bottom'\n          });\n        }\n      })($node, options);\n    },\n\n    toggleBtn: function ($btn, isEnable) {\n      $btn.toggleClass('disabled', !isEnable);\n      $btn.attr('disabled', !isEnable);\n    },\n\n    toggleBtnActive: function ($btn, isActive) {\n      $btn.toggleClass('active', isActive);\n    },\n\n    onDialogShown: function ($dialog, handler) {\n      $dialog.one('shown.bs.modal', handler);\n    },\n\n    onDialogHidden: function ($dialog, handler) {\n      $dialog.one('hidden.bs.modal', handler);\n    },\n\n    showDialog: function ($dialog) {\n      $dialog.modal('show');\n    },\n\n    hideDialog: function ($dialog) {\n      $dialog.modal('hide');\n    },\n\n    createLayout: function ($note, options) {\n      self.options = options;\n      var $editor = (options.airMode ? ui.airEditor([\n        ui.editingArea([\n          ui.airEditable()\n        ])\n      ]) : ui.editor([\n        ui.toolbar(),\n        ui.editingArea([\n          ui.codable(),\n          ui.editable()\n        ]),\n        ui.statusbar()\n      ])).render();\n\n      $editor.insertAfter($note);\n\n      return {\n        note: $note,\n        editor: $editor,\n        toolbar: $editor.find('.note-toolbar'),\n        editingArea: $editor.find('.note-editing-area'),\n        editable: $editor.find('.note-editable'),\n        codable: $editor.find('.note-codable'),\n        statusbar: $editor.find('.note-statusbar')\n      };\n    },\n\n    removeLayout: function ($note, layoutInfo) {\n      $note.html(layoutInfo.editable.html());\n      layoutInfo.editor.remove();\n      $note.show();\n    }\n  };\n\n  $.summernote = $.summernote || {\n    lang: {}\n  };\n\n  $.extend($.summernote.lang, {\n    'en-US': {\n      font: {\n        bold: 'Bold',\n        italic: 'Italic',\n        underline: 'Underline',\n        clear: 'Remove Font Style',\n        height: 'Line Height',\n        name: 'Font Family',\n        strikethrough: 'Strikethrough',\n        subscript: 'Subscript',\n        superscript: 'Superscript',\n        size: 'Font Size'\n      },\n      image: {\n        image: 'Picture',\n        insert: 'Insert Image',\n        resizeFull: 'Resize Full',\n        resizeHalf: 'Resize Half',\n        resizeQuarter: 'Resize Quarter',\n        floatLeft: 'Float Left',\n        floatRight: 'Float Right',\n        floatNone: 'Float None',\n        shapeRounded: 'Shape: Rounded',\n        shapeCircle: 'Shape: Circle',\n        shapeThumbnail: 'Shape: Thumbnail',\n        shapeNone: 'Shape: None',\n        dragImageHere: 'Drag image or text here',\n        dropImage: 'Drop image or Text',\n        selectFromFiles: 'Select from files',\n        maximumFileSize: 'Maximum file size',\n        maximumFileSizeError: 'Maximum file size exceeded.',\n        url: 'Image URL',\n        remove: 'Remove Image'\n      },\n      video: {\n        video: 'Video',\n        videoLink: 'Video Link',\n        insert: 'Insert Video',\n        url: 'Video URL?',\n        providers: '(YouTube, Vimeo, Vine, Instagram, DailyMotion or Youku)'\n      },\n      link: {\n        link: 'Link',\n        insert: 'Insert Link',\n        unlink: 'Unlink',\n        edit: 'Edit',\n        textToDisplay: 'Text to display',\n        url: 'To what URL should this link go?',\n        openInNewWindow: 'Open in new window'\n      },\n      table: {\n        table: 'Table',\n        addRowAbove: 'Add row above',\n        addRowBelow: 'Add row below',\n        addColLeft: 'Add column left',\n        addColRight: 'Add column right',\n        delRow: 'Delete row',\n        delCol: 'Delete column',\n        delTable: 'Delete table'\n      },\n      hr: {\n        insert: 'Insert Horizontal Rule'\n      },\n      style: {\n        style: 'Style',\n        p: 'Normal',\n        blockquote: 'Quote',\n        pre: 'Code',\n        h1: 'Header 1',\n        h2: 'Header 2',\n        h3: 'Header 3',\n        h4: 'Header 4',\n        h5: 'Header 5',\n        h6: 'Header 6'\n      },\n      lists: {\n        unordered: 'Unordered list',\n        ordered: 'Ordered list'\n      },\n      options: {\n        help: 'Help',\n        fullscreen: 'Full Screen',\n        codeview: 'Code View'\n      },\n      paragraph: {\n        paragraph: 'Paragraph',\n        outdent: 'Outdent',\n        indent: 'Indent',\n        left: 'Align left',\n        center: 'Align center',\n        right: 'Align right',\n        justify: 'Justify full'\n      },\n      color: {\n        recent: 'Recent Color',\n        more: 'More Color',\n        background: 'Background Color',\n        foreground: 'Foreground Color',\n        transparent: 'Transparent',\n        setTransparent: 'Set transparent',\n        reset: 'Reset',\n        resetToDefault: 'Reset to default'\n      },\n      shortcut: {\n        shortcuts: 'Keyboard shortcuts',\n        close: 'Close',\n        textFormatting: 'Text formatting',\n        action: 'Action',\n        paragraphFormatting: 'Paragraph formatting',\n        documentStyle: 'Document Style',\n        extraKeys: 'Extra keys'\n      },\n      help: {\n        'insertParagraph': 'Insert Paragraph',\n        'undo': 'Undoes the last command',\n        'redo': 'Redoes the last command',\n        'tab': 'Tab',\n        'untab': 'Untab',\n        'bold': 'Set a bold style',\n        'italic': 'Set a italic style',\n        'underline': 'Set a underline style',\n        'strikethrough': 'Set a strikethrough style',\n        'removeFormat': 'Clean a style',\n        'justifyLeft': 'Set left align',\n        'justifyCenter': 'Set center align',\n        'justifyRight': 'Set right align',\n        'justifyFull': 'Set full align',\n        'insertUnorderedList': 'Toggle unordered list',\n        'insertOrderedList': 'Toggle ordered list',\n        'outdent': 'Outdent on current paragraph',\n        'indent': 'Indent on current paragraph',\n        'formatPara': 'Change current block\\'s format as a paragraph(P tag)',\n        'formatH1': 'Change current block\\'s format as H1',\n        'formatH2': 'Change current block\\'s format as H2',\n        'formatH3': 'Change current block\\'s format as H3',\n        'formatH4': 'Change current block\\'s format as H4',\n        'formatH5': 'Change current block\\'s format as H5',\n        'formatH6': 'Change current block\\'s format as H6',\n        'insertHorizontalRule': 'Insert horizontal rule',\n        'linkDialog.show': 'Show Link Dialog'\n      },\n      history: {\n        undo: 'Undo',\n        redo: 'Redo'\n      },\n      specialChar: {\n        specialChar: 'SPECIAL CHARACTERS',\n        select: 'Select Special characters'\n      }\n    }\n  });\n\n\n  /**\n   * @class core.key\n   *\n   * Object for keycodes.\n   *\n   * @singleton\n   * @alternateClassName key\n   */\n  var key = (function () {\n    var keyMap = {\n      'BACKSPACE': 8,\n      'TAB': 9,\n      'ENTER': 13,\n      'SPACE': 32,\n      'DELETE': 46,\n\n      // Arrow\n      'LEFT': 37,\n      'UP': 38,\n      'RIGHT': 39,\n      'DOWN': 40,\n\n      // Number: 0-9\n      'NUM0': 48,\n      'NUM1': 49,\n      'NUM2': 50,\n      'NUM3': 51,\n      'NUM4': 52,\n      'NUM5': 53,\n      'NUM6': 54,\n      'NUM7': 55,\n      'NUM8': 56,\n\n      // Alphabet: a-z\n      'B': 66,\n      'E': 69,\n      'I': 73,\n      'J': 74,\n      'K': 75,\n      'L': 76,\n      'R': 82,\n      'S': 83,\n      'U': 85,\n      'V': 86,\n      'Y': 89,\n      'Z': 90,\n\n      'SLASH': 191,\n      'LEFTBRACKET': 219,\n      'BACKSLASH': 220,\n      'RIGHTBRACKET': 221\n    };\n\n    return {\n      /**\n       * @method isEdit\n       *\n       * @param {Number} keyCode\n       * @return {Boolean}\n       */\n      isEdit: function (keyCode) {\n        return list.contains([\n          keyMap.BACKSPACE,\n          keyMap.TAB,\n          keyMap.ENTER,\n          keyMap.SPACE,\n          keyMap.DELETE\n        ], keyCode);\n      },\n      /**\n       * @method isMove\n       *\n       * @param {Number} keyCode\n       * @return {Boolean}\n       */\n      isMove: function (keyCode) {\n        return list.contains([\n          keyMap.LEFT,\n          keyMap.UP,\n          keyMap.RIGHT,\n          keyMap.DOWN\n        ], keyCode);\n      },\n      /**\n       * @property {Object} nameFromCode\n       * @property {String} nameFromCode.8 \"BACKSPACE\"\n       */\n      nameFromCode: func.invertObject(keyMap),\n      code: keyMap\n    };\n  })();\n\n  var range = (function () {\n\n    /**\n     * return boundaryPoint from TextRange, inspired by Andy Na's HuskyRange.js\n     *\n     * @param {TextRange} textRange\n     * @param {Boolean} isStart\n     * @return {BoundaryPoint}\n     *\n     * @see http://msdn.microsoft.com/en-us/library/ie/ms535872(v=vs.85).aspx\n     */\n    var textRangeToPoint = function (textRange, isStart) {\n      var container = textRange.parentElement(), offset;\n  \n      var tester = document.body.createTextRange(), prevContainer;\n      var childNodes = list.from(container.childNodes);\n      for (offset = 0; offset < childNodes.length; offset++) {\n        if (dom.isText(childNodes[offset])) {\n          continue;\n        }\n        tester.moveToElementText(childNodes[offset]);\n        if (tester.compareEndPoints('StartToStart', textRange) >= 0) {\n          break;\n        }\n        prevContainer = childNodes[offset];\n      }\n  \n      if (offset !== 0 && dom.isText(childNodes[offset - 1])) {\n        var textRangeStart = document.body.createTextRange(), curTextNode = null;\n        textRangeStart.moveToElementText(prevContainer || container);\n        textRangeStart.collapse(!prevContainer);\n        curTextNode = prevContainer ? prevContainer.nextSibling : container.firstChild;\n  \n        var pointTester = textRange.duplicate();\n        pointTester.setEndPoint('StartToStart', textRangeStart);\n        var textCount = pointTester.text.replace(/[\\r\\n]/g, '').length;\n  \n        while (textCount > curTextNode.nodeValue.length && curTextNode.nextSibling) {\n          textCount -= curTextNode.nodeValue.length;\n          curTextNode = curTextNode.nextSibling;\n        }\n  \n        /* jshint ignore:start */\n        var dummy = curTextNode.nodeValue; // enforce IE to re-reference curTextNode, hack\n        /* jshint ignore:end */\n  \n        if (isStart && curTextNode.nextSibling && dom.isText(curTextNode.nextSibling) &&\n            textCount === curTextNode.nodeValue.length) {\n          textCount -= curTextNode.nodeValue.length;\n          curTextNode = curTextNode.nextSibling;\n        }\n  \n        container = curTextNode;\n        offset = textCount;\n      }\n  \n      return {\n        cont: container,\n        offset: offset\n      };\n    };\n    \n    /**\n     * return TextRange from boundary point (inspired by google closure-library)\n     * @param {BoundaryPoint} point\n     * @return {TextRange}\n     */\n    var pointToTextRange = function (point) {\n      var textRangeInfo = function (container, offset) {\n        var node, isCollapseToStart;\n  \n        if (dom.isText(container)) {\n          var prevTextNodes = dom.listPrev(container, func.not(dom.isText));\n          var prevContainer = list.last(prevTextNodes).previousSibling;\n          node =  prevContainer || container.parentNode;\n          offset += list.sum(list.tail(prevTextNodes), dom.nodeLength);\n          isCollapseToStart = !prevContainer;\n        } else {\n          node = container.childNodes[offset] || container;\n          if (dom.isText(node)) {\n            return textRangeInfo(node, 0);\n          }\n  \n          offset = 0;\n          isCollapseToStart = false;\n        }\n  \n        return {\n          node: node,\n          collapseToStart: isCollapseToStart,\n          offset: offset\n        };\n      };\n  \n      var textRange = document.body.createTextRange();\n      var info = textRangeInfo(point.node, point.offset);\n  \n      textRange.moveToElementText(info.node);\n      textRange.collapse(info.collapseToStart);\n      textRange.moveStart('character', info.offset);\n      return textRange;\n    };\n    \n    /**\n     * Wrapped Range\n     *\n     * @constructor\n     * @param {Node} sc - start container\n     * @param {Number} so - start offset\n     * @param {Node} ec - end container\n     * @param {Number} eo - end offset\n     */\n    var WrappedRange = function (sc, so, ec, eo) {\n      this.sc = sc;\n      this.so = so;\n      this.ec = ec;\n      this.eo = eo;\n  \n      // nativeRange: get nativeRange from sc, so, ec, eo\n      var nativeRange = function () {\n        if (agent.isW3CRangeSupport) {\n          var w3cRange = document.createRange();\n          w3cRange.setStart(sc, so);\n          w3cRange.setEnd(ec, eo);\n\n          return w3cRange;\n        } else {\n          var textRange = pointToTextRange({\n            node: sc,\n            offset: so\n          });\n\n          textRange.setEndPoint('EndToEnd', pointToTextRange({\n            node: ec,\n            offset: eo\n          }));\n\n          return textRange;\n        }\n      };\n\n      this.getPoints = function () {\n        return {\n          sc: sc,\n          so: so,\n          ec: ec,\n          eo: eo\n        };\n      };\n\n      this.getStartPoint = function () {\n        return {\n          node: sc,\n          offset: so\n        };\n      };\n\n      this.getEndPoint = function () {\n        return {\n          node: ec,\n          offset: eo\n        };\n      };\n\n      /**\n       * select update visible range\n       */\n      this.select = function () {\n        var nativeRng = nativeRange();\n        if (agent.isW3CRangeSupport) {\n          var selection = document.getSelection();\n          if (selection.rangeCount > 0) {\n            selection.removeAllRanges();\n          }\n          selection.addRange(nativeRng);\n        } else {\n          nativeRng.select();\n        }\n        \n        return this;\n      };\n\n      /**\n       * Moves the scrollbar to start container(sc) of current range\n       *\n       * @return {WrappedRange}\n       */\n      this.scrollIntoView = function (container) {\n        var height = $(container).height();\n        if (container.scrollTop + height < this.sc.offsetTop) {\n          container.scrollTop += Math.abs(container.scrollTop + height - this.sc.offsetTop);\n        }\n\n        return this;\n      };\n\n      /**\n       * @return {WrappedRange}\n       */\n      this.normalize = function () {\n\n        /**\n         * @param {BoundaryPoint} point\n         * @param {Boolean} isLeftToRight\n         * @return {BoundaryPoint}\n         */\n        var getVisiblePoint = function (point, isLeftToRight) {\n          if ((dom.isVisiblePoint(point) && !dom.isEdgePoint(point)) ||\n              (dom.isVisiblePoint(point) && dom.isRightEdgePoint(point) && !isLeftToRight) ||\n              (dom.isVisiblePoint(point) && dom.isLeftEdgePoint(point) && isLeftToRight) ||\n              (dom.isVisiblePoint(point) && dom.isBlock(point.node) && dom.isEmpty(point.node))) {\n            return point;\n          }\n\n          // point on block's edge\n          var block = dom.ancestor(point.node, dom.isBlock);\n          if (((dom.isLeftEdgePointOf(point, block) || dom.isVoid(dom.prevPoint(point).node)) && !isLeftToRight) ||\n              ((dom.isRightEdgePointOf(point, block) || dom.isVoid(dom.nextPoint(point).node)) && isLeftToRight)) {\n\n            // returns point already on visible point\n            if (dom.isVisiblePoint(point)) {\n              return point;\n            }\n            // reverse direction \n            isLeftToRight = !isLeftToRight;\n          }\n\n          var nextPoint = isLeftToRight ? dom.nextPointUntil(dom.nextPoint(point), dom.isVisiblePoint) :\n                                          dom.prevPointUntil(dom.prevPoint(point), dom.isVisiblePoint);\n          return nextPoint || point;\n        };\n\n        var endPoint = getVisiblePoint(this.getEndPoint(), false);\n        var startPoint = this.isCollapsed() ? endPoint : getVisiblePoint(this.getStartPoint(), true);\n\n        return new WrappedRange(\n          startPoint.node,\n          startPoint.offset,\n          endPoint.node,\n          endPoint.offset\n        );\n      };\n\n      /**\n       * returns matched nodes on range\n       *\n       * @param {Function} [pred] - predicate function\n       * @param {Object} [options]\n       * @param {Boolean} [options.includeAncestor]\n       * @param {Boolean} [options.fullyContains]\n       * @return {Node[]}\n       */\n      this.nodes = function (pred, options) {\n        pred = pred || func.ok;\n\n        var includeAncestor = options && options.includeAncestor;\n        var fullyContains = options && options.fullyContains;\n\n        // TODO compare points and sort\n        var startPoint = this.getStartPoint();\n        var endPoint = this.getEndPoint();\n\n        var nodes = [];\n        var leftEdgeNodes = [];\n\n        dom.walkPoint(startPoint, endPoint, function (point) {\n          if (dom.isEditable(point.node)) {\n            return;\n          }\n\n          var node;\n          if (fullyContains) {\n            if (dom.isLeftEdgePoint(point)) {\n              leftEdgeNodes.push(point.node);\n            }\n            if (dom.isRightEdgePoint(point) && list.contains(leftEdgeNodes, point.node)) {\n              node = point.node;\n            }\n          } else if (includeAncestor) {\n            node = dom.ancestor(point.node, pred);\n          } else {\n            node = point.node;\n          }\n\n          if (node && pred(node)) {\n            nodes.push(node);\n          }\n        }, true);\n\n        return list.unique(nodes);\n      };\n\n      /**\n       * returns commonAncestor of range\n       * @return {Element} - commonAncestor\n       */\n      this.commonAncestor = function () {\n        return dom.commonAncestor(sc, ec);\n      };\n\n      /**\n       * returns expanded range by pred\n       *\n       * @param {Function} pred - predicate function\n       * @return {WrappedRange}\n       */\n      this.expand = function (pred) {\n        var startAncestor = dom.ancestor(sc, pred);\n        var endAncestor = dom.ancestor(ec, pred);\n\n        if (!startAncestor && !endAncestor) {\n          return new WrappedRange(sc, so, ec, eo);\n        }\n\n        var boundaryPoints = this.getPoints();\n\n        if (startAncestor) {\n          boundaryPoints.sc = startAncestor;\n          boundaryPoints.so = 0;\n        }\n\n        if (endAncestor) {\n          boundaryPoints.ec = endAncestor;\n          boundaryPoints.eo = dom.nodeLength(endAncestor);\n        }\n\n        return new WrappedRange(\n          boundaryPoints.sc,\n          boundaryPoints.so,\n          boundaryPoints.ec,\n          boundaryPoints.eo\n        );\n      };\n\n      /**\n       * @param {Boolean} isCollapseToStart\n       * @return {WrappedRange}\n       */\n      this.collapse = function (isCollapseToStart) {\n        if (isCollapseToStart) {\n          return new WrappedRange(sc, so, sc, so);\n        } else {\n          return new WrappedRange(ec, eo, ec, eo);\n        }\n      };\n\n      /**\n       * splitText on range\n       */\n      this.splitText = function () {\n        var isSameContainer = sc === ec;\n        var boundaryPoints = this.getPoints();\n\n        if (dom.isText(ec) && !dom.isEdgePoint(this.getEndPoint())) {\n          ec.splitText(eo);\n        }\n\n        if (dom.isText(sc) && !dom.isEdgePoint(this.getStartPoint())) {\n          boundaryPoints.sc = sc.splitText(so);\n          boundaryPoints.so = 0;\n\n          if (isSameContainer) {\n            boundaryPoints.ec = boundaryPoints.sc;\n            boundaryPoints.eo = eo - so;\n          }\n        }\n\n        return new WrappedRange(\n          boundaryPoints.sc,\n          boundaryPoints.so,\n          boundaryPoints.ec,\n          boundaryPoints.eo\n        );\n      };\n\n      /**\n       * delete contents on range\n       * @return {WrappedRange}\n       */\n      this.deleteContents = function () {\n        if (this.isCollapsed()) {\n          return this;\n        }\n\n        var rng = this.splitText();\n        var nodes = rng.nodes(null, {\n          fullyContains: true\n        });\n\n        // find new cursor point\n        var point = dom.prevPointUntil(rng.getStartPoint(), function (point) {\n          return !list.contains(nodes, point.node);\n        });\n\n        var emptyParents = [];\n        $.each(nodes, function (idx, node) {\n          // find empty parents\n          var parent = node.parentNode;\n          if (point.node !== parent && dom.nodeLength(parent) === 1) {\n            emptyParents.push(parent);\n          }\n          dom.remove(node, false);\n        });\n\n        // remove empty parents\n        $.each(emptyParents, function (idx, node) {\n          dom.remove(node, false);\n        });\n\n        return new WrappedRange(\n          point.node,\n          point.offset,\n          point.node,\n          point.offset\n        ).normalize();\n      };\n      \n      /**\n       * makeIsOn: return isOn(pred) function\n       */\n      var makeIsOn = function (pred) {\n        return function () {\n          var ancestor = dom.ancestor(sc, pred);\n          return !!ancestor && (ancestor === dom.ancestor(ec, pred));\n        };\n      };\n  \n      // isOnEditable: judge whether range is on editable or not\n      this.isOnEditable = makeIsOn(dom.isEditable);\n      // isOnList: judge whether range is on list node or not\n      this.isOnList = makeIsOn(dom.isList);\n      // isOnAnchor: judge whether range is on anchor node or not\n      this.isOnAnchor = makeIsOn(dom.isAnchor);\n      // isOnCell: judge whether range is on cell node or not\n      this.isOnCell = makeIsOn(dom.isCell);\n      // isOnData: judge whether range is on data node or not\n      this.isOnData = makeIsOn(dom.isData);\n\n      /**\n       * @param {Function} pred\n       * @return {Boolean}\n       */\n      this.isLeftEdgeOf = function (pred) {\n        if (!dom.isLeftEdgePoint(this.getStartPoint())) {\n          return false;\n        }\n\n        var node = dom.ancestor(this.sc, pred);\n        return node && dom.isLeftEdgeOf(this.sc, node);\n      };\n\n      /**\n       * returns whether range was collapsed or not\n       */\n      this.isCollapsed = function () {\n        return sc === ec && so === eo;\n      };\n\n      /**\n       * wrap inline nodes which children of body with paragraph\n       *\n       * @return {WrappedRange}\n       */\n      this.wrapBodyInlineWithPara = function () {\n        if (dom.isBodyContainer(sc) && dom.isEmpty(sc)) {\n          sc.innerHTML = dom.emptyPara;\n          return new WrappedRange(sc.firstChild, 0, sc.firstChild, 0);\n        }\n\n        /**\n         * [workaround] firefox often create range on not visible point. so normalize here.\n         *  - firefox: |<p>text</p>|\n         *  - chrome: <p>|text|</p>\n         */\n        var rng = this.normalize();\n        if (dom.isParaInline(sc) || dom.isPara(sc)) {\n          return rng;\n        }\n\n        // find inline top ancestor\n        var topAncestor;\n        if (dom.isInline(rng.sc)) {\n          var ancestors = dom.listAncestor(rng.sc, func.not(dom.isInline));\n          topAncestor = list.last(ancestors);\n          if (!dom.isInline(topAncestor)) {\n            topAncestor = ancestors[ancestors.length - 2] || rng.sc.childNodes[rng.so];\n          }\n        } else {\n          topAncestor = rng.sc.childNodes[rng.so > 0 ? rng.so - 1 : 0];\n        }\n\n        // siblings not in paragraph\n        var inlineSiblings = dom.listPrev(topAncestor, dom.isParaInline).reverse();\n        inlineSiblings = inlineSiblings.concat(dom.listNext(topAncestor.nextSibling, dom.isParaInline));\n\n        // wrap with paragraph\n        if (inlineSiblings.length) {\n          var para = dom.wrap(list.head(inlineSiblings), 'p');\n          dom.appendChildNodes(para, list.tail(inlineSiblings));\n        }\n\n        return this.normalize();\n      };\n\n      /**\n       * insert node at current cursor\n       *\n       * @param {Node} node\n       * @return {Node}\n       */\n      this.insertNode = function (node) {\n        var rng = this.wrapBodyInlineWithPara().deleteContents();\n        var info = dom.splitPoint(rng.getStartPoint(), dom.isInline(node));\n\n        if (info.rightNode) {\n          info.rightNode.parentNode.insertBefore(node, info.rightNode);\n        } else {\n          info.container.appendChild(node);\n        }\n\n        return node;\n      };\n\n      /**\n       * insert html at current cursor\n       */\n      this.pasteHTML = function (markup) {\n        var contentsContainer = $('<div></div>').html(markup)[0];\n        var childNodes = list.from(contentsContainer.childNodes);\n\n        var rng = this.wrapBodyInlineWithPara().deleteContents();\n\n        return childNodes.reverse().map(function (childNode) {\n          return rng.insertNode(childNode);\n        }).reverse();\n      };\n  \n      /**\n       * returns text in range\n       *\n       * @return {String}\n       */\n      this.toString = function () {\n        var nativeRng = nativeRange();\n        return agent.isW3CRangeSupport ? nativeRng.toString() : nativeRng.text;\n      };\n\n      /**\n       * returns range for word before cursor\n       *\n       * @param {Boolean} [findAfter] - find after cursor, default: false\n       * @return {WrappedRange}\n       */\n      this.getWordRange = function (findAfter) {\n        var endPoint = this.getEndPoint();\n\n        if (!dom.isCharPoint(endPoint)) {\n          return this;\n        }\n\n        var startPoint = dom.prevPointUntil(endPoint, function (point) {\n          return !dom.isCharPoint(point);\n        });\n\n        if (findAfter) {\n          endPoint = dom.nextPointUntil(endPoint, function (point) {\n            return !dom.isCharPoint(point);\n          });\n        }\n\n        return new WrappedRange(\n          startPoint.node,\n          startPoint.offset,\n          endPoint.node,\n          endPoint.offset\n        );\n      };\n  \n      /**\n       * create offsetPath bookmark\n       *\n       * @param {Node} editable\n       */\n      this.bookmark = function (editable) {\n        return {\n          s: {\n            path: dom.makeOffsetPath(editable, sc),\n            offset: so\n          },\n          e: {\n            path: dom.makeOffsetPath(editable, ec),\n            offset: eo\n          }\n        };\n      };\n\n      /**\n       * create offsetPath bookmark base on paragraph\n       *\n       * @param {Node[]} paras\n       */\n      this.paraBookmark = function (paras) {\n        return {\n          s: {\n            path: list.tail(dom.makeOffsetPath(list.head(paras), sc)),\n            offset: so\n          },\n          e: {\n            path: list.tail(dom.makeOffsetPath(list.last(paras), ec)),\n            offset: eo\n          }\n        };\n      };\n\n      /**\n       * getClientRects\n       * @return {Rect[]}\n       */\n      this.getClientRects = function () {\n        var nativeRng = nativeRange();\n        return nativeRng.getClientRects();\n      };\n    };\n\n  /**\n   * @class core.range\n   *\n   * Data structure\n   *  * BoundaryPoint: a point of dom tree\n   *  * BoundaryPoints: two boundaryPoints corresponding to the start and the end of the Range\n   *\n   * See to http://www.w3.org/TR/DOM-Level-2-Traversal-Range/ranges.html#Level-2-Range-Position\n   *\n   * @singleton\n   * @alternateClassName range\n   */\n    return {\n      /**\n       * create Range Object From arguments or Browser Selection\n       *\n       * @param {Node} sc - start container\n       * @param {Number} so - start offset\n       * @param {Node} ec - end container\n       * @param {Number} eo - end offset\n       * @return {WrappedRange}\n       */\n      create: function (sc, so, ec, eo) {\n        if (arguments.length === 4) {\n          return new WrappedRange(sc, so, ec, eo);\n        } else if (arguments.length === 2) { //collapsed\n          ec = sc;\n          eo = so;\n          return new WrappedRange(sc, so, ec, eo);\n        } else {\n          var wrappedRange = this.createFromSelection();\n          if (!wrappedRange && arguments.length === 1) {\n            wrappedRange = this.createFromNode(arguments[0]);\n            return wrappedRange.collapse(dom.emptyPara === arguments[0].innerHTML);\n          }\n          return wrappedRange;\n        }\n      },\n\n      createFromSelection: function () {\n        var sc, so, ec, eo;\n        if (agent.isW3CRangeSupport) {\n          var selection = document.getSelection();\n          if (!selection || selection.rangeCount === 0) {\n            return null;\n          } else if (dom.isBody(selection.anchorNode)) {\n            // Firefox: returns entire body as range on initialization.\n            // We won't never need it.\n            return null;\n          }\n\n          var nativeRng = selection.getRangeAt(0);\n          sc = nativeRng.startContainer;\n          so = nativeRng.startOffset;\n          ec = nativeRng.endContainer;\n          eo = nativeRng.endOffset;\n        } else { // IE8: TextRange\n          var textRange = document.selection.createRange();\n          var textRangeEnd = textRange.duplicate();\n          textRangeEnd.collapse(false);\n          var textRangeStart = textRange;\n          textRangeStart.collapse(true);\n\n          var startPoint = textRangeToPoint(textRangeStart, true),\n          endPoint = textRangeToPoint(textRangeEnd, false);\n\n          // same visible point case: range was collapsed.\n          if (dom.isText(startPoint.node) && dom.isLeftEdgePoint(startPoint) &&\n              dom.isTextNode(endPoint.node) && dom.isRightEdgePoint(endPoint) &&\n              endPoint.node.nextSibling === startPoint.node) {\n            startPoint = endPoint;\n          }\n\n          sc = startPoint.cont;\n          so = startPoint.offset;\n          ec = endPoint.cont;\n          eo = endPoint.offset;\n        }\n\n        return new WrappedRange(sc, so, ec, eo);\n      },\n\n      /**\n       * @method \n       * \n       * create WrappedRange from node\n       *\n       * @param {Node} node\n       * @return {WrappedRange}\n       */\n      createFromNode: function (node) {\n        var sc = node;\n        var so = 0;\n        var ec = node;\n        var eo = dom.nodeLength(ec);\n\n        // browsers can't target a picture or void node\n        if (dom.isVoid(sc)) {\n          so = dom.listPrev(sc).length - 1;\n          sc = sc.parentNode;\n        }\n        if (dom.isBR(ec)) {\n          eo = dom.listPrev(ec).length - 1;\n          ec = ec.parentNode;\n        } else if (dom.isVoid(ec)) {\n          eo = dom.listPrev(ec).length;\n          ec = ec.parentNode;\n        }\n\n        return this.create(sc, so, ec, eo);\n      },\n\n      /**\n       * create WrappedRange from node after position\n       *\n       * @param {Node} node\n       * @return {WrappedRange}\n       */\n      createFromNodeBefore: function (node) {\n        return this.createFromNode(node).collapse(true);\n      },\n\n      /**\n       * create WrappedRange from node after position\n       *\n       * @param {Node} node\n       * @return {WrappedRange}\n       */\n      createFromNodeAfter: function (node) {\n        return this.createFromNode(node).collapse();\n      },\n\n      /**\n       * @method \n       * \n       * create WrappedRange from bookmark\n       *\n       * @param {Node} editable\n       * @param {Object} bookmark\n       * @return {WrappedRange}\n       */\n      createFromBookmark: function (editable, bookmark) {\n        var sc = dom.fromOffsetPath(editable, bookmark.s.path);\n        var so = bookmark.s.offset;\n        var ec = dom.fromOffsetPath(editable, bookmark.e.path);\n        var eo = bookmark.e.offset;\n        return new WrappedRange(sc, so, ec, eo);\n      },\n\n      /**\n       * @method \n       *\n       * create WrappedRange from paraBookmark\n       *\n       * @param {Object} bookmark\n       * @param {Node[]} paras\n       * @return {WrappedRange}\n       */\n      createFromParaBookmark: function (bookmark, paras) {\n        var so = bookmark.s.offset;\n        var eo = bookmark.e.offset;\n        var sc = dom.fromOffsetPath(list.head(paras), bookmark.s.path);\n        var ec = dom.fromOffsetPath(list.last(paras), bookmark.e.path);\n\n        return new WrappedRange(sc, so, ec, eo);\n      }\n    };\n  })();\n\n  /**\n   * @class core.async\n   *\n   * Async functions which returns `Promise`\n   *\n   * @singleton\n   * @alternateClassName async\n   */\n  var async = (function () {\n    /**\n     * @method readFileAsDataURL\n     *\n     * read contents of file as representing URL\n     *\n     * @param {File} file\n     * @return {Promise} - then: dataUrl\n     */\n    var readFileAsDataURL = function (file) {\n      return $.Deferred(function (deferred) {\n        $.extend(new FileReader(), {\n          onload: function (e) {\n            var dataURL = e.target.result;\n            deferred.resolve(dataURL);\n          },\n          onerror: function () {\n            deferred.reject(this);\n          }\n        }).readAsDataURL(file);\n      }).promise();\n    };\n  \n    /**\n     * @method createImage\n     *\n     * create `<image>` from url string\n     *\n     * @param {String} url\n     * @return {Promise} - then: $image\n     */\n    var createImage = function (url) {\n      return $.Deferred(function (deferred) {\n        var $img = $('<img>');\n\n        $img.one('load', function () {\n          $img.off('error abort');\n          deferred.resolve($img);\n        }).one('error abort', function () {\n          $img.off('load').detach();\n          deferred.reject($img);\n        }).css({\n          display: 'none'\n        }).appendTo(document.body).attr('src', url);\n      }).promise();\n    };\n\n    return {\n      readFileAsDataURL: readFileAsDataURL,\n      createImage: createImage\n    };\n  })();\n\n  /**\n   * @class editing.History\n   *\n   * Editor History\n   *\n   */\n  var History = function ($editable) {\n    var stack = [], stackOffset = -1;\n    var editable = $editable[0];\n\n    var makeSnapshot = function () {\n      var rng = range.create(editable);\n      var emptyBookmark = {s: {path: [], offset: 0}, e: {path: [], offset: 0}};\n\n      return {\n        contents: $editable.html(),\n        bookmark: (rng ? rng.bookmark(editable) : emptyBookmark)\n      };\n    };\n\n    var applySnapshot = function (snapshot) {\n      if (snapshot.contents !== null) {\n        $editable.html(snapshot.contents);\n      }\n      if (snapshot.bookmark !== null) {\n        range.createFromBookmark(editable, snapshot.bookmark).select();\n      }\n    };\n\n    /**\n    * @method rewind\n    * Rewinds the history stack back to the first snapshot taken.\n    * Leaves the stack intact, so that \"Redo\" can still be used.\n    */\n    this.rewind = function () {\n      // Create snap shot if not yet recorded\n      if ($editable.html() !== stack[stackOffset].contents) {\n        this.recordUndo();\n      }\n\n      // Return to the first available snapshot.\n      stackOffset = 0;\n\n      // Apply that snapshot.\n      applySnapshot(stack[stackOffset]);\n    };\n\n    /**\n    * @method reset\n    * Resets the history stack completely; reverting to an empty editor.\n    */\n    this.reset = function () {\n      // Clear the stack.\n      stack = [];\n\n      // Restore stackOffset to its original value.\n      stackOffset = -1;\n\n      // Clear the editable area.\n      $editable.html('');\n\n      // Record our first snapshot (of nothing).\n      this.recordUndo();\n    };\n\n    /**\n     * undo\n     */\n    this.undo = function () {\n      // Create snap shot if not yet recorded\n      if ($editable.html() !== stack[stackOffset].contents) {\n        this.recordUndo();\n      }\n\n      if (0 < stackOffset) {\n        stackOffset--;\n        applySnapshot(stack[stackOffset]);\n      }\n    };\n\n    /**\n     * redo\n     */\n    this.redo = function () {\n      if (stack.length - 1 > stackOffset) {\n        stackOffset++;\n        applySnapshot(stack[stackOffset]);\n      }\n    };\n\n    /**\n     * recorded undo\n     */\n    this.recordUndo = function () {\n      stackOffset++;\n\n      // Wash out stack after stackOffset\n      if (stack.length > stackOffset) {\n        stack = stack.slice(0, stackOffset);\n      }\n\n      // Create new snapshot and push it to the end\n      stack.push(makeSnapshot());\n    };\n  };\n\n  /**\n   * @class editing.Style\n   *\n   * Style\n   *\n   */\n  var Style = function () {\n    /**\n     * @method jQueryCSS\n     *\n     * [workaround] for old jQuery\n     * passing an array of style properties to .css()\n     * will result in an object of property-value pairs.\n     * (compability with version < 1.9)\n     *\n     * @private\n     * @param  {jQuery} $obj\n     * @param  {Array} propertyNames - An array of one or more CSS properties.\n     * @return {Object}\n     */\n    var jQueryCSS = function ($obj, propertyNames) {\n      if (agent.jqueryVersion < 1.9) {\n        var result = {};\n        $.each(propertyNames, function (idx, propertyName) {\n          result[propertyName] = $obj.css(propertyName);\n        });\n        return result;\n      }\n      return $obj.css.call($obj, propertyNames);\n    };\n\n    /**\n     * returns style object from node\n     *\n     * @param {jQuery} $node\n     * @return {Object}\n     */\n    this.fromNode = function ($node) {\n      var properties = ['font-family', 'font-size', 'text-align', 'list-style-type', 'line-height'];\n      var styleInfo = jQueryCSS($node, properties) || {};\n      styleInfo['font-size'] = parseInt(styleInfo['font-size'], 10);\n      return styleInfo;\n    };\n\n    /**\n     * paragraph level style\n     *\n     * @param {WrappedRange} rng\n     * @param {Object} styleInfo\n     */\n    this.stylePara = function (rng, styleInfo) {\n      $.each(rng.nodes(dom.isPara, {\n        includeAncestor: true\n      }), function (idx, para) {\n        $(para).css(styleInfo);\n      });\n    };\n\n    /**\n     * insert and returns styleNodes on range.\n     *\n     * @param {WrappedRange} rng\n     * @param {Object} [options] - options for styleNodes\n     * @param {String} [options.nodeName] - default: `SPAN`\n     * @param {Boolean} [options.expandClosestSibling] - default: `false`\n     * @param {Boolean} [options.onlyPartialContains] - default: `false`\n     * @return {Node[]}\n     */\n    this.styleNodes = function (rng, options) {\n      rng = rng.splitText();\n\n      var nodeName = options && options.nodeName || 'SPAN';\n      var expandClosestSibling = !!(options && options.expandClosestSibling);\n      var onlyPartialContains = !!(options && options.onlyPartialContains);\n\n      if (rng.isCollapsed()) {\n        return [rng.insertNode(dom.create(nodeName))];\n      }\n\n      var pred = dom.makePredByNodeName(nodeName);\n      var nodes = rng.nodes(dom.isText, {\n        fullyContains: true\n      }).map(function (text) {\n        return dom.singleChildAncestor(text, pred) || dom.wrap(text, nodeName);\n      });\n\n      if (expandClosestSibling) {\n        if (onlyPartialContains) {\n          var nodesInRange = rng.nodes();\n          // compose with partial contains predication\n          pred = func.and(pred, function (node) {\n            return list.contains(nodesInRange, node);\n          });\n        }\n\n        return nodes.map(function (node) {\n          var siblings = dom.withClosestSiblings(node, pred);\n          var head = list.head(siblings);\n          var tails = list.tail(siblings);\n          $.each(tails, function (idx, elem) {\n            dom.appendChildNodes(head, elem.childNodes);\n            dom.remove(elem);\n          });\n          return list.head(siblings);\n        });\n      } else {\n        return nodes;\n      }\n    };\n\n    /**\n     * get current style on cursor\n     *\n     * @param {WrappedRange} rng\n     * @return {Object} - object contains style properties.\n     */\n    this.current = function (rng) {\n      var $cont = $(!dom.isElement(rng.sc) ? rng.sc.parentNode : rng.sc);\n      var styleInfo = this.fromNode($cont);\n\n      // document.queryCommandState for toggle state\n      // [workaround] prevent Firefox nsresult: \"0x80004005 (NS_ERROR_FAILURE)\"\n      try {\n        styleInfo = $.extend(styleInfo, {\n          'font-bold': document.queryCommandState('bold') ? 'bold' : 'normal',\n          'font-italic': document.queryCommandState('italic') ? 'italic' : 'normal',\n          'font-underline': document.queryCommandState('underline') ? 'underline' : 'normal',\n          'font-subscript': document.queryCommandState('subscript') ? 'subscript' : 'normal',\n          'font-superscript': document.queryCommandState('superscript') ? 'superscript' : 'normal',\n          'font-strikethrough': document.queryCommandState('strikethrough') ? 'strikethrough' : 'normal',\n          'font-family': document.queryCommandValue('fontname') || styleInfo['font-family']\n        });\n      } catch (e) {}\n\n      // list-style-type to list-style(unordered, ordered)\n      if (!rng.isOnList()) {\n        styleInfo['list-style'] = 'none';\n      } else {\n        var orderedTypes = ['circle', 'disc', 'disc-leading-zero', 'square'];\n        var isUnordered = $.inArray(styleInfo['list-style-type'], orderedTypes) > -1;\n        styleInfo['list-style'] = isUnordered ? 'unordered' : 'ordered';\n      }\n\n      var para = dom.ancestor(rng.sc, dom.isPara);\n      if (para && para.style['line-height']) {\n        styleInfo['line-height'] = para.style.lineHeight;\n      } else {\n        var lineHeight = parseInt(styleInfo['line-height'], 10) / parseInt(styleInfo['font-size'], 10);\n        styleInfo['line-height'] = lineHeight.toFixed(1);\n      }\n\n      styleInfo.anchor = rng.isOnAnchor() && dom.ancestor(rng.sc, dom.isAnchor);\n      styleInfo.ancestors = dom.listAncestor(rng.sc, dom.isEditable);\n      styleInfo.range = rng;\n\n      return styleInfo;\n    };\n  };\n\n\n  /**\n   * @class editing.Bullet\n   *\n   * @alternateClassName Bullet\n   */\n  var Bullet = function () {\n    var self = this;\n\n    /**\n     * toggle ordered list\n     */\n    this.insertOrderedList = function (editable) {\n      this.toggleList('OL', editable);\n    };\n\n    /**\n     * toggle unordered list\n     */\n    this.insertUnorderedList = function (editable) {\n      this.toggleList('UL', editable);\n    };\n\n    /**\n     * indent\n     */\n    this.indent = function (editable) {\n      var self = this;\n      var rng = range.create(editable).wrapBodyInlineWithPara();\n\n      var paras = rng.nodes(dom.isPara, { includeAncestor: true });\n      var clustereds = list.clusterBy(paras, func.peq2('parentNode'));\n\n      $.each(clustereds, function (idx, paras) {\n        var head = list.head(paras);\n        if (dom.isLi(head)) {\n          self.wrapList(paras, head.parentNode.nodeName);\n        } else {\n          $.each(paras, function (idx, para) {\n            $(para).css('marginLeft', function (idx, val) {\n              return (parseInt(val, 10) || 0) + 25;\n            });\n          });\n        }\n      });\n\n      rng.select();\n    };\n\n    /**\n     * outdent\n     */\n    this.outdent = function (editable) {\n      var self = this;\n      var rng = range.create(editable).wrapBodyInlineWithPara();\n\n      var paras = rng.nodes(dom.isPara, { includeAncestor: true });\n      var clustereds = list.clusterBy(paras, func.peq2('parentNode'));\n\n      $.each(clustereds, function (idx, paras) {\n        var head = list.head(paras);\n        if (dom.isLi(head)) {\n          self.releaseList([paras]);\n        } else {\n          $.each(paras, function (idx, para) {\n            $(para).css('marginLeft', function (idx, val) {\n              val = (parseInt(val, 10) || 0);\n              return val > 25 ? val - 25 : '';\n            });\n          });\n        }\n      });\n\n      rng.select();\n    };\n\n    /**\n     * toggle list\n     *\n     * @param {String} listName - OL or UL\n     */\n    this.toggleList = function (listName, editable) {\n      var rng = range.create(editable).wrapBodyInlineWithPara();\n\n      var paras = rng.nodes(dom.isPara, { includeAncestor: true });\n      var bookmark = rng.paraBookmark(paras);\n      var clustereds = list.clusterBy(paras, func.peq2('parentNode'));\n\n      // paragraph to list\n      if (list.find(paras, dom.isPurePara)) {\n        var wrappedParas = [];\n        $.each(clustereds, function (idx, paras) {\n          wrappedParas = wrappedParas.concat(self.wrapList(paras, listName));\n        });\n        paras = wrappedParas;\n      // list to paragraph or change list style\n      } else {\n        var diffLists = rng.nodes(dom.isList, {\n          includeAncestor: true\n        }).filter(function (listNode) {\n          return !$.nodeName(listNode, listName);\n        });\n\n        if (diffLists.length) {\n          $.each(diffLists, function (idx, listNode) {\n            dom.replace(listNode, listName);\n          });\n        } else {\n          paras = this.releaseList(clustereds, true);\n        }\n      }\n\n      range.createFromParaBookmark(bookmark, paras).select();\n    };\n\n    /**\n     * @param {Node[]} paras\n     * @param {String} listName\n     * @return {Node[]}\n     */\n    this.wrapList = function (paras, listName) {\n      var head = list.head(paras);\n      var last = list.last(paras);\n\n      var prevList = dom.isList(head.previousSibling) && head.previousSibling;\n      var nextList = dom.isList(last.nextSibling) && last.nextSibling;\n\n      var listNode = prevList || dom.insertAfter(dom.create(listName || 'UL'), last);\n\n      // P to LI\n      paras = paras.map(function (para) {\n        return dom.isPurePara(para) ? dom.replace(para, 'LI') : para;\n      });\n\n      // append to list(<ul>, <ol>)\n      dom.appendChildNodes(listNode, paras);\n\n      if (nextList) {\n        dom.appendChildNodes(listNode, list.from(nextList.childNodes));\n        dom.remove(nextList);\n      }\n\n      return paras;\n    };\n\n    /**\n     * @method releaseList\n     *\n     * @param {Array[]} clustereds\n     * @param {Boolean} isEscapseToBody\n     * @return {Node[]}\n     */\n    this.releaseList = function (clustereds, isEscapseToBody) {\n      var releasedParas = [];\n\n      $.each(clustereds, function (idx, paras) {\n        var head = list.head(paras);\n        var last = list.last(paras);\n\n        var headList = isEscapseToBody ? dom.lastAncestor(head, dom.isList) :\n                                         head.parentNode;\n        var lastList = headList.childNodes.length > 1 ? dom.splitTree(headList, {\n          node: last.parentNode,\n          offset: dom.position(last) + 1\n        }, {\n          isSkipPaddingBlankHTML: true\n        }) : null;\n\n        var middleList = dom.splitTree(headList, {\n          node: head.parentNode,\n          offset: dom.position(head)\n        }, {\n          isSkipPaddingBlankHTML: true\n        });\n\n        paras = isEscapseToBody ? dom.listDescendant(middleList, dom.isLi) :\n                                  list.from(middleList.childNodes).filter(dom.isLi);\n\n        // LI to P\n        if (isEscapseToBody || !dom.isList(headList.parentNode)) {\n          paras = paras.map(function (para) {\n            return dom.replace(para, 'P');\n          });\n        }\n\n        $.each(list.from(paras).reverse(), function (idx, para) {\n          dom.insertAfter(para, headList);\n        });\n\n        // remove empty lists\n        var rootLists = list.compact([headList, middleList, lastList]);\n        $.each(rootLists, function (idx, rootList) {\n          var listNodes = [rootList].concat(dom.listDescendant(rootList, dom.isList));\n          $.each(listNodes.reverse(), function (idx, listNode) {\n            if (!dom.nodeLength(listNode)) {\n              dom.remove(listNode, true);\n            }\n          });\n        });\n\n        releasedParas = releasedParas.concat(paras);\n      });\n\n      return releasedParas;\n    };\n  };\n\n\n  /**\n   * @class editing.Typing\n   *\n   * Typing\n   *\n   */\n  var Typing = function () {\n\n    // a Bullet instance to toggle lists off\n    var bullet = new Bullet();\n\n    /**\n     * insert tab\n     *\n     * @param {WrappedRange} rng\n     * @param {Number} tabsize\n     */\n    this.insertTab = function (rng, tabsize) {\n      var tab = dom.createText(new Array(tabsize + 1).join(dom.NBSP_CHAR));\n      rng = rng.deleteContents();\n      rng.insertNode(tab, true);\n\n      rng = range.create(tab, tabsize);\n      rng.select();\n    };\n\n    /**\n     * insert paragraph\n     */\n    this.insertParagraph = function (editable) {\n      var rng = range.create(editable);\n\n      // deleteContents on range.\n      rng = rng.deleteContents();\n\n      // Wrap range if it needs to be wrapped by paragraph\n      rng = rng.wrapBodyInlineWithPara();\n\n      // finding paragraph\n      var splitRoot = dom.ancestor(rng.sc, dom.isPara);\n\n      var nextPara;\n      // on paragraph: split paragraph\n      if (splitRoot) {\n        // if it is an empty line with li\n        if (dom.isEmpty(splitRoot) && dom.isLi(splitRoot)) {\n          // toogle UL/OL and escape\n          bullet.toggleList(splitRoot.parentNode.nodeName);\n          return;\n        // if it is an empty line with para on blockquote\n        } else if (dom.isEmpty(splitRoot) && dom.isPara(splitRoot) && dom.isBlockquote(splitRoot.parentNode)) {\n          // escape blockquote\n          dom.insertAfter(splitRoot, splitRoot.parentNode);\n          nextPara = splitRoot;\n        // if new line has content (not a line break)\n        } else {\n          nextPara = dom.splitTree(splitRoot, rng.getStartPoint());\n\n          var emptyAnchors = dom.listDescendant(splitRoot, dom.isEmptyAnchor);\n          emptyAnchors = emptyAnchors.concat(dom.listDescendant(nextPara, dom.isEmptyAnchor));\n\n          $.each(emptyAnchors, function (idx, anchor) {\n            dom.remove(anchor);\n          });\n\n          // replace empty heading, pre or custom-made styleTag with P tag\n          if ((dom.isHeading(nextPara) || dom.isPre(nextPara) || dom.isCustomStyleTag(nextPara)) && dom.isEmpty(nextPara)) {\n            nextPara = dom.replace(nextPara, 'p');\n          }\n        }\n      // no paragraph: insert empty paragraph\n      } else {\n        var next = rng.sc.childNodes[rng.so];\n        nextPara = $(dom.emptyPara)[0];\n        if (next) {\n          rng.sc.insertBefore(nextPara, next);\n        } else {\n          rng.sc.appendChild(nextPara);\n        }\n      }\n\n      range.create(nextPara, 0).normalize().select().scrollIntoView(editable);\n    };\n  };\n\n\n  /**\n   * @class Create a virtual table to create what actions to do in change.\n   * @param {object} startPoint Cell selected to apply change.\n   * @param {enum} where  Where change will be applied Row or Col. Use enum: TableResultAction.where\n   * @param {enum} action Action to be applied. Use enum: TableResultAction.requestAction\n   * @param {object} domTable Dom element of table to make changes.\n   */\n  var TableResultAction = function (startPoint, where, action, domTable) {\n    var _startPoint = { 'colPos': 0, 'rowPos': 0 };\n    var _virtualTable = [];\n    var _actionCellList = [];\n\n    //////////////////////////////////////////////\n    // Private functions\n    //////////////////////////////////////////////\n\n    /**\n     * Set the startPoint of action.\n     */\n    function setStartPoint() {\n      if (!startPoint || !startPoint.tagName || (startPoint.tagName.toLowerCase() !== 'td' && startPoint.tagName.toLowerCase() !== 'th')) {\n        console.error('Impossible to identify start Cell point.', startPoint);\n        return;\n      }\n      _startPoint.colPos = startPoint.cellIndex;\n      if (!startPoint.parentElement || !startPoint.parentElement.tagName || startPoint.parentElement.tagName.toLowerCase() !== 'tr') {\n        console.error('Impossible to identify start Row point.', startPoint);\n        return;\n      }\n      _startPoint.rowPos = startPoint.parentElement.rowIndex;\n    }\n\n    /**\n     * Define virtual table position info object.\n     * \n     * @param {int} rowIndex Index position in line of virtual table.\n     * @param {int} cellIndex Index position in column of virtual table.\n     * @param {object} baseRow Row affected by this position.\n     * @param {object} baseCell Cell affected by this position.\n     * @param {bool} isSpan Inform if it is an span cell/row.\n     */\n    function setVirtualTablePosition(rowIndex, cellIndex, baseRow, baseCell, isRowSpan, isColSpan, isVirtualCell) {\n      var objPosition = {\n        'baseRow': baseRow,\n        'baseCell': baseCell,\n        'isRowSpan': isRowSpan,\n        'isColSpan': isColSpan,\n        'isVirtual': isVirtualCell\n      };\n      if (!_virtualTable[rowIndex]) {\n        _virtualTable[rowIndex] = [];\n      }\n      _virtualTable[rowIndex][cellIndex] = objPosition;\n    }\n\n    /**\n     * Create action cell object.\n     * \n     * @param {object} virtualTableCellObj Object of specific position on virtual table.\n     * @param {enum} resultAction Action to be applied in that item.\n     */\n    function getActionCell(virtualTableCellObj, resultAction, virtualRowPosition, virtualColPosition) {\n      return {\n        'baseCell': virtualTableCellObj.baseCell,\n        'action': resultAction,\n        'virtualTable': {\n          'rowIndex': virtualRowPosition,\n          'cellIndex': virtualColPosition\n        }\n      };\n    }\n\n    /**\n     * Recover free index of row to append Cell.\n     * \n     * @param {int} rowIndex Index of row to find free space.\n     * @param {int} cellIndex Index of cell to find free space in table.\n     */\n    function recoverCellIndex(rowIndex, cellIndex) {\n      if (!_virtualTable[rowIndex]) {\n        return cellIndex;\n      }\n      if (!_virtualTable[rowIndex][cellIndex]) {\n        return cellIndex;\n      }\n\n      var newCellIndex = cellIndex;\n      while (_virtualTable[rowIndex][newCellIndex]) {\n        newCellIndex++;\n        if (!_virtualTable[rowIndex][newCellIndex]) {\n          return newCellIndex;\n        }\n      }\n    }\n\n    /**\n     * Recover info about row and cell and add information to virtual table.\n     * \n     * @param {object} row Row to recover information.\n     * @param {object} cell Cell to recover information.\n     */\n    function addCellInfoToVirtual(row, cell) {\n      var cellIndex = recoverCellIndex(row.rowIndex, cell.cellIndex);\n      var cellHasColspan = (cell.colSpan > 1);\n      var cellHasRowspan = (cell.rowSpan > 1);\n      var isThisSelectedCell = (row.rowIndex === _startPoint.rowPos && cell.cellIndex === _startPoint.colPos);\n      setVirtualTablePosition(row.rowIndex, cellIndex, row, cell, cellHasRowspan, cellHasColspan, false);\n\n      // Add span rows to virtual Table.\n      var rowspanNumber = cell.attributes.rowSpan ? parseInt(cell.attributes.rowSpan.value, 10) : 0;\n      if (rowspanNumber > 1) {\n        for (var rp = 1; rp < rowspanNumber; rp++) {\n          var rowspanIndex = row.rowIndex + rp;\n          adjustStartPoint(rowspanIndex, cellIndex, cell, isThisSelectedCell);\n          setVirtualTablePosition(rowspanIndex, cellIndex, row, cell, true, cellHasColspan, true);\n        }\n      }\n\n      // Add span cols to virtual table.\n      var colspanNumber = cell.attributes.colSpan ? parseInt(cell.attributes.colSpan.value, 10) : 0;\n      if (colspanNumber > 1) {\n        for (var cp = 1; cp < colspanNumber; cp++) {\n          var cellspanIndex = recoverCellIndex(row.rowIndex, (cellIndex + cp));\n          adjustStartPoint(row.rowIndex, cellspanIndex, cell, isThisSelectedCell);\n          setVirtualTablePosition(row.rowIndex, cellspanIndex, row, cell, cellHasRowspan, true, true);\n        }\n      }\n    }\n\n    /**\n     * Process validation and adjust of start point if needed\n     * \n     * @param {int} rowIndex \n     * @param {int} cellIndex \n     * @param {object} cell \n     * @param {bool} isSelectedCell \n     */\n    function adjustStartPoint(rowIndex, cellIndex, cell, isSelectedCell) {\n      if (rowIndex === _startPoint.rowPos && _startPoint.colPos >= cell.cellIndex && cell.cellIndex <= cellIndex && !isSelectedCell) {\n        _startPoint.colPos++;\n      }\n    }\n\n    /**\n     * Create virtual table of cells with all cells, including span cells.\n     */\n    function createVirtualTable() {\n      var rows = domTable.rows;\n      for (var rowIndex = 0; rowIndex < rows.length; rowIndex++) {\n        var cells = rows[rowIndex].cells;\n        for (var cellIndex = 0; cellIndex < cells.length; cellIndex++) {\n          addCellInfoToVirtual(rows[rowIndex], cells[cellIndex]);\n        }\n      }\n    }\n\n    /**\n     * Get action to be applied on the cell.\n     * \n     * @param {object} cell virtual table cell to apply action\n     */\n    function getDeleteResultActionToCell(cell) {\n      switch (where) {\n        case TableResultAction.where.Column:\n          if (cell.isColSpan) {\n            return TableResultAction.resultAction.SubtractSpanCount;\n          }\n          break;\n        case TableResultAction.where.Row:\n          if (!cell.isVirtual && cell.isRowSpan) {\n            return TableResultAction.resultAction.AddCell;\n          }\n          else if (cell.isRowSpan) {\n            return TableResultAction.resultAction.SubtractSpanCount;\n          }\n          break;\n      }\n      return TableResultAction.resultAction.RemoveCell;\n    }\n\n    /**\n     * Get action to be applied on the cell.\n     * \n     * @param {object} cell virtual table cell to apply action\n     */\n    function getAddResultActionToCell(cell) {\n      switch (where) {\n        case TableResultAction.where.Column:\n          if (cell.isColSpan) {\n            return TableResultAction.resultAction.SumSpanCount;\n          } else if (cell.isRowSpan && cell.isVirtual) {\n            return TableResultAction.resultAction.Ignore;\n          }\n          break;\n        case TableResultAction.where.Row:\n          if (cell.isRowSpan) {\n            return TableResultAction.resultAction.SumSpanCount;\n          } else if (cell.isColSpan && cell.isVirtual) {\n            return TableResultAction.resultAction.Ignore;\n          }\n          break;\n      }\n      return TableResultAction.resultAction.AddCell;\n    }\n\n    function init() {\n      setStartPoint();\n      createVirtualTable();\n    }\n\n    //////////////////////////////////////////////\n    // Public functions\n    //////////////////////////////////////////////\n\n    /**\n     * Recover array os what to do in table.\n     */\n    this.getActionList = function () {\n      var fixedRow = (where === TableResultAction.where.Row) ? _startPoint.rowPos : -1;\n      var fixedCol = (where === TableResultAction.where.Column) ? _startPoint.colPos : -1;\n\n      var actualPosition = 0;\n      var canContinue = true;\n      while (canContinue) {\n        var rowPosition = (fixedRow >= 0) ? fixedRow : actualPosition;\n        var colPosition = (fixedCol >= 0) ? fixedCol : actualPosition;\n        var row = _virtualTable[rowPosition];\n        if (!row) {\n          canContinue = false;\n          return _actionCellList;\n        }\n        var cell = row[colPosition];\n        if (!cell) {\n          canContinue = false;\n          return _actionCellList;\n        }\n\n        // Define action to be applied in this cell\n        var resultAction = TableResultAction.resultAction.Ignore;\n        switch (action) {\n          case TableResultAction.requestAction.Add:\n            resultAction = getAddResultActionToCell(cell);\n            break;\n          case TableResultAction.requestAction.Delete:\n            resultAction = getDeleteResultActionToCell(cell);\n            break;\n        }\n        _actionCellList.push(getActionCell(cell, resultAction, rowPosition, colPosition));\n        actualPosition++;\n      }\n\n      return _actionCellList;\n    };\n\n    init();\n  };\n  /**\n  * \n  * Where action occours enum.\n  */\n  TableResultAction.where = { 'Row': 0, 'Column': 1 };\n  /**\n  * \n  * Requested action to apply enum.\n  */\n  TableResultAction.requestAction = { 'Add': 0, 'Delete': 1 };\n  /**\n  * \n  * Result action to be executed enum.\n  */\n  TableResultAction.resultAction = { 'Ignore': 0, 'SubtractSpanCount': 1, 'RemoveCell': 2, 'AddCell': 3, 'SumSpanCount': 4 };\n\n  /**\n   * \n   * @class editing.Table\n   *\n   * Table\n   *\n   */\n  var Table = function () {\n    /**\n     * handle tab key\n     *\n     * @param {WrappedRange} rng\n     * @param {Boolean} isShift\n     */\n    this.tab = function (rng, isShift) {\n      var cell = dom.ancestor(rng.commonAncestor(), dom.isCell);\n      var table = dom.ancestor(cell, dom.isTable);\n      var cells = dom.listDescendant(table, dom.isCell);\n\n      var nextCell = list[isShift ? 'prev' : 'next'](cells, cell);\n      if (nextCell) {\n        range.create(nextCell, 0).select();\n      }\n    };\n\n    /**\n     * Add a new row\n     *\n     * @param {WrappedRange} rng\n     * @param {String} position (top/bottom)\n     * @return {Node}\n     */\n    this.addRow = function (rng, position) {\n      var cell = dom.ancestor(rng.commonAncestor(), dom.isCell);\n\n      var currentTr = $(cell).closest('tr');\n      var trAttributes = this.recoverAttributes(currentTr);\n      var html = $('<tr' + trAttributes + '></tr>');\n\n      var vTable = new TableResultAction(cell, TableResultAction.where.Row,\n        TableResultAction.requestAction.Add, $(currentTr).closest('table')[0]);\n      var actions = vTable.getActionList();\n\n      for (var idCell = 0; idCell < actions.length; idCell++) {\n        var currentCell = actions[idCell];\n        var tdAttributes = this.recoverAttributes(currentCell.baseCell);\n        switch (currentCell.action) {\n          case TableResultAction.resultAction.AddCell:\n            html.append('<td' + tdAttributes + '>' + dom.blank + '</td>');\n            break;\n          case TableResultAction.resultAction.SumSpanCount:\n            if (position === 'top') {\n              var baseCellTr = currentCell.baseCell.parent;\n              var isTopFromRowSpan = (!baseCellTr ? 0 : currentCell.baseCell.closest('tr').rowIndex) <= currentTr[0].rowIndex;\n              if (isTopFromRowSpan) {\n                var newTd = $('<div></div>').append($('<td' + tdAttributes + '>' + dom.blank + '</td>').removeAttr('rowspan')).html();\n                html.append(newTd);\n                break;\n              }\n            }\n            var rowspanNumber = parseInt(currentCell.baseCell.rowSpan, 10);\n            rowspanNumber++;\n            currentCell.baseCell.setAttribute('rowSpan', rowspanNumber);\n            break;\n        }\n      }\n\n      if (position === 'top') {\n        currentTr.before(html);\n      }\n      else {\n        var cellHasRowspan = (cell.rowSpan > 1);\n        if (cellHasRowspan) {\n          var lastTrIndex = currentTr[0].rowIndex + (cell.rowSpan - 2);\n          $($(currentTr).parent().find('tr')[lastTrIndex]).after($(html));\n          return;\n        }\n        currentTr.after(html);\n      }\n    };\n\n    /**\n     * Add a new col\n     *\n     * @param {WrappedRange} rng\n     * @param {String} position (left/right)\n     * @return {Node}\n     */\n    this.addCol = function (rng, position) {\n      var cell = dom.ancestor(rng.commonAncestor(), dom.isCell);\n      var row = $(cell).closest('tr');\n      var rowsGroup = $(row).siblings();\n      rowsGroup.push(row);\n\n      var vTable = new TableResultAction(cell, TableResultAction.where.Column,\n        TableResultAction.requestAction.Add, $(row).closest('table')[0]);\n      var actions = vTable.getActionList();\n\n      for (var actionIndex = 0; actionIndex < actions.length; actionIndex++) {\n        var currentCell = actions[actionIndex];\n        var tdAttributes = this.recoverAttributes(currentCell.baseCell);\n        switch (currentCell.action) {\n          case TableResultAction.resultAction.AddCell:\n            if (position === 'right') {\n              $(currentCell.baseCell).after('<td' + tdAttributes + '>' + dom.blank + '</td>');\n            } else {\n              $(currentCell.baseCell).before('<td' + tdAttributes + '>' + dom.blank + '</td>');\n            }\n            break;\n          case TableResultAction.resultAction.SumSpanCount:\n            if (position === 'right') {\n              var colspanNumber = parseInt(currentCell.baseCell.colSpan, 10);\n              colspanNumber++;\n              currentCell.baseCell.setAttribute('colSpan', colspanNumber);\n            } else {\n              $(currentCell.baseCell).before('<td' + tdAttributes + '>' + dom.blank + '</td>');\n            }\n            break;\n        }\n      }\n    };\n\n    /*\n    * Copy attributes from element.\n    *\n    * @param {object} Element to recover attributes.\n    * @return {string} Copied string elements.\n    */\n    this.recoverAttributes = function (el) {\n      var resultStr = '';\n\n      if (!el) {\n        return resultStr;\n      }\n\n      var attrList = el.attributes || [];\n\n      for (var i = 0; i < attrList.length; i++) {\n        if (attrList[i].name.toLowerCase() === 'id') {\n          continue;\n        }\n\n        if (attrList[i].specified) {\n          resultStr += ' ' + attrList[i].name + '=\\'' + attrList[i].value + '\\'';\n        }\n      }\n\n      return resultStr;\n    };\n\n    /**\n     * Delete current row\n     *\n     * @param {WrappedRange} rng\n     * @return {Node}\n     */\n    this.deleteRow = function (rng) {\n      var cell = dom.ancestor(rng.commonAncestor(), dom.isCell);\n      var row = $(cell).closest('tr');\n      var cellPos = row.children('td, th').index($(cell));\n      var rowPos = row[0].rowIndex;\n\n      var vTable = new TableResultAction(cell, TableResultAction.where.Row,\n        TableResultAction.requestAction.Delete, $(row).closest('table')[0]);\n      var actions = vTable.getActionList();\n\n      for (var actionIndex = 0; actionIndex < actions.length; actionIndex++) {\n        if (!actions[actionIndex]) {\n          continue;\n        }\n\n        var baseCell = actions[actionIndex].baseCell;\n        var virtualPosition = actions[actionIndex].virtualTable;\n        var hasRowspan = (baseCell.rowSpan && baseCell.rowSpan > 1);\n        var rowspanNumber = (hasRowspan) ? parseInt(baseCell.rowSpan, 10) : 0;\n        switch (actions[actionIndex].action) {\n          case TableResultAction.resultAction.Ignore:\n            continue;\n          case TableResultAction.resultAction.AddCell:\n            var nextRow = row.next('tr')[0];\n            if (!nextRow) { continue; }\n            var cloneRow = row[0].cells[cellPos];\n            if (hasRowspan) {\n              if (rowspanNumber > 2) {\n                rowspanNumber--;\n                nextRow.insertBefore(cloneRow, nextRow.cells[cellPos]);\n                nextRow.cells[cellPos].setAttribute('rowSpan', rowspanNumber);\n                nextRow.cells[cellPos].innerHTML = '';\n              } else if (rowspanNumber === 2) {\n                nextRow.insertBefore(cloneRow, nextRow.cells[cellPos]);\n                nextRow.cells[cellPos].removeAttribute('rowSpan');\n                nextRow.cells[cellPos].innerHTML = '';\n              }\n            }\n            continue;\n          case TableResultAction.resultAction.SubtractSpanCount:\n            if (hasRowspan) {\n              if (rowspanNumber > 2) {\n                rowspanNumber--;\n                baseCell.setAttribute('rowSpan', rowspanNumber);\n                if (virtualPosition.rowIndex !== rowPos && baseCell.cellIndex === cellPos) { baseCell.innerHTML = ''; }\n              } else if (rowspanNumber === 2) {\n                baseCell.removeAttribute('rowSpan');\n                if (virtualPosition.rowIndex !== rowPos && baseCell.cellIndex === cellPos) { baseCell.innerHTML = ''; }\n              }\n            }\n            continue;\n          case TableResultAction.resultAction.RemoveCell:\n            // Do not need remove cell because row will be deleted.\n            continue;\n        }\n      }\n      row.remove();\n    };\n\n    /**\n     * Delete current col\n     *\n     * @param {WrappedRange} rng\n     * @return {Node}\n     */\n    this.deleteCol = function (rng) {\n      var cell = dom.ancestor(rng.commonAncestor(), dom.isCell);\n      var row = $(cell).closest('tr');\n      var cellPos = row.children('td, th').index($(cell));\n\n      var vTable = new TableResultAction(cell, TableResultAction.where.Column,\n        TableResultAction.requestAction.Delete, $(row).closest('table')[0]);\n      var actions = vTable.getActionList();\n\n      for (var actionIndex = 0; actionIndex < actions.length; actionIndex++) {\n        if (!actions[actionIndex]) {\n          continue;\n        }\n        switch (actions[actionIndex].action) {\n          case TableResultAction.resultAction.Ignore:\n            continue;\n          case TableResultAction.resultAction.SubtractSpanCount:\n            var baseCell = actions[actionIndex].baseCell;\n            var hasColspan = (baseCell.colSpan && baseCell.colSpan > 1);\n            if (hasColspan) {\n              var colspanNumber = (baseCell.colSpan) ? parseInt(baseCell.colSpan, 10) : 0;\n              if (colspanNumber > 2) {\n                colspanNumber--;\n                baseCell.setAttribute('colSpan', colspanNumber);\n                if (baseCell.cellIndex === cellPos) { baseCell.innerHTML = ''; }\n              } else if (colspanNumber === 2) {\n                baseCell.removeAttribute('colSpan');\n                if (baseCell.cellIndex === cellPos) { baseCell.innerHTML = ''; }\n              }\n            }\n            continue;\n          case TableResultAction.resultAction.RemoveCell:\n            dom.remove(actions[actionIndex].baseCell, true);\n            continue;\n        }\n      }\n    };\n\n    /**\n     * create empty table element\n     *\n     * @param {Number} rowCount\n     * @param {Number} colCount\n     * @return {Node}\n     */\n    this.createTable = function (colCount, rowCount, options) {\n      var tds = [], tdHTML;\n      for (var idxCol = 0; idxCol < colCount; idxCol++) {\n        tds.push('<td>' + dom.blank + '</td>');\n      }\n      tdHTML = tds.join('');\n\n      var trs = [], trHTML;\n      for (var idxRow = 0; idxRow < rowCount; idxRow++) {\n        trs.push('<tr>' + tdHTML + '</tr>');\n      }\n      trHTML = trs.join('');\n      var $table = $('<table>' + trHTML + '</table>');\n      if (options && options.tableClassName) {\n        $table.addClass(options.tableClassName);\n      }\n\n      return $table[0];\n    };\n\n    /**\n     * Delete current table\n     *\n     * @param {WrappedRange} rng\n     * @return {Node}\n     */\n    this.deleteTable = function (rng) {\n      var cell = dom.ancestor(rng.commonAncestor(), dom.isCell);\n      $(cell).closest('table').remove();\n    };\n  };\n\n\n  var KEY_BOGUS = 'bogus';\n\n  /**\n   * @class Editor\n   */\n  var Editor = function (context) {\n    var self = this;\n\n    var $note = context.layoutInfo.note;\n    var $editor = context.layoutInfo.editor;\n    var $editable = context.layoutInfo.editable;\n    var options = context.options;\n    var lang = options.langInfo;\n\n    var editable = $editable[0];\n    var lastRange = null;\n\n    var style = new Style();\n    var table = new Table();\n    var typing = new Typing();\n    var bullet = new Bullet();\n    var history = new History($editable);\n\n    this.initialize = function () {\n      // bind custom events\n      $editable.on('keydown', function (event) {\n        if (event.keyCode === key.code.ENTER) {\n          context.triggerEvent('enter', event);\n        }\n        context.triggerEvent('keydown', event);\n\n        if (!event.isDefaultPrevented()) {\n          if (options.shortcuts) {\n            self.handleKeyMap(event);\n          } else {\n            self.preventDefaultEditableShortCuts(event);\n          }\n        }\n      }).on('keyup', function (event) {\n        context.triggerEvent('keyup', event);\n      }).on('focus', function (event) {\n        context.triggerEvent('focus', event);\n      }).on('blur', function (event) {\n        context.triggerEvent('blur', event);\n      }).on('mousedown', function (event) {\n        context.triggerEvent('mousedown', event);\n      }).on('mouseup', function (event) {\n        context.triggerEvent('mouseup', event);\n      }).on('scroll', function (event) {\n        context.triggerEvent('scroll', event);\n      }).on('paste', function (event) {\n        context.triggerEvent('paste', event);\n      });\n\n      // init content before set event\n      $editable.html(dom.html($note) || dom.emptyPara);\n\n      // [workaround] IE doesn't have input events for contentEditable\n      // - see: https://goo.gl/4bfIvA\n      var changeEventName = agent.isMSIE ? 'DOMCharacterDataModified DOMSubtreeModified DOMNodeInserted' : 'input';\n      $editable.on(changeEventName, func.debounce(function () {\n        context.triggerEvent('change', $editable.html());\n      }, 100));\n\n      $editor.on('focusin', function (event) {\n        context.triggerEvent('focusin', event);\n      }).on('focusout', function (event) {\n        context.triggerEvent('focusout', event);\n      });\n\n      if (!options.airMode) {\n        if (options.width) {\n          $editor.outerWidth(options.width);\n        }\n        if (options.height) {\n          $editable.outerHeight(options.height);\n        }\n        if (options.maxHeight) {\n          $editable.css('max-height', options.maxHeight);\n        }\n        if (options.minHeight) {\n          $editable.css('min-height', options.minHeight);\n        }\n      }\n\n      history.recordUndo();\n    };\n\n    this.destroy = function () {\n      $editable.off();\n    };\n\n    this.handleKeyMap = function (event) {\n      var keyMap = options.keyMap[agent.isMac ? 'mac' : 'pc'];\n      var keys = [];\n\n      if (event.metaKey) { keys.push('CMD'); }\n      if (event.ctrlKey && !event.altKey) { keys.push('CTRL'); }\n      if (event.shiftKey) { keys.push('SHIFT'); }\n\n      var keyName = key.nameFromCode[event.keyCode];\n      if (keyName) {\n        keys.push(keyName);\n      }\n\n      var eventName = keyMap[keys.join('+')];\n      if (eventName) {\n        event.preventDefault();\n        context.invoke(eventName);\n      } else if (key.isEdit(event.keyCode)) {\n        this.afterCommand();\n      }\n    };\n\n    this.preventDefaultEditableShortCuts = function (event) {\n      // B(Bold, 66) / I(Italic, 73) / U(Underline, 85)\n      if ((event.ctrlKey || event.metaKey) &&\n        list.contains([66, 73, 85], event.keyCode)) {\n        event.preventDefault();\n      }\n    };\n\n    /**\n     * create range\n     * @return {WrappedRange}\n     */\n    this.createRange = function () {\n      this.focus();\n      return range.create(editable);\n    };\n\n    /**\n     * saveRange\n     *\n     * save current range\n     *\n     * @param {Boolean} [thenCollapse=false]\n     */\n    this.saveRange = function (thenCollapse) {\n      lastRange = this.createRange();\n      if (thenCollapse) {\n        lastRange.collapse().select();\n      }\n    };\n\n    /**\n     * restoreRange\n     *\n     * restore lately range\n     */\n    this.restoreRange = function () {\n      if (lastRange) {\n        lastRange.select();\n        this.focus();\n      }\n    };\n\n    this.saveTarget = function (node) {\n      $editable.data('target', node);\n    };\n\n    this.clearTarget = function () {\n      $editable.removeData('target');\n    };\n\n    this.restoreTarget = function () {\n      return $editable.data('target');\n    };\n\n    /**\n     * currentStyle\n     *\n     * current style\n     * @return {Object|Boolean} unfocus\n     */\n    this.currentStyle = function () {\n      var rng = range.create();\n      if (rng) {\n        rng = rng.normalize();\n      }\n      return rng ? style.current(rng) : style.fromNode($editable);\n    };\n\n    /**\n     * style from node\n     *\n     * @param {jQuery} $node\n     * @return {Object}\n     */\n    this.styleFromNode = function ($node) {\n      return style.fromNode($node);\n    };\n\n    /**\n     * undo\n     */\n    this.undo = function () {\n      context.triggerEvent('before.command', $editable.html());\n      history.undo();\n      context.triggerEvent('change', $editable.html());\n    };\n    context.memo('help.undo', lang.help.undo);\n\n    /**\n     * redo\n     */\n    this.redo = function () {\n      context.triggerEvent('before.command', $editable.html());\n      history.redo();\n      context.triggerEvent('change', $editable.html());\n    };\n    context.memo('help.redo', lang.help.redo);\n\n    /**\n     * before command\n     */\n    var beforeCommand = this.beforeCommand = function () {\n      context.triggerEvent('before.command', $editable.html());\n      // keep focus on editable before command execution\n      self.focus();\n    };\n\n    /**\n     * after command\n     * @param {Boolean} isPreventTrigger\n     */\n    var afterCommand = this.afterCommand = function (isPreventTrigger) {\n      history.recordUndo();\n      if (!isPreventTrigger) {\n        context.triggerEvent('change', $editable.html());\n      }\n    };\n\n    /* jshint ignore:start */\n    // native commands(with execCommand), generate function for execCommand\n    var commands = ['bold', 'italic', 'underline', 'strikethrough', 'superscript', 'subscript',\n                    'justifyLeft', 'justifyCenter', 'justifyRight', 'justifyFull',\n                    'formatBlock', 'removeFormat',\n                    'backColor', 'fontName'];\n\n    for (var idx = 0, len = commands.length; idx < len; idx ++) {\n      this[commands[idx]] = (function (sCmd) {\n        return function (value) {\n          beforeCommand();\n          document.execCommand(sCmd, false, value);\n          afterCommand(true);\n        };\n      })(commands[idx]);\n      context.memo('help.' + commands[idx], lang.help[commands[idx]]);\n    }\n    /* jshint ignore:end */\n\n    /**\n     * handle tab key\n     */\n    this.tab = function () {\n      var rng = this.createRange();\n      if (rng.isCollapsed() && rng.isOnCell()) {\n        table.tab(rng);\n      } else {\n        beforeCommand();\n        typing.insertTab(rng, options.tabSize);\n        afterCommand();\n      }\n    };\n    context.memo('help.tab', lang.help.tab);\n\n    /**\n     * handle shift+tab key\n     */\n    this.untab = function () {\n      var rng = this.createRange();\n      if (rng.isCollapsed() && rng.isOnCell()) {\n        table.tab(rng, true);\n      }\n    };\n    context.memo('help.untab', lang.help.untab);\n\n    /**\n     * run given function between beforeCommand and afterCommand\n     */\n    this.wrapCommand = function (fn) {\n      return function () {\n        beforeCommand();\n        fn.apply(self, arguments);\n        afterCommand();\n      };\n    };\n\n    /**\n     * insert paragraph\n     */\n    this.insertParagraph = this.wrapCommand(function () {\n      typing.insertParagraph(editable);\n    });\n    context.memo('help.insertParagraph', lang.help.insertParagraph);\n\n    this.insertOrderedList = this.wrapCommand(function () {\n      bullet.insertOrderedList(editable);\n    });\n    context.memo('help.insertOrderedList', lang.help.insertOrderedList);\n\n    this.insertUnorderedList = this.wrapCommand(function () {\n      bullet.insertUnorderedList(editable);\n    });\n    context.memo('help.insertUnorderedList', lang.help.insertUnorderedList);\n\n    this.indent = this.wrapCommand(function () {\n      bullet.indent(editable);\n    });\n    context.memo('help.indent', lang.help.indent);\n\n    this.outdent = this.wrapCommand(function () {\n      bullet.outdent(editable);\n    });\n    context.memo('help.outdent', lang.help.outdent);\n\n    /**\n     * insert image\n     *\n     * @param {String} src\n     * @param {String|Function} param\n     * @return {Promise}\n     */\n    this.insertImage = function (src, param) {\n      return async.createImage(src, param).then(function ($image) {\n        beforeCommand();\n\n        if (typeof param === 'function') {\n          param($image);\n        } else {\n          if (typeof param === 'string') {\n            $image.attr('data-filename', param);\n          }\n          $image.css('width', Math.min($editable.width(), $image.width()));\n        }\n\n        $image.show();\n        range.create(editable).insertNode($image[0]);\n        range.createFromNodeAfter($image[0]).select();\n        afterCommand();\n      }).fail(function (e) {\n        context.triggerEvent('image.upload.error', e);\n      });\n    };\n\n    /**\n     * insertImages\n     * @param {File[]} files\n     */\n    this.insertImages = function (files) {\n      $.each(files, function (idx, file) {\n        var filename = file.name;\n        if (options.maximumImageFileSize && options.maximumImageFileSize < file.size) {\n          context.triggerEvent('image.upload.error', lang.image.maximumFileSizeError);\n        } else {\n          async.readFileAsDataURL(file).then(function (dataURL) {\n            return self.insertImage(dataURL, filename);\n          }).fail(function () {\n            context.triggerEvent('image.upload.error');\n          });\n        }\n      });\n    };\n\n    /**\n     * insertImagesOrCallback\n     * @param {File[]} files\n     */\n    this.insertImagesOrCallback = function (files) {\n      var callbacks = options.callbacks;\n\n      // If onImageUpload options setted\n      if (callbacks.onImageUpload) {\n        context.triggerEvent('image.upload', files);\n      // else insert Image as dataURL\n      } else {\n        this.insertImages(files);\n      }\n    };\n\n    /**\n     * insertNode\n     * insert node\n     * @param {Node} node\n     */\n    this.insertNode = this.wrapCommand(function (node) {\n      var rng = this.createRange();\n      rng.insertNode(node);\n      range.createFromNodeAfter(node).select();\n    });\n\n    /**\n     * insert text\n     * @param {String} text\n     */\n    this.insertText = this.wrapCommand(function (text) {\n      var rng = this.createRange();\n      var textNode = rng.insertNode(dom.createText(text));\n      range.create(textNode, dom.nodeLength(textNode)).select();\n    });\n\n    /**\n     * return selected plain text\n     * @return {String} text\n     */\n    this.getSelectedText = function () {\n      var rng = this.createRange();\n\n      // if range on anchor, expand range with anchor\n      if (rng.isOnAnchor()) {\n        rng = range.createFromNode(dom.ancestor(rng.sc, dom.isAnchor));\n      }\n\n      return rng.toString();\n    };\n\n    /**\n     * paste HTML\n     * @param {String} markup\n     */\n    this.pasteHTML = this.wrapCommand(function (markup) {\n      var contents = this.createRange().pasteHTML(markup);\n      range.createFromNodeAfter(list.last(contents)).select();\n    });\n\n    /**\n     * formatBlock\n     *\n     * @param {String} tagName\n     */\n    this.formatBlock = this.wrapCommand(function (tagName, $target) {\n      var onApplyCustomStyle = context.options.callbacks.onApplyCustomStyle;\n      if (onApplyCustomStyle) {\n        onApplyCustomStyle.call(this, $target, context, this.onFormatBlock);\n      } else {\n        this.onFormatBlock(tagName);\n      }\n    });\n\n    this.onFormatBlock = function (tagName) {\n      // [workaround] for MSIE, IE need `<`\n      tagName = agent.isMSIE ? '<' + tagName + '>' : tagName;\n      document.execCommand('FormatBlock', false, tagName);\n    };\n\n    this.formatPara = function () {\n      this.formatBlock('P');\n    };\n    context.memo('help.formatPara', lang.help.formatPara);\n\n    /* jshint ignore:start */\n    for (var idx = 1; idx <= 6; idx ++) {\n      this['formatH' + idx] = function (idx) {\n        return function () {\n          this.formatBlock('H' + idx);\n        };\n      }(idx);\n      context.memo('help.formatH'+idx, lang.help['formatH' + idx]);\n    };\n    /* jshint ignore:end */\n\n    /**\n     * fontSize\n     *\n     * @param {String} value - px\n     */\n    this.fontSize = function (value) {\n      var rng = this.createRange();\n\n      if (rng && rng.isCollapsed()) {\n        var spans = style.styleNodes(rng);\n        var firstSpan = list.head(spans);\n\n        $(spans).css({\n          'font-size': value + 'px'\n        });\n\n        // [workaround] added styled bogus span for style\n        //  - also bogus character needed for cursor position\n        if (firstSpan && !dom.nodeLength(firstSpan)) {\n          firstSpan.innerHTML = dom.ZERO_WIDTH_NBSP_CHAR;\n          range.createFromNodeAfter(firstSpan.firstChild).select();\n          $editable.data(KEY_BOGUS, firstSpan);\n        }\n      } else {\n        beforeCommand();\n        $(style.styleNodes(rng)).css({\n          'font-size': value + 'px'\n        });\n        afterCommand();\n      }\n    };\n\n    /**\n     * insert horizontal rule\n     */\n    this.insertHorizontalRule = this.wrapCommand(function () {\n      var hrNode = this.createRange().insertNode(dom.create('HR'));\n      if (hrNode.nextSibling) {\n        range.create(hrNode.nextSibling, 0).normalize().select();\n      }\n    });\n    context.memo('help.insertHorizontalRule', lang.help.insertHorizontalRule);\n\n    /**\n     * remove bogus node and character\n     */\n    this.removeBogus = function () {\n      var bogusNode = $editable.data(KEY_BOGUS);\n      if (!bogusNode) {\n        return;\n      }\n\n      var textNode = list.find(list.from(bogusNode.childNodes), dom.isText);\n\n      var bogusCharIdx = textNode.nodeValue.indexOf(dom.ZERO_WIDTH_NBSP_CHAR);\n      if (bogusCharIdx !== -1) {\n        textNode.deleteData(bogusCharIdx, 1);\n      }\n\n      if (dom.isEmpty(bogusNode)) {\n        dom.remove(bogusNode);\n      }\n\n      $editable.removeData(KEY_BOGUS);\n    };\n\n    /**\n     * lineHeight\n     * @param {String} value\n     */\n    this.lineHeight = this.wrapCommand(function (value) {\n      style.stylePara(this.createRange(), {\n        lineHeight: value\n      });\n    });\n\n    /**\n     * unlink\n     *\n     * @type command\n     */\n    this.unlink = function () {\n      var rng = this.createRange();\n      if (rng.isOnAnchor()) {\n        var anchor = dom.ancestor(rng.sc, dom.isAnchor);\n        rng = range.createFromNode(anchor);\n        rng.select();\n\n        beforeCommand();\n        document.execCommand('unlink');\n        afterCommand();\n      }\n    };\n\n    /**\n     * create link (command)\n     *\n     * @param {Object} linkInfo\n     */\n    this.createLink = this.wrapCommand(function (linkInfo) {\n      var linkUrl = linkInfo.url;\n      var linkText = linkInfo.text;\n      var isNewWindow = linkInfo.isNewWindow;\n      var rng = linkInfo.range || this.createRange();\n      var isTextChanged = rng.toString() !== linkText;\n\n      // handle spaced urls from input\n      if (typeof linkUrl === 'string') {\n        linkUrl = linkUrl.trim();\n      }\n\n      if (options.onCreateLink) {\n        linkUrl = options.onCreateLink(linkUrl);\n      } else {\n        // if url doesn't match an URL schema, set http:// as default\n        linkUrl = /^[A-Za-z][A-Za-z0-9+-.]*\\:[\\/\\/]?/.test(linkUrl) ?\n          linkUrl : 'http://' + linkUrl;\n      }\n\n      var anchors = [];\n      if (isTextChanged) {\n        rng = rng.deleteContents();\n        var anchor = rng.insertNode($('<A>' + linkText + '</A>')[0]);\n        anchors.push(anchor);\n      } else {\n        anchors = style.styleNodes(rng, {\n          nodeName: 'A',\n          expandClosestSibling: true,\n          onlyPartialContains: true\n        });\n      }\n\n      $.each(anchors, function (idx, anchor) {\n        $(anchor).attr('href', linkUrl);\n        if (isNewWindow) {\n          $(anchor).attr('target', '_blank');\n        } else {\n          $(anchor).removeAttr('target');\n        }\n      });\n\n      var startRange = range.createFromNodeBefore(list.head(anchors));\n      var startPoint = startRange.getStartPoint();\n      var endRange = range.createFromNodeAfter(list.last(anchors));\n      var endPoint = endRange.getEndPoint();\n\n      range.create(\n        startPoint.node,\n        startPoint.offset,\n        endPoint.node,\n        endPoint.offset\n      ).select();\n    });\n\n    /**\n     * returns link info\n     *\n     * @return {Object}\n     * @return {WrappedRange} return.range\n     * @return {String} return.text\n     * @return {Boolean} [return.isNewWindow=true]\n     * @return {String} [return.url=\"\"]\n     */\n    this.getLinkInfo = function () {\n      var rng = this.createRange().expand(dom.isAnchor);\n\n      // Get the first anchor on range(for edit).\n      var $anchor = $(list.head(rng.nodes(dom.isAnchor)));\n      var linkInfo = {\n        range: rng,\n        text: rng.toString(),\n        url: $anchor.length ? $anchor.attr('href') : ''\n      };\n\n      // Define isNewWindow when anchor exists.\n      if ($anchor.length) {\n        linkInfo.isNewWindow = $anchor.attr('target') === '_blank';\n      }\n\n      return linkInfo;\n    };\n\n    /**\n     * setting color\n     *\n     * @param {Object} sObjColor  color code\n     * @param {String} sObjColor.foreColor foreground color\n     * @param {String} sObjColor.backColor background color\n     */\n    this.color = this.wrapCommand(function (colorInfo) {\n      var foreColor = colorInfo.foreColor;\n      var backColor = colorInfo.backColor;\n\n      if (foreColor) { document.execCommand('foreColor', false, foreColor); }\n      if (backColor) { document.execCommand('backColor', false, backColor); }\n    });\n\n    /**\n     * Set foreground color\n     *\n     * @param {String} colorCode foreground color code\n     */\n    this.foreColor = this.wrapCommand(function (colorInfo) {\n      document.execCommand('styleWithCSS', false, true);\n      document.execCommand('foreColor', false, colorInfo);\n    });\n\n    /**\n     * insert Table\n     *\n     * @param {String} dimension of table (ex : \"5x5\")\n     */\n    this.insertTable = this.wrapCommand(function (dim) {\n      var dimension = dim.split('x');\n\n      var rng = this.createRange().deleteContents();\n      rng.insertNode(table.createTable(dimension[0], dimension[1], options));\n    });\n\n     /**\n     * @method addRow\n     *\n     *\n     */\n    this.addRow = function (position) {\n      var rng = this.createRange($editable);\n      if (rng.isCollapsed() && rng.isOnCell()) {\n        beforeCommand();\n        table.addRow(rng, position);\n        afterCommand();\n      }\n    };\n\n     /**\n     * @method addCol\n     *\n     *\n     */\n    this.addCol = function (position) {\n      var rng = this.createRange($editable);\n      if (rng.isCollapsed() && rng.isOnCell()) {\n        beforeCommand();\n        table.addCol(rng, position);\n        afterCommand();\n      }\n    };\n\n    /**\n     * @method deleteRow\n     *\n     *\n     */\n    this.deleteRow = function () {\n      var rng = this.createRange($editable);\n      if (rng.isCollapsed() && rng.isOnCell()) {\n        beforeCommand();\n        table.deleteRow(rng);\n        afterCommand();\n      }\n    };\n\n    /**\n     * @method deleteCol\n     *\n     *\n     */\n    this.deleteCol = function () {\n      var rng = this.createRange($editable);\n      if (rng.isCollapsed() && rng.isOnCell()) {\n        beforeCommand();\n        table.deleteCol(rng);\n        afterCommand();\n      }\n    };\n\n    /**\n     * @method deleteTable\n     *\n     *\n     */\n    this.deleteTable = function () {\n      var rng = this.createRange($editable);\n      if (rng.isCollapsed() && rng.isOnCell()) {\n        beforeCommand();\n        table.deleteTable(rng);\n        afterCommand();\n      }\n    };\n\n    /**\n     * float me\n     *\n     * @param {String} value\n     */\n    this.floatMe = this.wrapCommand(function (value) {\n      var $target = $(this.restoreTarget());\n      $target.toggleClass('note-float-left', value === 'left');\n      $target.toggleClass('note-float-right', value === 'right');\n      $target.css('float', value);\n    });\n\n    /**\n     * resize overlay element\n     * @param {String} value\n     */\n    this.resize = this.wrapCommand(function (value) {\n      var $target = $(this.restoreTarget());\n      $target.css({\n        width: value * 100 + '%',\n        height: ''\n      });\n    });\n\n    /**\n     * @param {Position} pos\n     * @param {jQuery} $target - target element\n     * @param {Boolean} [bKeepRatio] - keep ratio\n     */\n    this.resizeTo = function (pos, $target, bKeepRatio) {\n      var imageSize;\n      if (bKeepRatio) {\n        var newRatio = pos.y / pos.x;\n        var ratio = $target.data('ratio');\n        imageSize = {\n          width: ratio > newRatio ? pos.x : pos.y / ratio,\n          height: ratio > newRatio ? pos.x * ratio : pos.y\n        };\n      } else {\n        imageSize = {\n          width: pos.x,\n          height: pos.y\n        };\n      }\n\n      $target.css(imageSize);\n    };\n\n    /**\n     * remove media object\n     */\n    this.removeMedia = this.wrapCommand(function () {\n      var $target = $(this.restoreTarget()).detach();\n      context.triggerEvent('media.delete', $target, $editable);\n    });\n\n    /**\n     * returns whether editable area has focus or not.\n     */\n    this.hasFocus = function () {\n      return $editable.is(':focus');\n    };\n\n    /**\n     * set focus\n     */\n    this.focus = function () {\n      // [workaround] Screen will move when page is scolled in IE.\n      //  - do focus when not focused\n      if (!this.hasFocus()) {\n        $editable.focus();\n      }\n    };\n\n    /**\n     * returns whether contents is empty or not.\n     * @return {Boolean}\n     */\n    this.isEmpty = function () {\n      return dom.isEmpty($editable[0]) || dom.emptyPara === $editable.html();\n    };\n\n    /**\n     * Removes all contents and restores the editable instance to an _emptyPara_.\n     */\n    this.empty = function () {\n      context.invoke('code', dom.emptyPara);\n    };\n  };\n\n  var Clipboard = function (context) {\n    var self = this;\n\n    var $editable = context.layoutInfo.editable;\n\n    this.events = {\n      'summernote.keydown': function (we, e) {\n        if (self.needKeydownHook()) {\n          if ((e.ctrlKey || e.metaKey) && e.keyCode === key.code.V) {\n            context.invoke('editor.saveRange');\n            self.$paste.focus();\n\n            setTimeout(function () {\n              self.pasteByHook();\n            }, 0);\n          }\n        }\n      }\n    };\n\n    this.needKeydownHook = function () {\n      return (agent.isMSIE && agent.browserVersion > 10) || agent.isFF;\n    };\n\n    this.initialize = function () {\n      // [workaround] getting image from clipboard\n      //  - IE11 and Firefox: CTRL+v hook\n      //  - Webkit: event.clipboardData\n      if (this.needKeydownHook()) {\n        this.$paste = $('<div tabindex=\"-1\" />').attr('contenteditable', true).css({\n          position: 'absolute',\n          left: -100000,\n          opacity: 0\n        });\n        $editable.before(this.$paste);\n\n        this.$paste.on('paste', function (event) {\n          context.triggerEvent('paste', event);\n        });\n      } else {\n        $editable.on('paste', this.pasteByEvent);\n      }\n    };\n\n    this.destroy = function () {\n      if (this.needKeydownHook()) {\n        this.$paste.remove();\n        this.$paste = null;\n      }\n    };\n\n    this.pasteByHook = function () {\n      var node = this.$paste[0].firstChild;\n\n      var src = node && node.src;\n      if (dom.isImg(node) && src.indexOf('data:') === 0) {\n        var decodedData = atob(node.src.split(',')[1]);\n        var array = new Uint8Array(decodedData.length);\n        for (var i = 0; i < decodedData.length; i++) {\n          array[i] = decodedData.charCodeAt(i);\n        }\n\n        var blob = new Blob([array], { type: 'image/png' });\n        blob.name = 'clipboard.png';\n\n        context.invoke('editor.restoreRange');\n        context.invoke('editor.focus');\n        context.invoke('editor.insertImagesOrCallback', [blob]);\n      } else {\n        var pasteContent = $('<div />').html(this.$paste.html()).html();\n        context.invoke('editor.restoreRange');\n        context.invoke('editor.focus');\n\n        if (pasteContent) {\n          context.invoke('editor.pasteHTML', pasteContent);\n        }\n      }\n\n      this.$paste.empty();\n    };\n\n    /**\n     * paste by clipboard event\n     *\n     * @param {Event} event\n     */\n    this.pasteByEvent = function (event) {\n      var clipboardData = event.originalEvent.clipboardData;\n      if (clipboardData && clipboardData.items && clipboardData.items.length) {\n        var item = list.head(clipboardData.items);\n        if (item.kind === 'file' && item.type.indexOf('image/') !== -1) {\n          context.invoke('editor.insertImagesOrCallback', [item.getAsFile()]);\n        }\n        context.invoke('editor.afterCommand');\n      }\n    };\n  };\n\n  var Dropzone = function (context) {\n    var $document = $(document);\n    var $editor = context.layoutInfo.editor;\n    var $editable = context.layoutInfo.editable;\n    var options = context.options;\n    var lang = options.langInfo;\n    var documentEventHandlers = {};\n\n    var $dropzone = $([\n      '<div class=\"note-dropzone\">',\n      '  <div class=\"note-dropzone-message\"/>',\n      '</div>'\n    ].join('')).prependTo($editor);\n\n    var detachDocumentEvent = function () {\n      Object.keys(documentEventHandlers).forEach(function (key) {\n        $document.off(key.substr(2).toLowerCase(), documentEventHandlers[key]);\n      });\n      documentEventHandlers = {};\n    };\n\n    /**\n     * attach Drag and Drop Events\n     */\n    this.initialize = function () {\n      if (options.disableDragAndDrop) {\n        // prevent default drop event\n        documentEventHandlers.onDrop = function (e) {\n          e.preventDefault();\n        };\n        $document.on('drop', documentEventHandlers.onDrop);\n      } else {\n        this.attachDragAndDropEvent();\n      }\n    };\n\n    /**\n     * attach Drag and Drop Events\n     */\n    this.attachDragAndDropEvent = function () {\n      var collection = $(),\n          $dropzoneMessage = $dropzone.find('.note-dropzone-message');\n\n      documentEventHandlers.onDragenter = function (e) {\n        var isCodeview = context.invoke('codeview.isActivated');\n        var hasEditorSize = $editor.width() > 0 && $editor.height() > 0;\n        if (!isCodeview && !collection.length && hasEditorSize) {\n          $editor.addClass('dragover');\n          $dropzone.width($editor.width());\n          $dropzone.height($editor.height());\n          $dropzoneMessage.text(lang.image.dragImageHere);\n        }\n        collection = collection.add(e.target);\n      };\n\n      documentEventHandlers.onDragleave = function (e) {\n        collection = collection.not(e.target);\n        if (!collection.length) {\n          $editor.removeClass('dragover');\n        }\n      };\n\n      documentEventHandlers.onDrop = function () {\n        collection = $();\n        $editor.removeClass('dragover');\n      };\n\n      // show dropzone on dragenter when dragging a object to document\n      // -but only if the editor is visible, i.e. has a positive width and height\n      $document.on('dragenter', documentEventHandlers.onDragenter)\n        .on('dragleave', documentEventHandlers.onDragleave)\n        .on('drop', documentEventHandlers.onDrop);\n\n      // change dropzone's message on hover.\n      $dropzone.on('dragenter', function () {\n        $dropzone.addClass('hover');\n        $dropzoneMessage.text(lang.image.dropImage);\n      }).on('dragleave', function () {\n        $dropzone.removeClass('hover');\n        $dropzoneMessage.text(lang.image.dragImageHere);\n      });\n\n      // attach dropImage\n      $dropzone.on('drop', function (event) {\n        var dataTransfer = event.originalEvent.dataTransfer;\n\n        if (dataTransfer && dataTransfer.files && dataTransfer.files.length) {\n          event.preventDefault();\n          $editable.focus();\n          context.invoke('editor.insertImagesOrCallback', dataTransfer.files);\n        } else {\n          $.each(dataTransfer.types, function (idx, type) {\n            var content = dataTransfer.getData(type);\n\n            if (type.toLowerCase().indexOf('text') > -1) {\n              context.invoke('editor.pasteHTML', content);\n            } else {\n              $(content).each(function () {\n                context.invoke('editor.insertNode', this);\n              });\n            }\n          });\n        }\n      }).on('dragover', false); // prevent default dragover event\n    };\n\n    this.destroy = function () {\n      detachDocumentEvent();\n    };\n  };\n\n\n  var CodeMirror;\n  if (agent.hasCodeMirror) {\n    if (agent.isSupportAmd) {\n      require(['codemirror'], function (cm) {\n        CodeMirror = cm;\n      });\n    } else {\n      CodeMirror = window.CodeMirror;\n    }\n  }\n\n  /**\n   * @class Codeview\n   */\n  var Codeview = function (context) {\n    var $editor = context.layoutInfo.editor;\n    var $editable = context.layoutInfo.editable;\n    var $codable = context.layoutInfo.codable;\n    var options = context.options;\n\n    this.sync = function () {\n      var isCodeview = this.isActivated();\n      if (isCodeview && agent.hasCodeMirror) {\n        $codable.data('cmEditor').save();\n      }\n    };\n\n    /**\n     * @return {Boolean}\n     */\n    this.isActivated = function () {\n      return $editor.hasClass('codeview');\n    };\n\n    /**\n     * toggle codeview\n     */\n    this.toggle = function () {\n      if (this.isActivated()) {\n        this.deactivate();\n      } else {\n        this.activate();\n      }\n      context.triggerEvent('codeview.toggled');\n    };\n\n    /**\n     * activate code view\n     */\n    this.activate = function () {\n      $codable.val(dom.html($editable, options.prettifyHtml));\n      $codable.height($editable.height());\n\n      context.invoke('toolbar.updateCodeview', true);\n      $editor.addClass('codeview');\n      $codable.focus();\n\n      // activate CodeMirror as codable\n      if (agent.hasCodeMirror) {\n        var cmEditor = CodeMirror.fromTextArea($codable[0], options.codemirror);\n\n        // CodeMirror TernServer\n        if (options.codemirror.tern) {\n          var server = new CodeMirror.TernServer(options.codemirror.tern);\n          cmEditor.ternServer = server;\n          cmEditor.on('cursorActivity', function (cm) {\n            server.updateArgHints(cm);\n          });\n        }\n\n        // CodeMirror hasn't Padding.\n        cmEditor.setSize(null, $editable.outerHeight());\n        $codable.data('cmEditor', cmEditor);\n      }\n    };\n\n    /**\n     * deactivate code view\n     */\n    this.deactivate = function () {\n      // deactivate CodeMirror as codable\n      if (agent.hasCodeMirror) {\n        var cmEditor = $codable.data('cmEditor');\n        $codable.val(cmEditor.getValue());\n        cmEditor.toTextArea();\n      }\n\n      var value = dom.value($codable, options.prettifyHtml) || dom.emptyPara;\n      var isChange = $editable.html() !== value;\n\n      $editable.html(value);\n      $editable.height(options.height ? $codable.height() : 'auto');\n      $editor.removeClass('codeview');\n\n      if (isChange) {\n        context.triggerEvent('change', $editable.html(), $editable);\n      }\n\n      $editable.focus();\n\n      context.invoke('toolbar.updateCodeview', false);\n    };\n\n    this.destroy = function () {\n      if (this.isActivated()) {\n        this.deactivate();\n      }\n    };\n  };\n\n  var EDITABLE_PADDING = 24;\n\n  var Statusbar = function (context) {\n    var $document = $(document);\n    var $statusbar = context.layoutInfo.statusbar;\n    var $editable = context.layoutInfo.editable;\n    var options = context.options;\n\n    this.initialize = function () {\n      if (options.airMode || options.disableResizeEditor) {\n        this.destroy();\n        return;\n      }\n\n      $statusbar.on('mousedown', function (event) {\n        event.preventDefault();\n        event.stopPropagation();\n\n        var editableTop = $editable.offset().top - $document.scrollTop();\n        var onMouseMove = function (event) {\n          var height = event.clientY - (editableTop + EDITABLE_PADDING);\n\n          height = (options.minheight > 0) ? Math.max(height, options.minheight) : height;\n          height = (options.maxHeight > 0) ? Math.min(height, options.maxHeight) : height;\n\n          $editable.height(height);\n        };\n\n        $document\n          .on('mousemove', onMouseMove)\n          .one('mouseup', function () {\n            $document.off('mousemove', onMouseMove);\n          });\n      });\n    };\n\n    this.destroy = function () {\n      $statusbar.off();\n      $statusbar.remove();\n    };\n  };\n\n  var Fullscreen = function (context) {\n    var self = this;\n    var $editor = context.layoutInfo.editor;\n    var $toolbar = context.layoutInfo.toolbar;\n    var $editable = context.layoutInfo.editable;\n    var $codable = context.layoutInfo.codable;\n\n    var $window = $(window);\n    var $scrollbar = $('html, body');\n\n    this.resizeTo = function (size) {\n      $editable.css('height', size.h);\n      $codable.css('height', size.h);\n      if ($codable.data('cmeditor')) {\n        $codable.data('cmeditor').setsize(null, size.h);\n      }\n    };\n\n    this.onResize = function () {\n      self.resizeTo({\n        h: $window.height() - $toolbar.outerHeight()\n      });\n    };\n\n    /**\n     * toggle fullscreen\n     */\n    this.toggle = function () {\n      $editor.toggleClass('fullscreen');\n      if (this.isFullscreen()) {\n        $editable.data('orgHeight', $editable.css('height'));\n        $window.on('resize', this.onResize).trigger('resize');\n        $scrollbar.css('overflow', 'hidden');\n      } else {\n        $window.off('resize', this.onResize);\n        this.resizeTo({ h: $editable.data('orgHeight') });\n        $scrollbar.css('overflow', 'visible');\n      }\n\n      context.invoke('toolbar.updateFullscreen', this.isFullscreen());\n    };\n\n    this.isFullscreen = function () {\n      return $editor.hasClass('fullscreen');\n    };\n  };\n\n  var Handle = function (context) {\n    var self = this;\n\n    var $document = $(document);\n    var $editingArea = context.layoutInfo.editingArea;\n    var options = context.options;\n\n    this.events = {\n      'summernote.mousedown': function (we, e) {\n        if (self.update(e.target)) {\n          e.preventDefault();\n        }\n      },\n      'summernote.keyup summernote.scroll summernote.change summernote.dialog.shown': function () {\n        self.update();\n      },\n      'summernote.disable': function () {\n        self.hide();\n      },\n      'summernote.codeview.toggled': function () {\n        self.update();\n      }\n    };\n\n    this.initialize = function () {\n      this.$handle = $([\n        '<div class=\"note-handle\">',\n        '<div class=\"note-control-selection\">',\n        '<div class=\"note-control-selection-bg\"></div>',\n        '<div class=\"note-control-holder note-control-nw\"></div>',\n        '<div class=\"note-control-holder note-control-ne\"></div>',\n        '<div class=\"note-control-holder note-control-sw\"></div>',\n        '<div class=\"',\n        (options.disableResizeImage ? 'note-control-holder' : 'note-control-sizing'),\n        ' note-control-se\"></div>',\n        (options.disableResizeImage ? '' : '<div class=\"note-control-selection-info\"></div>'),\n        '</div>',\n        '</div>'\n      ].join('')).prependTo($editingArea);\n\n      this.$handle.on('mousedown', function (event) {\n        if (dom.isControlSizing(event.target)) {\n          event.preventDefault();\n          event.stopPropagation();\n\n          var $target = self.$handle.find('.note-control-selection').data('target'),\n              posStart = $target.offset(),\n              scrollTop = $document.scrollTop();\n\n          var onMouseMove = function (event) {\n            context.invoke('editor.resizeTo', {\n              x: event.clientX - posStart.left,\n              y: event.clientY - (posStart.top - scrollTop)\n            }, $target, !event.shiftKey);\n\n            self.update($target[0]);\n          };\n\n          $document\n            .on('mousemove', onMouseMove)\n            .one('mouseup', function (e) {\n              e.preventDefault();\n              $document.off('mousemove', onMouseMove);\n              context.invoke('editor.afterCommand');\n            });\n\n          if (!$target.data('ratio')) { // original ratio.\n            $target.data('ratio', $target.height() / $target.width());\n          }\n        }\n      });\n\n      // Listen for scrolling on the handle overlay.\n      this.$handle.on('wheel', function (e) {\n        e.preventDefault();\n        self.update();\n      });\n    };\n\n    this.destroy = function () {\n      this.$handle.remove();\n    };\n\n    this.update = function (target) {\n      if (context.isDisabled()) {\n        return false;\n      }\n\n      var isImage = dom.isImg(target);\n      var $selection = this.$handle.find('.note-control-selection');\n\n      context.invoke('imagePopover.update', target);\n\n      if (isImage) {\n        var $image = $(target);\n        var position = $image.position();\n        var pos = {\n          left: position.left + parseInt($image.css('marginLeft'), 10),\n          top: position.top + parseInt($image.css('marginTop'), 10)\n        };\n\n        // exclude margin\n        var imageSize = {\n          w: $image.outerWidth(false),\n          h: $image.outerHeight(false)\n        };\n\n        $selection.css({\n          display: 'block',\n          left: pos.left,\n          top: pos.top,\n          width: imageSize.w,\n          height: imageSize.h\n        }).data('target', $image); // save current image element.\n\n        var sizingText = imageSize.w + 'x' + imageSize.h;\n        $selection.find('.note-control-selection-info').text(sizingText);\n        context.invoke('editor.saveTarget', target);\n      } else {\n        this.hide();\n      }\n\n      return isImage;\n    };\n\n    /**\n     * hide\n     *\n     * @param {jQuery} $handle\n     */\n    this.hide = function () {\n      context.invoke('editor.clearTarget');\n      this.$handle.children().hide();\n    };\n  };\n\n  var AutoLink = function (context) {\n    var self = this;\n    var defaultScheme = 'http://';\n    var linkPattern = /^([A-Za-z][A-Za-z0-9+-.]*\\:[\\/\\/]?|mailto:[A-Z0-9._%+-]+@)?(www\\.)?(.+)$/i;\n\n    this.events = {\n      'summernote.keyup': function (we, e) {\n        if (!e.isDefaultPrevented()) {\n          self.handleKeyup(e);\n        }\n      },\n      'summernote.keydown': function (we, e) {\n        self.handleKeydown(e);\n      }\n    };\n\n    this.initialize = function () {\n      this.lastWordRange = null;\n    };\n\n    this.destroy = function () {\n      this.lastWordRange = null;\n    };\n\n    this.replace = function () {\n      if (!this.lastWordRange) {\n        return;\n      }\n\n      var keyword = this.lastWordRange.toString();\n      var match = keyword.match(linkPattern);\n\n      if (match && (match[1] || match[2])) {\n        var link = match[1] ? keyword : defaultScheme + keyword;\n        var node = $('<a />').html(keyword).attr('href', link)[0];\n\n        this.lastWordRange.insertNode(node);\n        this.lastWordRange = null;\n        context.invoke('editor.focus');\n      }\n\n    };\n\n    this.handleKeydown = function (e) {\n      if (list.contains([key.code.ENTER, key.code.SPACE], e.keyCode)) {\n        var wordRange = context.invoke('editor.createRange').getWordRange();\n        this.lastWordRange = wordRange;\n      }\n    };\n\n    this.handleKeyup = function (e) {\n      if (list.contains([key.code.ENTER, key.code.SPACE], e.keyCode)) {\n        this.replace();\n      }\n    };\n  };\n\n  /**\n   * textarea auto sync.\n   */\n  var AutoSync = function (context) {\n    var $note = context.layoutInfo.note;\n\n    this.events = {\n      'summernote.change': function () {\n        $note.val(context.invoke('code'));\n      }\n    };\n\n    this.shouldInitialize = function () {\n      return dom.isTextarea($note[0]);\n    };\n  };\n\n  var Placeholder = function (context) {\n    var self = this;\n    var $editingArea = context.layoutInfo.editingArea;\n    var options = context.options;\n\n    this.events = {\n      'summernote.init summernote.change': function () {\n        self.update();\n      },\n      'summernote.codeview.toggled': function () {\n        self.update();\n      }\n    };\n\n    this.shouldInitialize = function () {\n      return !!options.placeholder;\n    };\n\n    this.initialize = function () {\n      this.$placeholder = $('<div class=\"note-placeholder\">');\n      this.$placeholder.on('click', function () {\n        context.invoke('focus');\n      }).text(options.placeholder).prependTo($editingArea);\n\n      this.update();\n    };\n\n    this.destroy = function () {\n      this.$placeholder.remove();\n    };\n\n    this.update = function () {\n      var isShow = !context.invoke('codeview.isActivated') && context.invoke('editor.isEmpty');\n      this.$placeholder.toggle(isShow);\n    };\n  };\n\n  var Buttons = function (context) {\n    var self = this;\n    var ui = $.summernote.ui;\n\n    var $toolbar = context.layoutInfo.toolbar;\n    var options = context.options;\n    var lang = options.langInfo;\n\n    var invertedKeyMap = func.invertObject(options.keyMap[agent.isMac ? 'mac' : 'pc']);\n\n    var representShortcut = this.representShortcut = function (editorMethod) {\n      var shortcut = invertedKeyMap[editorMethod];\n      if (!options.shortcuts || !shortcut) {\n        return '';\n      }\n\n      if (agent.isMac) {\n        shortcut = shortcut.replace('CMD', '').replace('SHIFT', '');\n      }\n\n      shortcut = shortcut.replace('BACKSLASH', '\\\\')\n                         .replace('SLASH', '/')\n                         .replace('LEFTBRACKET', '[')\n                         .replace('RIGHTBRACKET', ']');\n\n      return ' (' + shortcut + ')';\n    };\n\n    this.initialize = function () {\n      this.addToolbarButtons();\n      this.addImagePopoverButtons();\n      this.addLinkPopoverButtons();\n      this.addTablePopoverButtons();\n      this.fontInstalledMap = {};\n    };\n\n    this.destroy = function () {\n      delete this.fontInstalledMap;\n    };\n\n    this.isFontInstalled = function (name) {\n      if (!self.fontInstalledMap.hasOwnProperty(name)) {\n        self.fontInstalledMap[name] = agent.isFontInstalled(name) ||\n          list.contains(options.fontNamesIgnoreCheck, name);\n      }\n\n      return self.fontInstalledMap[name];\n    };\n\n    this.addToolbarButtons = function () {\n      context.memo('button.style', function () {\n        return ui.buttonGroup([\n          ui.button({\n            className: 'dropdown-toggle',\n            contents: ui.dropdownButtonContents(ui.icon(options.icons.magic), options),\n            tooltip: lang.style.style,\n            data: {\n              toggle: 'dropdown'\n            }\n          }),\n          ui.dropdown({\n            className: 'dropdown-style',\n            items: context.options.styleTags,\n            template: function (item) {\n\n              if (typeof item === 'string') {\n                item = { tag: item, title: (lang.style.hasOwnProperty(item) ? lang.style[item] : item) };\n              }\n\n              var tag = item.tag;\n              var title = item.title;\n              var style = item.style ? ' style=\"' + item.style + '\" ' : '';\n              var className = item.className ? ' class=\"' + item.className + '\"' : '';\n\n              return '<' + tag + style + className + '>' + title + '</' + tag +  '>';\n            },\n            click: context.createInvokeHandler('editor.formatBlock')\n          })\n        ]).render();\n      });\n\n      context.memo('button.bold', function () {\n        return ui.button({\n          className: 'note-btn-bold',\n          contents: ui.icon(options.icons.bold),\n          tooltip: lang.font.bold + representShortcut('bold'),\n          click: context.createInvokeHandlerAndUpdateState('editor.bold')\n        }).render();\n      });\n\n      context.memo('button.italic', function () {\n        return ui.button({\n          className: 'note-btn-italic',\n          contents: ui.icon(options.icons.italic),\n          tooltip: lang.font.italic + representShortcut('italic'),\n          click: context.createInvokeHandlerAndUpdateState('editor.italic')\n        }).render();\n      });\n\n      context.memo('button.underline', function () {\n        return ui.button({\n          className: 'note-btn-underline',\n          contents: ui.icon(options.icons.underline),\n          tooltip: lang.font.underline + representShortcut('underline'),\n          click: context.createInvokeHandlerAndUpdateState('editor.underline')\n        }).render();\n      });\n\n      context.memo('button.clear', function () {\n        return ui.button({\n          contents: ui.icon(options.icons.eraser),\n          tooltip: lang.font.clear + representShortcut('removeFormat'),\n          click: context.createInvokeHandler('editor.removeFormat')\n        }).render();\n      });\n\n      context.memo('button.strikethrough', function () {\n        return ui.button({\n          className: 'note-btn-strikethrough',\n          contents: ui.icon(options.icons.strikethrough),\n          tooltip: lang.font.strikethrough + representShortcut('strikethrough'),\n          click: context.createInvokeHandlerAndUpdateState('editor.strikethrough')\n        }).render();\n      });\n\n      context.memo('button.superscript', function () {\n        return ui.button({\n          className: 'note-btn-superscript',\n          contents: ui.icon(options.icons.superscript),\n          tooltip: lang.font.superscript,\n          click: context.createInvokeHandlerAndUpdateState('editor.superscript')\n        }).render();\n      });\n\n      context.memo('button.subscript', function () {\n        return ui.button({\n          className: 'note-btn-subscript',\n          contents: ui.icon(options.icons.subscript),\n          tooltip: lang.font.subscript,\n          click: context.createInvokeHandlerAndUpdateState('editor.subscript')\n        }).render();\n      });\n\n      context.memo('button.fontname', function () {\n        return ui.buttonGroup([\n          ui.button({\n            className: 'dropdown-toggle',\n            contents: ui.dropdownButtonContents('<span class=\"note-current-fontname\"/>', options),\n            tooltip: lang.font.name,\n            data: {\n              toggle: 'dropdown'\n            }\n          }),\n          ui.dropdownCheck({\n            className: 'dropdown-fontname',\n            checkClassName: options.icons.menuCheck,\n            items: options.fontNames.filter(self.isFontInstalled),\n            template: function (item) {\n              return '<span style=\"font-family:' + item + '\">' + item + '</span>';\n            },\n            click: context.createInvokeHandlerAndUpdateState('editor.fontName')\n          })\n        ]).render();\n      });\n\n      context.memo('button.fontsize', function () {\n        return ui.buttonGroup([\n          ui.button({\n            className: 'dropdown-toggle',\n            contents: ui.dropdownButtonContents('<span class=\"note-current-fontsize\"/>', options),\n            tooltip: lang.font.size,\n            data: {\n              toggle: 'dropdown'\n            }\n          }),\n          ui.dropdownCheck({\n            className: 'dropdown-fontsize',\n            checkClassName: options.icons.menuCheck,\n            items: options.fontSizes,\n            click: context.createInvokeHandlerAndUpdateState('editor.fontSize')\n          })\n        ]).render();\n      });\n\n      context.memo('button.color', function () {\n        return ui.buttonGroup({\n          className: 'note-color',\n          children: [\n            ui.button({\n              className: 'note-current-color-button',\n              contents: ui.icon(options.icons.font + ' note-recent-color'),\n              tooltip: lang.color.recent,\n              click: function (e) {\n                var $button = $(e.currentTarget);\n                context.invoke('editor.color', {\n                  backColor: $button.attr('data-backColor'),\n                  foreColor: $button.attr('data-foreColor')\n                });\n              },\n              callback: function ($button) {\n                var $recentColor = $button.find('.note-recent-color');\n                $recentColor.css('background-color', '#FFFF00');\n                $button.attr('data-backColor', '#FFFF00');\n              }\n            }),\n            ui.button({\n              className: 'dropdown-toggle',\n              contents: ui.dropdownButtonContents('', options),\n              tooltip: lang.color.more,\n              data: {\n                toggle: 'dropdown'\n              }\n            }),\n            ui.dropdown({\n              items: [\n                '<div class=\"note-palette\">',\n                '  <div class=\"note-palette-title\">' + lang.color.background + '</div>',\n                '  <div>',\n                '    <button type=\"button\" class=\"note-color-reset btn btn-light\" data-event=\"backColor\" data-value=\"inherit\">',\n                lang.color.transparent,\n                '    </button>',\n                '  </div>',\n                '  <div class=\"note-holder\" data-event=\"backColor\"/>',\n                '</div>',\n                '<div class=\"note-palette\">',\n                '  <div class=\"note-palette-title\">' + lang.color.foreground + '</div>',\n                '  <div>',\n                '    <button type=\"button\" class=\"note-color-reset btn btn-light\" data-event=\"removeFormat\" data-value=\"foreColor\">',\n                lang.color.resetToDefault,\n                '    </button>',\n                '  </div>',\n                '  <div class=\"note-holder\" data-event=\"foreColor\"/>',\n                '</div>'\n              ].join(''),\n              callback: function ($dropdown) {\n                $dropdown.find('.note-holder').each(function () {\n                  var $holder = $(this);\n                  $holder.append(ui.palette({\n                    colors: options.colors,\n                    eventName: $holder.data('event'),\n                    tooltip: options.tooltip\n                  }).render());\n                });\n              },\n              click: function (event) {\n                var $button = $(event.target);\n                var eventName = $button.data('event');\n                var value = $button.data('value');\n\n                if (eventName && value) {\n                  var key = eventName === 'backColor' ? 'background-color' : 'color';\n                  var $color = $button.closest('.note-color').find('.note-recent-color');\n                  var $currentButton = $button.closest('.note-color').find('.note-current-color-button');\n\n                  $color.css(key, value);\n                  $currentButton.attr('data-' + eventName, value);\n                  context.invoke('editor.' + eventName, value);\n                }\n              }\n            })\n          ]\n        }).render();\n      });\n\n      context.memo('button.ul',  function () {\n        return ui.button({\n          contents: ui.icon(options.icons.unorderedlist),\n          tooltip: lang.lists.unordered + representShortcut('insertUnorderedList'),\n          click: context.createInvokeHandler('editor.insertUnorderedList')\n        }).render();\n      });\n\n      context.memo('button.ol', function () {\n        return ui.button({\n          contents: ui.icon(options.icons.orderedlist),\n          tooltip: lang.lists.ordered + representShortcut('insertOrderedList'),\n          click:  context.createInvokeHandler('editor.insertOrderedList')\n        }).render();\n      });\n\n      var justifyLeft = ui.button({\n        contents: ui.icon(options.icons.alignLeft),\n        tooltip: lang.paragraph.left + representShortcut('justifyLeft'),\n        click: context.createInvokeHandler('editor.justifyLeft')\n      });\n\n      var justifyCenter = ui.button({\n        contents: ui.icon(options.icons.alignCenter),\n        tooltip: lang.paragraph.center + representShortcut('justifyCenter'),\n        click: context.createInvokeHandler('editor.justifyCenter')\n      });\n\n      var justifyRight = ui.button({\n        contents: ui.icon(options.icons.alignRight),\n        tooltip: lang.paragraph.right + representShortcut('justifyRight'),\n        click: context.createInvokeHandler('editor.justifyRight')\n      });\n\n      var justifyFull = ui.button({\n        contents: ui.icon(options.icons.alignJustify),\n        tooltip: lang.paragraph.justify + representShortcut('justifyFull'),\n        click: context.createInvokeHandler('editor.justifyFull')\n      });\n\n      var outdent = ui.button({\n        contents: ui.icon(options.icons.outdent),\n        tooltip: lang.paragraph.outdent + representShortcut('outdent'),\n        click: context.createInvokeHandler('editor.outdent')\n      });\n\n      var indent = ui.button({\n        contents: ui.icon(options.icons.indent),\n        tooltip: lang.paragraph.indent + representShortcut('indent'),\n        click: context.createInvokeHandler('editor.indent')\n      });\n\n      context.memo('button.justifyLeft', func.invoke(justifyLeft, 'render'));\n      context.memo('button.justifyCenter', func.invoke(justifyCenter, 'render'));\n      context.memo('button.justifyRight', func.invoke(justifyRight, 'render'));\n      context.memo('button.justifyFull', func.invoke(justifyFull, 'render'));\n      context.memo('button.outdent', func.invoke(outdent, 'render'));\n      context.memo('button.indent', func.invoke(indent, 'render'));\n\n      context.memo('button.paragraph', function () {\n        return ui.buttonGroup([\n          ui.button({\n            className: 'dropdown-toggle',\n            contents: ui.dropdownButtonContents(ui.icon(options.icons.alignLeft), options),\n            tooltip: lang.paragraph.paragraph,\n            data: {\n              toggle: 'dropdown'\n            }\n          }),\n          ui.dropdown([\n            ui.buttonGroup({\n              className: 'note-align',\n              children: [justifyLeft, justifyCenter, justifyRight, justifyFull]\n            }),\n            ui.buttonGroup({\n              className: 'note-list',\n              children: [outdent, indent]\n            })\n          ])\n        ]).render();\n      });\n\n      context.memo('button.height', function () {\n        return ui.buttonGroup([\n          ui.button({\n            className: 'dropdown-toggle',\n            contents: ui.dropdownButtonContents(ui.icon(options.icons.textHeight), options),\n            tooltip: lang.font.height,\n            data: {\n              toggle: 'dropdown'\n            }\n          }),\n          ui.dropdownCheck({\n            items: options.lineHeights,\n            checkClassName: options.icons.menuCheck,\n            className: 'dropdown-line-height',\n            click: context.createInvokeHandler('editor.lineHeight')\n          })\n        ]).render();\n      });\n\n      context.memo('button.table', function () {\n        return ui.buttonGroup([\n          ui.button({\n            className: 'dropdown-toggle',\n            contents: ui.dropdownButtonContents(ui.icon(options.icons.table), options),\n            tooltip: lang.table.table,\n            data: {\n              toggle: 'dropdown'\n            }\n          }),\n          ui.dropdown({\n            className: 'note-table',\n            items: [\n              '<div class=\"note-dimension-picker\">',\n              '  <div class=\"note-dimension-picker-mousecatcher\" data-event=\"insertTable\" data-value=\"1x1\"/>',\n              '  <div class=\"note-dimension-picker-highlighted\"/>',\n              '  <div class=\"note-dimension-picker-unhighlighted\"/>',\n              '</div>',\n              '<div class=\"note-dimension-display\">1 x 1</div>'\n            ].join('')\n          })\n        ], {\n          callback: function ($node) {\n            var $catcher = $node.find('.note-dimension-picker-mousecatcher');\n            $catcher.css({\n              width: options.insertTableMaxSize.col + 'em',\n              height: options.insertTableMaxSize.row + 'em'\n            }).mousedown(context.createInvokeHandler('editor.insertTable'))\n              .on('mousemove', self.tableMoveHandler);\n          }\n        }).render();\n      });\n\n      context.memo('button.link', function () {\n        return ui.button({\n          contents: ui.icon(options.icons.link),\n          tooltip: lang.link.link + representShortcut('linkDialog.show'),\n          click: context.createInvokeHandler('linkDialog.show')\n        }).render();\n      });\n\n      context.memo('button.picture', function () {\n        return ui.button({\n          contents: ui.icon(options.icons.picture),\n          tooltip: lang.image.image,\n          click: context.createInvokeHandler('imageDialog.show')\n        }).render();\n      });\n\n      context.memo('button.video', function () {\n        return ui.button({\n          contents: ui.icon(options.icons.video),\n          tooltip: lang.video.video,\n          click: context.createInvokeHandler('videoDialog.show')\n        }).render();\n      });\n\n      context.memo('button.hr', function () {\n        return ui.button({\n          contents: ui.icon(options.icons.minus),\n          tooltip: lang.hr.insert + representShortcut('insertHorizontalRule'),\n          click: context.createInvokeHandler('editor.insertHorizontalRule')\n        }).render();\n      });\n\n      context.memo('button.fullscreen', function () {\n        return ui.button({\n          className: 'btn-fullscreen',\n          contents: ui.icon(options.icons.arrowsAlt),\n          tooltip: lang.options.fullscreen,\n          click: context.createInvokeHandler('fullscreen.toggle')\n        }).render();\n      });\n\n      context.memo('button.codeview', function () {\n        return ui.button({\n          className: 'btn-codeview',\n          contents: ui.icon(options.icons.code),\n          tooltip: lang.options.codeview,\n          click: context.createInvokeHandler('codeview.toggle')\n        }).render();\n      });\n\n      context.memo('button.redo', function () {\n        return ui.button({\n          contents: ui.icon(options.icons.redo),\n          tooltip: lang.history.redo + representShortcut('redo'),\n          click: context.createInvokeHandler('editor.redo')\n        }).render();\n      });\n\n      context.memo('button.undo', function () {\n        return ui.button({\n          contents: ui.icon(options.icons.undo),\n          tooltip: lang.history.undo + representShortcut('undo'),\n          click: context.createInvokeHandler('editor.undo')\n        }).render();\n      });\n\n      context.memo('button.help', function () {\n        return ui.button({\n          contents: ui.icon(options.icons.question),\n          tooltip: lang.options.help,\n          click: context.createInvokeHandler('helpDialog.show')\n        }).render();\n      });\n    };\n\n    /**\n     * image : [\n     *   ['imagesize', ['imageSize100', 'imageSize50', 'imageSize25']],\n     *   ['float', ['floatLeft', 'floatRight', 'floatNone' ]],\n     *   ['remove', ['removeMedia']]\n     * ],\n     */\n    this.addImagePopoverButtons = function () {\n      // Image Size Buttons\n      context.memo('button.imageSize100', function () {\n        return ui.button({\n          contents: '<span class=\"note-fontsize-10\">100%</span>',\n          tooltip: lang.image.resizeFull,\n          click: context.createInvokeHandler('editor.resize', '1')\n        }).render();\n      });\n      context.memo('button.imageSize50', function () {\n        return  ui.button({\n          contents: '<span class=\"note-fontsize-10\">50%</span>',\n          tooltip: lang.image.resizeHalf,\n          click: context.createInvokeHandler('editor.resize', '0.5')\n        }).render();\n      });\n      context.memo('button.imageSize25', function () {\n        return ui.button({\n          contents: '<span class=\"note-fontsize-10\">25%</span>',\n          tooltip: lang.image.resizeQuarter,\n          click: context.createInvokeHandler('editor.resize', '0.25')\n        }).render();\n      });\n\n      // Float Buttons\n      context.memo('button.floatLeft', function () {\n        return ui.button({\n          contents: ui.icon(options.icons.alignLeft),\n          tooltip: lang.image.floatLeft,\n          click: context.createInvokeHandler('editor.floatMe', 'left')\n        }).render();\n      });\n\n      context.memo('button.floatRight', function () {\n        return ui.button({\n          contents: ui.icon(options.icons.alignRight),\n          tooltip: lang.image.floatRight,\n          click: context.createInvokeHandler('editor.floatMe', 'right')\n        }).render();\n      });\n\n      context.memo('button.floatNone', function () {\n        return ui.button({\n          contents: ui.icon(options.icons.alignJustify),\n          tooltip: lang.image.floatNone,\n          click: context.createInvokeHandler('editor.floatMe', 'none')\n        }).render();\n      });\n\n      // Remove Buttons\n      context.memo('button.removeMedia', function () {\n        return ui.button({\n          contents: ui.icon(options.icons.trash),\n          tooltip: lang.image.remove,\n          click: context.createInvokeHandler('editor.removeMedia')\n        }).render();\n      });\n    };\n\n    this.addLinkPopoverButtons = function () {\n      context.memo('button.linkDialogShow', function () {\n        return ui.button({\n          contents: ui.icon(options.icons.link),\n          tooltip: lang.link.edit,\n          click: context.createInvokeHandler('linkDialog.show')\n        }).render();\n      });\n\n      context.memo('button.unlink', function () {\n        return ui.button({\n          contents: ui.icon(options.icons.unlink),\n          tooltip: lang.link.unlink,\n          click: context.createInvokeHandler('editor.unlink')\n        }).render();\n      });\n    };\n\n    /**\n     * table : [\n     *  ['add', ['addRowDown', 'addRowUp', 'addColLeft', 'addColRight']],\n     *  ['delete', ['deleteRow', 'deleteCol', 'deleteTable']]\n     * ],\n     */\n    this.addTablePopoverButtons = function () {\n      context.memo('button.addRowUp', function () {\n        return ui.button({\n          className: 'btn-md',\n          contents: ui.icon(options.icons.rowAbove),\n          tooltip: lang.table.addRowAbove,\n          click: context.createInvokeHandler('editor.addRow', 'top')\n        }).render();\n      });\n      context.memo('button.addRowDown', function () {\n        return ui.button({\n          className: 'btn-md',\n          contents: ui.icon(options.icons.rowBelow),\n          tooltip: lang.table.addRowBelow,\n          click: context.createInvokeHandler('editor.addRow', 'bottom')\n        }).render();\n      });\n      context.memo('button.addColLeft', function () {\n        return ui.button({\n          className: 'btn-md',\n          contents: ui.icon(options.icons.colBefore),\n          tooltip: lang.table.addColLeft,\n          click: context.createInvokeHandler('editor.addCol', 'left')\n        }).render();\n      });\n      context.memo('button.addColRight', function () {\n        return ui.button({\n          className: 'btn-md',\n          contents: ui.icon(options.icons.colAfter),\n          tooltip: lang.table.addColRight,\n          click: context.createInvokeHandler('editor.addCol', 'right')\n        }).render();\n      });\n      context.memo('button.deleteRow', function () {\n        return ui.button({\n          className: 'btn-md',\n          contents: ui.icon(options.icons.rowRemove),\n          tooltip: lang.table.delRow,\n          click: context.createInvokeHandler('editor.deleteRow')\n        }).render();\n      });\n      context.memo('button.deleteCol', function () {\n        return ui.button({\n          className: 'btn-md',\n          contents: ui.icon(options.icons.colRemove),\n          tooltip: lang.table.delCol,\n          click: context.createInvokeHandler('editor.deleteCol')\n        }).render();\n      });\n      context.memo('button.deleteTable', function () {\n        return ui.button({\n          className: 'btn-md',\n          contents: ui.icon(options.icons.trash),\n          tooltip: lang.table.delTable,\n          click: context.createInvokeHandler('editor.deleteTable')\n        }).render();\n      });\n    };\n\n    this.build = function ($container, groups) {\n      for (var groupIdx = 0, groupLen = groups.length; groupIdx < groupLen; groupIdx++) {\n        var group = groups[groupIdx];\n        var groupName = group[0];\n        var buttons = group[1];\n\n        var $group = ui.buttonGroup({\n          className: 'note-' + groupName\n        }).render();\n\n        for (var idx = 0, len = buttons.length; idx < len; idx++) {\n          var button = context.memo('button.' + buttons[idx]);\n          if (button) {\n            $group.append(typeof button === 'function' ? button(context) : button);\n          }\n        }\n        $group.appendTo($container);\n      }\n    };\n\n    /**\n     * @param {jQuery} [$container]\n     */\n    this.updateCurrentStyle = function ($container) {\n      var $cont = $container || $toolbar;\n      \n      var styleInfo = context.invoke('editor.currentStyle');\n      this.updateBtnStates($cont, {\n        '.note-btn-bold': function () {\n          return styleInfo['font-bold'] === 'bold';\n        },\n        '.note-btn-italic': function () {\n          return styleInfo['font-italic'] === 'italic';\n        },\n        '.note-btn-underline': function () {\n          return styleInfo['font-underline'] === 'underline';\n        },\n        '.note-btn-subscript': function () {\n          return styleInfo['font-subscript'] === 'subscript';\n        },\n        '.note-btn-superscript': function () {\n          return styleInfo['font-superscript'] === 'superscript';\n        },\n        '.note-btn-strikethrough': function () {\n          return styleInfo['font-strikethrough'] === 'strikethrough';\n        }\n      });\n\n      if (styleInfo['font-family']) {\n        var fontNames = styleInfo['font-family'].split(',').map(function (name) {\n          return name.replace(/[\\'\\\"]/g, '')\n            .replace(/\\s+$/, '')\n            .replace(/^\\s+/, '');\n        });\n        var fontName = list.find(fontNames, self.isFontInstalled);\n\n        $cont.find('.dropdown-fontname a').each(function () {\n          var $item = $(this);\n          // always compare string to avoid creating another func.\n          var isChecked = ($item.data('value') + '') === (fontName + '');\n          $item.toggleClass('checked', isChecked);\n        });\n        $cont.find('.note-current-fontname').text(fontName);\n      }\n\n      if (styleInfo['font-size']) {\n        var fontSize = styleInfo['font-size'];\n        $cont.find('.dropdown-fontsize a').each(function () {\n          var $item = $(this);\n          // always compare with string to avoid creating another func.\n          var isChecked = ($item.data('value') + '') === (fontSize + '');\n          $item.toggleClass('checked', isChecked);\n        });\n        $cont.find('.note-current-fontsize').text(fontSize);\n      }\n\n      if (styleInfo['line-height']) {\n        var lineHeight = styleInfo['line-height'];\n        $cont.find('.dropdown-line-height li a').each(function () {\n          // always compare with string to avoid creating another func.\n          var isChecked = ($(this).data('value') + '') === (lineHeight + '');\n          this.className = isChecked ? 'checked' : '';\n        });\n      }\n    };\n\n    this.updateBtnStates = function ($container, infos) {\n      $.each(infos, function (selector, pred) {\n        ui.toggleBtnActive($container.find(selector), pred());\n      });\n    };\n\n    this.tableMoveHandler = function (event) {\n      var PX_PER_EM = 18;\n      var $picker = $(event.target.parentNode); // target is mousecatcher\n      var $dimensionDisplay = $picker.next();\n      var $catcher = $picker.find('.note-dimension-picker-mousecatcher');\n      var $highlighted = $picker.find('.note-dimension-picker-highlighted');\n      var $unhighlighted = $picker.find('.note-dimension-picker-unhighlighted');\n\n      var posOffset;\n      // HTML5 with jQuery - e.offsetX is undefined in Firefox\n      if (event.offsetX === undefined) {\n        var posCatcher = $(event.target).offset();\n        posOffset = {\n          x: event.pageX - posCatcher.left,\n          y: event.pageY - posCatcher.top\n        };\n      } else {\n        posOffset = {\n          x: event.offsetX,\n          y: event.offsetY\n        };\n      }\n\n      var dim = {\n        c: Math.ceil(posOffset.x / PX_PER_EM) || 1,\n        r: Math.ceil(posOffset.y / PX_PER_EM) || 1\n      };\n\n      $highlighted.css({ width: dim.c + 'em', height: dim.r + 'em' });\n      $catcher.data('value', dim.c + 'x' + dim.r);\n\n      if (3 < dim.c && dim.c < options.insertTableMaxSize.col) {\n        $unhighlighted.css({ width: dim.c + 1 + 'em'});\n      }\n\n      if (3 < dim.r && dim.r < options.insertTableMaxSize.row) {\n        $unhighlighted.css({ height: dim.r + 1 + 'em'});\n      }\n\n      $dimensionDisplay.html(dim.c + ' x ' + dim.r);\n    };\n  };\n\n  var Toolbar = function (context) {\n    var ui = $.summernote.ui;\n\n    var $note = context.layoutInfo.note;\n    var $editor = context.layoutInfo.editor;\n    var $toolbar = context.layoutInfo.toolbar;\n    var options = context.options;\n\n    this.shouldInitialize = function () {\n      return !options.airMode;\n    };\n\n    this.initialize = function () {\n      options.toolbar = options.toolbar || [];\n\n      if (!options.toolbar.length) {\n        $toolbar.hide();\n      } else {\n        context.invoke('buttons.build', $toolbar, options.toolbar);\n      }\n\n      if (options.toolbarContainer) {\n        $toolbar.appendTo(options.toolbarContainer);\n      }\n\n      this.changeContainer(false);\n\n      $note.on('summernote.keyup summernote.mouseup summernote.change', function () {\n        context.invoke('buttons.updateCurrentStyle');\n      });\n\n      context.invoke('buttons.updateCurrentStyle');\n    };\n\n    this.destroy = function () {\n      $toolbar.children().remove();\n    };\n\n    this.changeContainer = function (isFullscreen) {\n      if (isFullscreen) {\n        $toolbar.prependTo($editor);\n      } else {\n        if (options.toolbarContainer) {\n          $toolbar.appendTo(options.toolbarContainer);\n        }\n      }\n    };\n\n    this.updateFullscreen = function (isFullscreen) {\n      ui.toggleBtnActive($toolbar.find('.btn-fullscreen'), isFullscreen);\n\n      this.changeContainer(isFullscreen);\n    };\n\n    this.updateCodeview = function (isCodeview) {\n      ui.toggleBtnActive($toolbar.find('.btn-codeview'), isCodeview);\n      if (isCodeview) {\n        this.deactivate();\n      } else {\n        this.activate();\n      }\n    };\n\n    this.activate = function (isIncludeCodeview) {\n      var $btn = $toolbar.find('button');\n      if (!isIncludeCodeview) {\n        $btn = $btn.not('.btn-codeview');\n      }\n      ui.toggleBtn($btn, true);\n    };\n\n    this.deactivate = function (isIncludeCodeview) {\n      var $btn = $toolbar.find('button');\n      if (!isIncludeCodeview) {\n        $btn = $btn.not('.btn-codeview');\n      }\n      ui.toggleBtn($btn, false);\n    };\n  };\n\n  var LinkDialog = function (context) {\n    var self = this;\n    var ui = $.summernote.ui;\n\n    var $editor = context.layoutInfo.editor;\n    var options = context.options;\n    var lang = options.langInfo;\n\n    this.initialize = function () {\n      var $container = options.dialogsInBody ? $(document.body) : $editor;\n\n      var body = '<div class=\"form-group note-form-group\">' +\n                   '<label class=\"note-form-label\">' + lang.link.textToDisplay + '</label>' +\n                   '<input class=\"note-link-text form-control '+\n                   ' note-form-control  note-input\" type=\"text\" />' +\n                 '</div>' +\n                 '<div class=\"form-group note-form-group\">' +\n                   '<label class=\"note-form-label\">' + lang.link.url + '</label>' +\n                   '<input class=\"note-link-url form-control note-form-control ' +\n                   'note-input\" type=\"text\" value=\"http://\" />' +\n                 '</div>' +\n      (!options.disableLinkTarget ?\n          $('<div/>').append(ui.checkbox({ id: 'sn-checkbox-open-in-new-window', text: lang.link.openInNewWindow, checked: true }).render())\n              .html()\n          : '');\n      var footer = '<button href=\"#\" class=\"btn btn-primary note-btn note-btn-primary ' +\n      'note-link-btn disabled\" disabled>' + lang.link.insert + '</button>';\n\n      this.$dialog = ui.dialog({\n        className: 'link-dialog',\n        title: lang.link.insert,\n        fade: options.dialogsFade,\n        body: body,\n        footer: footer\n      }).render().appendTo($container);\n    };\n\n    this.destroy = function () {\n      ui.hideDialog(this.$dialog);\n      this.$dialog.remove();\n    };\n\n    this.bindEnterKey = function ($input, $btn) {\n      $input.on('keypress', function (event) {\n        if (event.keyCode === key.code.ENTER) {\n          $btn.trigger('click');\n        }\n      });\n    };\n\n    /**\n     * toggle update button\n     */\n    this.toggleLinkBtn = function ($linkBtn, $linkText, $linkUrl) {\n      ui.toggleBtn($linkBtn, $linkText.val() && $linkUrl.val());\n    };\n\n    /**\n     * Show link dialog and set event handlers on dialog controls.\n     *\n     * @param {Object} linkInfo\n     * @return {Promise}\n     */\n    this.showLinkDialog = function (linkInfo) {\n      return $.Deferred(function (deferred) {\n        var $linkText = self.$dialog.find('.note-link-text'),\n        $linkUrl = self.$dialog.find('.note-link-url'),\n        $linkBtn = self.$dialog.find('.note-link-btn'),\n        $openInNewWindow = self.$dialog.find('input[type=checkbox]');\n\n        ui.onDialogShown(self.$dialog, function () {\n          context.triggerEvent('dialog.shown');\n\n          // if no url was given, copy text to url\n          if (!linkInfo.url) {\n            linkInfo.url = linkInfo.text;\n          }\n\n          $linkText.val(linkInfo.text);\n\n          var handleLinkTextUpdate = function () {\n            self.toggleLinkBtn($linkBtn, $linkText, $linkUrl);\n            // if linktext was modified by keyup,\n            // stop cloning text from linkUrl\n            linkInfo.text = $linkText.val();\n          };\n\n          $linkText.on('input', handleLinkTextUpdate).on('paste', function () {\n            setTimeout(handleLinkTextUpdate, 0);\n          });\n\n          var handleLinkUrlUpdate = function () {\n            self.toggleLinkBtn($linkBtn, $linkText, $linkUrl);\n            // display same link on `Text to display` input\n            // when create a new link\n            if (!linkInfo.text) {\n              $linkText.val($linkUrl.val());\n            }\n          };\n\n          $linkUrl.on('input', handleLinkUrlUpdate).on('paste', function () {\n            setTimeout(handleLinkUrlUpdate, 0);\n          }).val(linkInfo.url).trigger('focus');\n\n          self.toggleLinkBtn($linkBtn, $linkText, $linkUrl);\n          self.bindEnterKey($linkUrl, $linkBtn);\n          self.bindEnterKey($linkText, $linkBtn);\n\n          var isChecked = linkInfo.isNewWindow !== undefined ?\n            linkInfo.isNewWindow : context.options.linkTargetBlank;\n\n          $openInNewWindow.prop('checked', isChecked);\n\n          $linkBtn.one('click', function (event) {\n            event.preventDefault();\n\n            deferred.resolve({\n              range: linkInfo.range,\n              url: $linkUrl.val(),\n              text: $linkText.val(),\n              isNewWindow: $openInNewWindow.is(':checked')\n            });\n            ui.hideDialog(self.$dialog);\n          });\n        });\n\n        ui.onDialogHidden(self.$dialog, function () {\n          // detach events\n          $linkText.off('input paste keypress');\n          $linkUrl.off('input paste keypress');\n          $linkBtn.off('click');\n\n          if (deferred.state() === 'pending') {\n            deferred.reject();\n          }\n        });\n\n        ui.showDialog(self.$dialog);\n      }).promise();\n    };\n\n    /**\n     * @param {Object} layoutInfo\n     */\n    this.show = function () {\n      var linkInfo = context.invoke('editor.getLinkInfo');\n\n      context.invoke('editor.saveRange');\n      this.showLinkDialog(linkInfo).then(function (linkInfo) {\n        context.invoke('editor.restoreRange');\n        context.invoke('editor.createLink', linkInfo);\n      }).fail(function () {\n        context.invoke('editor.restoreRange');\n      });\n    };\n    context.memo('help.linkDialog.show', options.langInfo.help['linkDialog.show']);\n  };\n\n  var LinkPopover = function (context) {\n    var self = this;\n    var ui = $.summernote.ui;\n\n    var options = context.options;\n\n    this.events = {\n      'summernote.keyup summernote.mouseup summernote.change summernote.scroll': function () {\n        self.update();\n      },\n      'summernote.disable summernote.dialog.shown': function () {\n        self.hide();\n      }\n    };\n\n    this.shouldInitialize = function () {\n      return !list.isEmpty(options.popover.link);\n    };\n\n    this.initialize = function () {\n      this.$popover = ui.popover({\n        className: 'note-link-popover',\n        callback: function ($node) {\n          var $content = $node.find('.popover-content,.note-popover-content');\n          $content.prepend('<span><a target=\"_blank\"></a>&nbsp;</span>');\n        }\n      }).render().appendTo('body');\n      var $content = this.$popover.find('.popover-content,.note-popover-content');\n\n      context.invoke('buttons.build', $content, options.popover.link);\n    };\n\n    this.destroy = function () {\n      this.$popover.remove();\n    };\n\n    this.update = function () {\n      // Prevent focusing on editable when invoke('code') is executed\n      if (!context.invoke('editor.hasFocus')) {\n        this.hide();\n        return;\n      }\n\n      var rng = context.invoke('editor.createRange');\n      if (rng.isCollapsed() && rng.isOnAnchor()) {\n        var anchor = dom.ancestor(rng.sc, dom.isAnchor);\n        var href = $(anchor).attr('href');\n        this.$popover.find('a').attr('href', href).html(href);\n\n        var pos = dom.posFromPlaceholder(anchor);\n        this.$popover.css({\n          display: 'block',\n          left: pos.left,\n          top: pos.top\n        });\n      } else {\n        this.hide();\n      }\n    };\n\n    this.hide = function () {\n      this.$popover.hide();\n    };\n  };\n\n  var ImageDialog = function (context) {\n    var self = this;\n    var ui = $.summernote.ui;\n\n    var $editor = context.layoutInfo.editor;\n    var options = context.options;\n    var lang = options.langInfo;\n\n    this.initialize = function () {\n      var $container = options.dialogsInBody ? $(document.body) : $editor;\n\n      var imageLimitation = '';\n      if (options.maximumImageFileSize) {\n        var unit = Math.floor(Math.log(options.maximumImageFileSize) / Math.log(1024));\n        var readableSize = (options.maximumImageFileSize / Math.pow(1024, unit)).toFixed(2) * 1 +\n                           ' ' + ' KMGTP'[unit] + 'B';\n        imageLimitation = '<small>' + lang.image.maximumFileSize + ' : ' + readableSize + '</small>';\n      }\n\n      var body = '<div class=\"form-group note-form-group note-group-select-from-files\">' +\n                   '<label class=\"note-form-label\">' + lang.image.selectFromFiles + '</label>' +\n                   '<input class=\"note-image-input form-control note-form-control note-input\" '+\n                   ' type=\"file\" name=\"files\" accept=\"image/*\" multiple=\"multiple\" />' +\n                   imageLimitation +\n                 '</div>' + \n                 '<div class=\"form-group note-group-image-url\" style=\"overflow:auto;\">' +\n                   '<label class=\"note-form-label\">' + lang.image.url + '</label>' +\n                   '<input class=\"note-image-url form-control note-form-control note-input ' +\n                   ' col-md-12\" type=\"text\" />' +\n                 '</div>';\n      var footer = '<button href=\"#\" class=\"btn btn-primary note-btn note-btn-primary ' +\n      'note-image-btn disabled\" disabled>' + lang.image.insert + '</button>';\n\n      this.$dialog = ui.dialog({\n        title: lang.image.insert,\n        fade: options.dialogsFade,\n        body: body,\n        footer: footer\n      }).render().appendTo($container);\n    };\n\n    this.destroy = function () {\n      ui.hideDialog(this.$dialog);\n      this.$dialog.remove();\n    };\n\n    this.bindEnterKey = function ($input, $btn) {\n      $input.on('keypress', function (event) {\n        if (event.keyCode === key.code.ENTER) {\n          $btn.trigger('click');\n        }\n      });\n    };\n\n    this.show = function () {\n      context.invoke('editor.saveRange');\n      this.showImageDialog().then(function (data) {\n        // [workaround] hide dialog before restore range for IE range focus\n        ui.hideDialog(self.$dialog);\n        context.invoke('editor.restoreRange');\n\n        if (typeof data === 'string') { // image url\n          context.invoke('editor.insertImage', data);\n        } else { // array of files\n          context.invoke('editor.insertImagesOrCallback', data);\n        }\n      }).fail(function () {\n        context.invoke('editor.restoreRange');\n      });\n    };\n\n    /**\n     * show image dialog\n     *\n     * @param {jQuery} $dialog\n     * @return {Promise}\n     */\n    this.showImageDialog = function () {\n      return $.Deferred(function (deferred) {\n        var $imageInput = self.$dialog.find('.note-image-input'),\n            $imageUrl = self.$dialog.find('.note-image-url'),\n            $imageBtn = self.$dialog.find('.note-image-btn');\n\n        ui.onDialogShown(self.$dialog, function () {\n          context.triggerEvent('dialog.shown');\n\n          // Cloning imageInput to clear element.\n          $imageInput.replaceWith($imageInput.clone()\n            .on('change', function () {\n              deferred.resolve(this.files || this.value);\n            })\n            .val('')\n          );\n\n          $imageBtn.click(function (event) {\n            event.preventDefault();\n\n            deferred.resolve($imageUrl.val());\n          });\n\n          $imageUrl.on('keyup paste', function () {\n            var url = $imageUrl.val();\n            ui.toggleBtn($imageBtn, url);\n          }).val('').trigger('focus');\n          self.bindEnterKey($imageUrl, $imageBtn);\n        });\n\n        ui.onDialogHidden(self.$dialog, function () {\n          $imageInput.off('change');\n          $imageUrl.off('keyup paste keypress');\n          $imageBtn.off('click');\n\n          if (deferred.state() === 'pending') {\n            deferred.reject();\n          }\n        });\n\n        ui.showDialog(self.$dialog);\n      });\n    };\n  };\n\n\n  /**\n   * Image popover module\n   *  mouse events that show/hide popover will be handled by Handle.js.\n   *  Handle.js will receive the events and invoke 'imagePopover.update'.\n   */\n  var ImagePopover = function (context) {\n    var self = this;\n    var ui = $.summernote.ui;\n\n    var $editable = context.layoutInfo.editable;\n    var editable = $editable[0];\n    var options = context.options;\n\n    this.events = {\n      'summernote.disable': function () {\n        self.hide();\n      }\n    };\n\n    this.shouldInitialize = function () {\n      return !list.isEmpty(options.popover.image);\n    };\n\n    this.initialize = function () {\n      this.$popover = ui.popover({\n        className: 'note-image-popover'\n      }).render().appendTo('body');\n      var $content = this.$popover.find('.popover-content,.note-popover-content');\n\n      context.invoke('buttons.build', $content, options.popover.image);\n    };\n\n    this.destroy = function () {\n      this.$popover.remove();\n    };\n\n    this.update = function (target) {\n      if (dom.isImg(target)) {\n        var pos = dom.posFromPlaceholder(target);\n        var posEditor = dom.posFromPlaceholder(editable);\n\n        this.$popover.css({\n          display: 'block',\n          left: pos.left,\n          top: Math.min(pos.top, posEditor.top)\n        });\n      } else {\n        this.hide();\n      }\n    };\n\n    this.hide = function () {\n      this.$popover.hide();\n    };\n  };\n\n  var TablePopover = function (context) {\n    var self = this;\n    var ui = $.summernote.ui;\n\n    var options = context.options;\n\n    this.events = {\n      'summernote.mousedown': function (we, e) {\n        self.update(e.target);\n      },\n      'summernote.keyup summernote.scroll summernote.change': function () {\n        self.update();\n      },\n      'summernote.disable': function () {\n        self.hide();\n      }\n    };\n\n    this.shouldInitialize = function () {\n      return !list.isEmpty(options.popover.table);\n    };\n\n    this.initialize = function () {\n      this.$popover = ui.popover({\n        className: 'note-table-popover'\n      }).render().appendTo('body');\n      var $content = this.$popover.find('.popover-content,.note-popover-content');\n\n      context.invoke('buttons.build', $content, options.popover.table);\n\n      // [workaround] Disable Firefox's default table editor\n      if (agent.isFF) {\n        document.execCommand('enableInlineTableEditing', false, false);\n      }\n    };\n\n    this.destroy = function () {\n      this.$popover.remove();\n    };\n\n    this.update = function (target) {\n      if (context.isDisabled()) {\n        return false;\n      }\n\n      var isCell = dom.isCell(target);\n\n      if (isCell) {\n        var pos = dom.posFromPlaceholder(target);\n        this.$popover.css({\n          display: 'block',\n          left: pos.left,\n          top: pos.top\n        });\n      } else {\n        this.hide();\n      }\n\n      return isCell;\n    };\n\n    this.hide = function () {\n      this.$popover.hide();\n    };\n  };\n\n  var VideoDialog = function (context) {\n    var self = this;\n    var ui = $.summernote.ui;\n\n    var $editor = context.layoutInfo.editor;\n    var options = context.options;\n    var lang = options.langInfo;\n\n    this.initialize = function () {\n      var $container = options.dialogsInBody ? $(document.body) : $editor;\n\n      var body = '<div class=\"form-group note-form-group row-fluid\">' +\n          '<label class=\"note-form-label\">' + lang.video.url + ' <small class=\"text-muted\">' + lang.video.providers + '</small></label>' +\n          '<input class=\"note-video-url form-control  note-form-control note-input span12\" ' + \n          ' type=\"text\" />' +\n          '</div>';\n      var footer = '<button href=\"#\" class=\"btn btn-primary note-btn note-btn-primary ' + \n      ' note-video-btn disabled\" disabled>' + lang.video.insert + '</button>';\n\n      this.$dialog = ui.dialog({\n        title: lang.video.insert,\n        fade: options.dialogsFade,\n        body: body,\n        footer: footer\n      }).render().appendTo($container);\n    };\n\n    this.destroy = function () {\n      ui.hideDialog(this.$dialog);\n      this.$dialog.remove();\n    };\n\n    this.bindEnterKey = function ($input, $btn) {\n      $input.on('keypress', function (event) {\n        if (event.keyCode === key.code.ENTER) {\n          $btn.trigger('click');\n        }\n      });\n    };\n\n    this.createVideoNode = function (url) {\n      // video url patterns(youtube, instagram, vimeo, dailymotion, youku, mp4, ogg, webm)\n      var ytRegExp = /^(?:https?:\\/\\/)?(?:www\\.)?(?:youtu\\.be\\/|youtube\\.com\\/(?:embed\\/|v\\/|watch\\?v=|watch\\?.+&v=))((\\w|-){11})(?:\\S+)?$/;\n      var ytMatch = url.match(ytRegExp);\n\n      var igRegExp = /(?:www\\.|\\/\\/)instagram\\.com\\/p\\/(.[a-zA-Z0-9_-]*)/;\n      var igMatch = url.match(igRegExp);\n\n      var vRegExp = /\\/\\/vine\\.co\\/v\\/([a-zA-Z0-9]+)/;\n      var vMatch = url.match(vRegExp);\n\n      var vimRegExp = /\\/\\/(player\\.)?vimeo\\.com\\/([a-z]*\\/)*(\\d+)[?]?.*/;\n      var vimMatch = url.match(vimRegExp);\n\n      var dmRegExp = /.+dailymotion.com\\/(video|hub)\\/([^_]+)[^#]*(#video=([^_&]+))?/;\n      var dmMatch = url.match(dmRegExp);\n\n      var youkuRegExp = /\\/\\/v\\.youku\\.com\\/v_show\\/id_(\\w+)=*\\.html/;\n      var youkuMatch = url.match(youkuRegExp);\n\n      var qqRegExp = /\\/\\/v\\.qq\\.com.*?vid=(.+)/;\n      var qqMatch = url.match(qqRegExp);\n\n      var qqRegExp2 = /\\/\\/v\\.qq\\.com\\/x?\\/?(page|cover).*?\\/([^\\/]+)\\.html\\??.*/;\n      var qqMatch2 = url.match(qqRegExp2);\n\n      var mp4RegExp = /^.+.(mp4|m4v)$/;\n      var mp4Match = url.match(mp4RegExp);\n\n      var oggRegExp = /^.+.(ogg|ogv)$/;\n      var oggMatch = url.match(oggRegExp);\n\n      var webmRegExp = /^.+.(webm)$/;\n      var webmMatch = url.match(webmRegExp);\n\n      var $video;\n      if (ytMatch && ytMatch[1].length === 11) {\n        var youtubeId = ytMatch[1];\n        $video = $('<iframe>')\n            .attr('frameborder', 0)\n            .attr('src', '//www.youtube.com/embed/' + youtubeId)\n            .attr('width', '640').attr('height', '360');\n      } else if (igMatch && igMatch[0].length) {\n        $video = $('<iframe>')\n            .attr('frameborder', 0)\n            .attr('src', 'https://instagram.com/p/' + igMatch[1] + '/embed/')\n            .attr('width', '612').attr('height', '710')\n            .attr('scrolling', 'no')\n            .attr('allowtransparency', 'true');\n      } else if (vMatch && vMatch[0].length) {\n        $video = $('<iframe>')\n            .attr('frameborder', 0)\n            .attr('src', vMatch[0] + '/embed/simple')\n            .attr('width', '600').attr('height', '600')\n            .attr('class', 'vine-embed');\n      } else if (vimMatch && vimMatch[3].length) {\n        $video = $('<iframe webkitallowfullscreen mozallowfullscreen allowfullscreen>')\n            .attr('frameborder', 0)\n            .attr('src', '//player.vimeo.com/video/' + vimMatch[3])\n            .attr('width', '640').attr('height', '360');\n      } else if (dmMatch && dmMatch[2].length) {\n        $video = $('<iframe>')\n            .attr('frameborder', 0)\n            .attr('src', '//www.dailymotion.com/embed/video/' + dmMatch[2])\n            .attr('width', '640').attr('height', '360');\n      } else if (youkuMatch && youkuMatch[1].length) {\n        $video = $('<iframe webkitallowfullscreen mozallowfullscreen allowfullscreen>')\n            .attr('frameborder', 0)\n            .attr('height', '498')\n            .attr('width', '510')\n            .attr('src', '//player.youku.com/embed/' + youkuMatch[1]);\n      } else if ((qqMatch && qqMatch[1].length) || (qqMatch2 && qqMatch2[2].length)) {\n        var vid = ((qqMatch && qqMatch[1].length) ? qqMatch[1]:qqMatch2[2]);\n        $video = $('<iframe webkitallowfullscreen mozallowfullscreen allowfullscreen>')\n            .attr('frameborder', 0)\n            .attr('height', '310')\n            .attr('width', '500')\n            .attr('src', 'http://v.qq.com/iframe/player.html?vid=' + vid + '&amp;auto=0');\n      } else if (mp4Match || oggMatch || webmMatch) {\n        $video = $('<video controls>')\n            .attr('src', url)\n            .attr('width', '640').attr('height', '360');\n      } else {\n        // this is not a known video link. Now what, Cat? Now what?\n        return false;\n      }\n\n      $video.addClass('note-video-clip');\n\n      return $video[0];\n    };\n\n    this.show = function () {\n      var text = context.invoke('editor.getSelectedText');\n      context.invoke('editor.saveRange');\n      this.showVideoDialog(text).then(function (url) {\n        // [workaround] hide dialog before restore range for IE range focus\n        ui.hideDialog(self.$dialog);\n        context.invoke('editor.restoreRange');\n\n        // build node\n        var $node = self.createVideoNode(url);\n\n        if ($node) {\n          // insert video node\n          context.invoke('editor.insertNode', $node);\n        }\n      }).fail(function () {\n        context.invoke('editor.restoreRange');\n      });\n    };\n\n    /**\n     * show image dialog\n     *\n     * @param {jQuery} $dialog\n     * @return {Promise}\n     */\n    this.showVideoDialog = function (text) {\n      return $.Deferred(function (deferred) {\n        var $videoUrl = self.$dialog.find('.note-video-url'),\n            $videoBtn = self.$dialog.find('.note-video-btn');\n\n        ui.onDialogShown(self.$dialog, function () {\n          context.triggerEvent('dialog.shown');\n\n          $videoUrl.val(text).on('input', function () {\n            ui.toggleBtn($videoBtn, $videoUrl.val());\n          }).trigger('focus');\n\n          $videoBtn.click(function (event) {\n            event.preventDefault();\n\n            deferred.resolve($videoUrl.val());\n          });\n\n          self.bindEnterKey($videoUrl, $videoBtn);\n        });\n\n        ui.onDialogHidden(self.$dialog, function () {\n          $videoUrl.off('input');\n          $videoBtn.off('click');\n\n          if (deferred.state() === 'pending') {\n            deferred.reject();\n          }\n        });\n\n        ui.showDialog(self.$dialog);\n      });\n    };\n  };\n\n  var HelpDialog = function (context) {\n    var self = this;\n    var ui = $.summernote.ui;\n\n    var $editor = context.layoutInfo.editor;\n    var options = context.options;\n    var lang = options.langInfo;\n\n    this.createShortCutList = function () {\n      var keyMap = options.keyMap[agent.isMac ? 'mac' : 'pc'];\n      return Object.keys(keyMap).map(function (key) {\n        var command = keyMap[key];\n        var $row = $('<div><div class=\"help-list-item\"/></div>');\n        $row.append($('<label><kbd>' + key + '</kdb></label>').css({\n          'width': 180,\n          'margin-right': 10\n        })).append($('<span/>').html(context.memo('help.' + command) || command));\n        return $row.html();\n      }).join('');\n    };\n\n    this.initialize = function () {\n      var $container = options.dialogsInBody ? $(document.body) : $editor;\n\n      var body = [\n        '<p class=\"text-center\">',\n        '<a href=\"http://summernote.org/\" target=\"_blank\">Summernote 0.8.8</a>  ',\n        '<a href=\"https://github.com/summernote/summernote\" target=\"_blank\">Project</a>  ',\n        '<a href=\"https://github.com/summernote/summernote/issues\" target=\"_blank\">Issues</a>',\n        '</p>'\n      ].join('');\n\n      this.$dialog = ui.dialog({\n        title: lang.options.help,\n        fade: options.dialogsFade,\n        body: this.createShortCutList(),\n        footer: body,\n        callback: function ($node) {\n          $node.find('.modal-body,.note-modal-body').css({\n            'max-height': 300,\n            'overflow': 'scroll'\n          });\n        }\n      }).render().appendTo($container);\n    };\n\n    this.destroy = function () {\n      ui.hideDialog(this.$dialog);\n      this.$dialog.remove();\n    };\n\n    /**\n     * show help dialog\n     *\n     * @return {Promise}\n     */\n    this.showHelpDialog = function () {\n      return $.Deferred(function (deferred) {\n        ui.onDialogShown(self.$dialog, function () {\n          context.triggerEvent('dialog.shown');\n          deferred.resolve();\n        });\n        ui.showDialog(self.$dialog);\n      }).promise();\n    };\n\n    this.show = function () {\n      context.invoke('editor.saveRange');\n      this.showHelpDialog().then(function () {\n        context.invoke('editor.restoreRange');\n      });\n    };\n  };\n\n  var AirPopover = function (context) {\n    var self = this;\n    var ui = $.summernote.ui;\n\n    var options = context.options;\n\n    var AIR_MODE_POPOVER_X_OFFSET = 20;\n\n    this.events = {\n      'summernote.keyup summernote.mouseup summernote.scroll': function () {\n        self.update();\n      },\n      'summernote.disable summernote.change summernote.dialog.shown': function () {\n        self.hide();\n      },\n      'summernote.focusout': function (we, e) {\n        // [workaround] Firefox doesn't support relatedTarget on focusout\n        //  - Ignore hide action on focus out in FF.\n        if (agent.isFF) {\n          return;\n        }\n\n        if (!e.relatedTarget || !dom.ancestor(e.relatedTarget, func.eq(self.$popover[0]))) {\n          self.hide();\n        }\n      }\n    };\n\n    this.shouldInitialize = function () {\n      return options.airMode && !list.isEmpty(options.popover.air);\n    };\n\n    this.initialize = function () {\n      this.$popover = ui.popover({\n        className: 'note-air-popover'\n      }).render().appendTo('body');\n      var $content = this.$popover.find('.popover-content');\n\n      context.invoke('buttons.build', $content, options.popover.air);\n    };\n\n    this.destroy = function () {\n      this.$popover.remove();\n    };\n\n    this.update = function () {\n      var styleInfo = context.invoke('editor.currentStyle');\n      if (styleInfo.range && !styleInfo.range.isCollapsed()) {\n        var rect = list.last(styleInfo.range.getClientRects());\n        if (rect) {\n          var bnd = func.rect2bnd(rect);\n          this.$popover.css({\n            display: 'block',\n            left: Math.max(bnd.left + bnd.width / 2, 0) - AIR_MODE_POPOVER_X_OFFSET,\n            top: bnd.top + bnd.height\n          });\n          context.invoke('buttons.updateCurrentStyle', this.$popover);\n        }\n      } else {\n        this.hide();\n      }\n    };\n\n    this.hide = function () {\n      this.$popover.hide();\n    };\n  };\n\n  var HintPopover = function (context) {\n    var self = this;\n    var ui = $.summernote.ui;\n\n    var POPOVER_DIST = 5;\n    var hint = context.options.hint || [];\n    var direction = context.options.hintDirection || 'bottom';\n    var hints = $.isArray(hint) ? hint : [hint];\n\n    this.events = {\n      'summernote.keyup': function (we, e) {\n        if (!e.isDefaultPrevented()) {\n          self.handleKeyup(e);\n        }\n      },\n      'summernote.keydown': function (we, e) {\n        self.handleKeydown(e);\n      },\n      'summernote.disable summernote.dialog.shown': function () {\n        self.hide();\n      }\n    };\n\n    this.shouldInitialize = function () {\n      return hints.length > 0;\n    };\n\n    this.initialize = function () {\n      this.lastWordRange = null;\n      this.$popover = ui.popover({\n        className: 'note-hint-popover',\n        hideArrow: true,\n        direction: ''\n      }).render().appendTo('body');\n\n      this.$popover.hide();\n\n      this.$content = this.$popover.find('.popover-content,.note-popover-content');\n\n      this.$content.on('click', '.note-hint-item', function () {\n        self.$content.find('.active').removeClass('active');\n        $(this).addClass('active');\n        self.replace();\n      });\n    };\n\n    this.destroy = function () {\n      this.$popover.remove();\n    };\n\n    this.selectItem = function ($item) {\n      this.$content.find('.active').removeClass('active');\n      $item.addClass('active');\n\n      this.$content[0].scrollTop = $item[0].offsetTop - (this.$content.innerHeight() / 2);\n    };\n\n    this.moveDown = function () {\n      var $current = this.$content.find('.note-hint-item.active');\n      var $next = $current.next();\n\n      if ($next.length) {\n        this.selectItem($next);\n      } else {\n        var $nextGroup = $current.parent().next();\n\n        if (!$nextGroup.length) {\n          $nextGroup = this.$content.find('.note-hint-group').first();\n        }\n\n        this.selectItem($nextGroup.find('.note-hint-item').first());\n      }\n    };\n\n    this.moveUp = function () {\n      var $current = this.$content.find('.note-hint-item.active');\n      var $prev = $current.prev();\n\n      if ($prev.length) {\n        this.selectItem($prev);\n      } else {\n        var $prevGroup = $current.parent().prev();\n\n        if (!$prevGroup.length) {\n          $prevGroup = this.$content.find('.note-hint-group').last();\n        }\n\n        this.selectItem($prevGroup.find('.note-hint-item').last());\n      }\n    };\n\n    this.replace = function () {\n      var $item = this.$content.find('.note-hint-item.active');\n\n      if ($item.length) {\n        var node = this.nodeFromItem($item);\n        // XXX: consider to move codes to editor for recording redo/undo.\n        this.lastWordRange.insertNode(node);\n        range.createFromNode(node).collapse().select();\n\n        this.lastWordRange = null;\n        this.hide();\n        context.triggerEvent('change', context.layoutInfo.editable.html(), context.layoutInfo.editable);\n        context.invoke('editor.focus');\n      }\n\n    };\n\n    this.nodeFromItem = function ($item) {\n      var hint = hints[$item.data('index')];\n      var item = $item.data('item');\n      var node = hint.content ? hint.content(item) : item;\n      if (typeof node === 'string') {\n        node = dom.createText(node);\n      }\n      return node;\n    };\n\n    this.createItemTemplates = function (hintIdx, items) {\n      var hint = hints[hintIdx];\n      return items.map(function (item, idx) {\n        var $item = $('<div class=\"note-hint-item\"/>');\n        $item.append(hint.template ? hint.template(item) : item + '');\n        $item.data({\n          'index': hintIdx,\n          'item': item\n        });\n\n        if (hintIdx === 0 && idx === 0) {\n          $item.addClass('active');\n        }\n        return $item;\n      });\n    };\n\n    this.handleKeydown = function (e) {\n      if (!this.$popover.is(':visible')) {\n        return;\n      }\n\n      if (e.keyCode === key.code.ENTER) {\n        e.preventDefault();\n        this.replace();\n      } else if (e.keyCode === key.code.UP) {\n        e.preventDefault();\n        this.moveUp();\n      } else if (e.keyCode === key.code.DOWN) {\n        e.preventDefault();\n        this.moveDown();\n      }\n    };\n\n    this.searchKeyword = function (index, keyword, callback) {\n      var hint = hints[index];\n      if (hint && hint.match.test(keyword) && hint.search) {\n        var matches = hint.match.exec(keyword);\n        hint.search(matches[1], callback);\n      } else {\n        callback();\n      }\n    };\n\n    this.createGroup = function (idx, keyword) {\n      var $group = $('<div class=\"note-hint-group note-hint-group-' + idx + '\"/>');\n      this.searchKeyword(idx, keyword, function (items) {\n        items = items || [];\n        if (items.length) {\n          $group.html(self.createItemTemplates(idx, items));\n          self.show();\n        }\n      });\n\n      return $group;\n    };\n\n    this.handleKeyup = function (e) {\n      if (list.contains([key.code.ENTER, key.code.UP, key.code.DOWN], e.keyCode)) {\n        if (e.keyCode === key.code.ENTER) {\n          if (this.$popover.is(':visible')) {\n            return;\n          }\n        }\n      } else {\n        var wordRange = context.invoke('editor.createRange').getWordRange();\n        var keyword = wordRange.toString();\n        if (hints.length && keyword) {\n          this.$content.empty();\n\n          var bnd = func.rect2bnd(list.last(wordRange.getClientRects()));\n          if (bnd) {\n\n            this.$popover.hide();\n\n            this.lastWordRange = wordRange;\n\n            hints.forEach(function (hint, idx) {\n              if (hint.match.test(keyword)) {\n                self.createGroup(idx, keyword).appendTo(self.$content);\n              }\n            });\n\n            // set position for popover after group is created\n            if (direction === 'top') {\n              this.$popover.css({\n                left: bnd.left,\n                top: bnd.top - this.$popover.outerHeight() - POPOVER_DIST\n              });\n            } else {\n              this.$popover.css({\n                left: bnd.left,\n                top: bnd.top + bnd.height + POPOVER_DIST\n              });\n            }\n\n          }\n        } else {\n          this.hide();\n        }\n      }\n    };\n\n    this.show = function () {\n      this.$popover.show();\n    };\n\n    this.hide = function () {\n      this.$popover.hide();\n    };\n  };\n\n\n  $.summernote = $.extend($.summernote, {\n    version: '0.8.8',\n    ui: ui,\n    dom: dom,\n\n    plugins: {},\n\n    options: {\n      modules: {\n        'editor': Editor,\n        'clipboard': Clipboard,\n        'dropzone': Dropzone,\n        'codeview': Codeview,\n        'statusbar': Statusbar,\n        'fullscreen': Fullscreen,\n        'handle': Handle,\n        // FIXME: HintPopover must be front of autolink\n        //  - Script error about range when Enter key is pressed on hint popover\n        'hintPopover': HintPopover,\n        'autoLink': AutoLink,\n        'autoSync': AutoSync,\n        'placeholder': Placeholder,\n        'buttons': Buttons,\n        'toolbar': Toolbar,\n        'linkDialog': LinkDialog,\n        'linkPopover': LinkPopover,\n        'imageDialog': ImageDialog,\n        'imagePopover': ImagePopover,\n        'tablePopover': TablePopover,\n        'videoDialog': VideoDialog,\n        'helpDialog': HelpDialog,\n        'airPopover': AirPopover\n      },\n\n      buttons: {},\n\n      lang: 'en-US',\n\n      // toolbar\n      toolbar: [\n        ['style', ['style']],\n        ['font', ['bold', 'underline', 'clear']],\n        ['fontname', ['fontname']],\n        ['color', ['color']],\n        ['para', ['ul', 'ol', 'paragraph']],\n        ['table', ['table']],\n        ['insert', ['link', 'picture', 'video']],\n        ['view', ['fullscreen', 'codeview', 'help']]\n      ],\n\n      // popover\n      popover: {\n        image: [\n          ['imagesize', ['imageSize100', 'imageSize50', 'imageSize25']],\n          ['float', ['floatLeft', 'floatRight', 'floatNone']],\n          ['remove', ['removeMedia']]\n        ],\n        link: [\n          ['link', ['linkDialogShow', 'unlink']]\n        ],\n        table: [\n          ['add', ['addRowDown', 'addRowUp', 'addColLeft', 'addColRight']],\n          ['delete', ['deleteRow', 'deleteCol', 'deleteTable']]\n        ],\n        air: [\n          ['color', ['color']],\n          ['font', ['bold', 'underline', 'clear']],\n          ['para', ['ul', 'paragraph']],\n          ['table', ['table']],\n          ['insert', ['link', 'picture']]\n        ]\n      },\n\n      // air mode: inline editor\n      airMode: false,\n\n      width: null,\n      height: null,\n      linkTargetBlank: true,\n\n      focus: false,\n      tabSize: 4,\n      styleWithSpan: true,\n      shortcuts: true,\n      textareaAutoSync: true,\n      direction: null,\n      tooltip: 'auto',\n\n      styleTags: ['p', 'blockquote', 'pre', 'h1', 'h2', 'h3', 'h4', 'h5', 'h6'],\n\n      fontNames: [\n        'Arial', 'Arial Black', 'Comic Sans MS', 'Courier New',\n        'Helvetica Neue', 'Helvetica', 'Impact', 'Lucida Grande',\n        'Tahoma', 'Times New Roman', 'Verdana'\n      ],\n\n      fontSizes: ['8', '9', '10', '11', '12', '14', '18', '24', '36'],\n\n      // pallete colors(n x n)\n      colors: [\n        ['#000000', '#424242', '#636363', '#9C9C94', '#CEC6CE', '#EFEFEF', '#F7F7F7', '#FFFFFF'],\n        ['#FF0000', '#FF9C00', '#FFFF00', '#00FF00', '#00FFFF', '#0000FF', '#9C00FF', '#FF00FF'],\n        ['#F7C6CE', '#FFE7CE', '#FFEFC6', '#D6EFD6', '#CEDEE7', '#CEE7F7', '#D6D6E7', '#E7D6DE'],\n        ['#E79C9C', '#FFC69C', '#FFE79C', '#B5D6A5', '#A5C6CE', '#9CC6EF', '#B5A5D6', '#D6A5BD'],\n        ['#E76363', '#F7AD6B', '#FFD663', '#94BD7B', '#73A5AD', '#6BADDE', '#8C7BC6', '#C67BA5'],\n        ['#CE0000', '#E79439', '#EFC631', '#6BA54A', '#4A7B8C', '#3984C6', '#634AA5', '#A54A7B'],\n        ['#9C0000', '#B56308', '#BD9400', '#397B21', '#104A5A', '#085294', '#311873', '#731842'],\n        ['#630000', '#7B3900', '#846300', '#295218', '#083139', '#003163', '#21104A', '#4A1031']\n      ],\n\n      lineHeights: ['1.0', '1.2', '1.4', '1.5', '1.6', '1.8', '2.0', '3.0'],\n\n      tableClassName: 'table table-bordered',\n\n      insertTableMaxSize: {\n        col: 10,\n        row: 10\n      },\n\n      dialogsInBody: false,\n      dialogsFade: false,\n\n      maximumImageFileSize: null,\n\n      callbacks: {\n        onInit: null,\n        onFocus: null,\n        onBlur: null,\n        onEnter: null,\n        onKeyup: null,\n        onKeydown: null,\n        onImageUpload: null,\n        onImageUploadError: null\n      },\n\n      codemirror: {\n        mode: 'text/html',\n        htmlMode: true,\n        lineNumbers: true\n      },\n\n      keyMap: {\n        pc: {\n          'ENTER': 'insertParagraph',\n          'CTRL+Z': 'undo',\n          'CTRL+Y': 'redo',\n          'TAB': 'tab',\n          'SHIFT+TAB': 'untab',\n          'CTRL+B': 'bold',\n          'CTRL+I': 'italic',\n          'CTRL+U': 'underline',\n          'CTRL+SHIFT+S': 'strikethrough',\n          'CTRL+BACKSLASH': 'removeFormat',\n          'CTRL+SHIFT+L': 'justifyLeft',\n          'CTRL+SHIFT+E': 'justifyCenter',\n          'CTRL+SHIFT+R': 'justifyRight',\n          'CTRL+SHIFT+J': 'justifyFull',\n          'CTRL+SHIFT+NUM7': 'insertUnorderedList',\n          'CTRL+SHIFT+NUM8': 'insertOrderedList',\n          'CTRL+LEFTBRACKET': 'outdent',\n          'CTRL+RIGHTBRACKET': 'indent',\n          'CTRL+NUM0': 'formatPara',\n          'CTRL+NUM1': 'formatH1',\n          'CTRL+NUM2': 'formatH2',\n          'CTRL+NUM3': 'formatH3',\n          'CTRL+NUM4': 'formatH4',\n          'CTRL+NUM5': 'formatH5',\n          'CTRL+NUM6': 'formatH6',\n          'CTRL+ENTER': 'insertHorizontalRule',\n          'CTRL+K': 'linkDialog.show'\n        },\n\n        mac: {\n          'ENTER': 'insertParagraph',\n          'CMD+Z': 'undo',\n          'CMD+SHIFT+Z': 'redo',\n          'TAB': 'tab',\n          'SHIFT+TAB': 'untab',\n          'CMD+B': 'bold',\n          'CMD+I': 'italic',\n          'CMD+U': 'underline',\n          'CMD+SHIFT+S': 'strikethrough',\n          'CMD+BACKSLASH': 'removeFormat',\n          'CMD+SHIFT+L': 'justifyLeft',\n          'CMD+SHIFT+E': 'justifyCenter',\n          'CMD+SHIFT+R': 'justifyRight',\n          'CMD+SHIFT+J': 'justifyFull',\n          'CMD+SHIFT+NUM7': 'insertUnorderedList',\n          'CMD+SHIFT+NUM8': 'insertOrderedList',\n          'CMD+LEFTBRACKET': 'outdent',\n          'CMD+RIGHTBRACKET': 'indent',\n          'CMD+NUM0': 'formatPara',\n          'CMD+NUM1': 'formatH1',\n          'CMD+NUM2': 'formatH2',\n          'CMD+NUM3': 'formatH3',\n          'CMD+NUM4': 'formatH4',\n          'CMD+NUM5': 'formatH5',\n          'CMD+NUM6': 'formatH6',\n          'CMD+ENTER': 'insertHorizontalRule',\n          'CMD+K': 'linkDialog.show'\n        }\n      },\n      icons: {\n        'align': 'note-icon-align',\n        'alignCenter': 'note-icon-align-center',\n        'alignJustify': 'note-icon-align-justify',\n        'alignLeft': 'note-icon-align-left',\n        'alignRight': 'note-icon-align-right',\n        'rowBelow': 'note-icon-row-below',\n        'colBefore': 'note-icon-col-before',\n        'colAfter': 'note-icon-col-after',\n        'rowAbove': 'note-icon-row-above',\n        'rowRemove': 'note-icon-row-remove',\n        'colRemove': 'note-icon-col-remove',\n        'indent': 'note-icon-align-indent',\n        'outdent': 'note-icon-align-outdent',\n        'arrowsAlt': 'note-icon-arrows-alt',\n        'bold': 'note-icon-bold',\n        'caret': 'note-icon-caret',\n        'circle': 'note-icon-circle',\n        'close': 'note-icon-close',\n        'code': 'note-icon-code',\n        'eraser': 'note-icon-eraser',\n        'font': 'note-icon-font',\n        'frame': 'note-icon-frame',\n        'italic': 'note-icon-italic',\n        'link': 'note-icon-link',\n        'unlink': 'note-icon-chain-broken',\n        'magic': 'note-icon-magic',\n        'menuCheck': 'note-icon-menu-check',\n        'minus': 'note-icon-minus',\n        'orderedlist': 'note-icon-orderedlist',\n        'pencil': 'note-icon-pencil',\n        'picture': 'note-icon-picture',\n        'question': 'note-icon-question',\n        'redo': 'note-icon-redo',\n        'square': 'note-icon-square',\n        'strikethrough': 'note-icon-strikethrough',\n        'subscript': 'note-icon-subscript',\n        'superscript': 'note-icon-superscript',\n        'table': 'note-icon-table',\n        'textHeight': 'note-icon-text-height',\n        'trash': 'note-icon-trash',\n        'underline': 'note-icon-underline',\n        'undo': 'note-icon-undo',\n        'unorderedlist': 'note-icon-unorderedlist',\n        'video': 'note-icon-video'\n      }\n    }\n  });\n\n}));\n"]}